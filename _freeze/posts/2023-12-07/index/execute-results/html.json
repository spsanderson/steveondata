{
  "hash": "a838a33d2bd5af3d348256fa7f41de02",
  "result": {
    "markdown": "---\ntitle: \"Unraveling Patterns: A Step-by-Step Guide to Piecewise Regression in R\"\nauthor: \"Steven P. Sanderson II, MPH\"\ndate: \"2023-12-07\"\ncategories: [rtip, regression]\n---\n\n\n# Introduction\n\nHey there, fellow R enthusiasts! Today, let's embark on a fascinating journey into the realm of piecewise regression using R. If you've ever wondered how to uncover hidden trends and breakpoints in your data, you're in for a treat. Buckle up, and let's dive into the world of piecewise regression!\n\n# Piecewise Regression\n\nPiecewise regression is a powerful technique that allows us to model distinct segments of a dataset with different linear relationships. It's like fitting multiple straight lines to capture the nuances of different regions in your data. So, grab your virtual lab coat, and let's get started.\n\n# Example\n\n## Step 1: Load Your Data and Libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Install and load necessary packages\n# install.packages(\"segmented\")\nlibrary(segmented)\n\n# Sample data\nset.seed(123)\nx <- 1:100\ny <- 2 + 1.5 * pmax(x - 35, 0) - 1.5 * pmax(x - 70, 0) + rnorm(100)\n\n# Combine data\ndata <- data.frame(x, y)\n```\n:::\n\n\n## Step 2: Explore Your Data\n\nBefore diving into the regression, let's take a peek at our data. Visualizing the data often provides insights into potential breakpoints.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Scatter plot to visualize the data\nplot(\n  data$x, data$y, \n  main = \"Scatter Plot of Your Data\",\n  xlab = \"Independent Variable (x)\", \n  ylab = \"Dependent Variable (y)\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## Step 3: Perform Piecewise Regression\n\nNow, the exciting part! Let's fit our piecewise regression model using the `segmented` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit the piecewise regression model\nmodel <- lm(y ~ x, data = data)\nsegmented_model <- segmented(model, seg.Z = ~x)\n```\n:::\n\n\n## Step 4: Visualize the Results:\n\nTo truly understand the magic happening, let's visualize the fitted model and residuals.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseg_preds <- predict(segmented_model)\nseg_res <- y - seg_preds\n\n# Plot the original data with the fitted model\nplot(\n  data$x, data$y,\n  main = \"Piecewise Regression Fit\",\n  xlab = \"Independent Variable (x)\",\n  ylab = \"Dependent Variable (y)\",\n  col = \"blue\"\n)\nlines(data$x, seg_preds,col = \"red\", lwd = 2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Plot residuals\n# Plot the residuals for each segment\nplot(x, seg_res, main = \"Residuals\")\nabline(h = 0, col = \"red\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n:::\n\n\n## Step 5: Interpret the Breakpoints:\n\nInspecting the segmented model will reveal the breakpoints and the corresponding regression lines. It's like deciphering the story your data is trying to tell.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# View breakpoints and coefficients\nsummary(segmented_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\t***Regression Model with Segmented Relationship(s)***\n\nCall: \nsegmented.lm(obj = model, seg.Z = ~x)\n\nEstimated Break-Point(s):\n          Est. St.Err\npsi1.x 24.757  3.074\n\nCoefficients of the linear terms:\n            Estimate Std. Error t value Pr(>|t|)\n(Intercept)  2.49825    2.55867   0.976    0.331\nx           -0.04055    0.17907  -0.226    0.821\nU1.x         0.93569    0.18186   5.145       NA\n\nResidual standard error: 6.073 on 96 degrees of freedom\nMultiple R-Squared: 0.9333,  Adjusted R-squared: 0.9312 \n\nBoot restarting based on 6 samples. Last fit:\nConvergence attained in 2 iterations (rel. change 2.9855e-12)\n```\n:::\n:::\n\n\n## Step 6: Encourage Exploration:\n\nNow that you've conquered piecewise regression, encourage your fellow data explorers to try it themselves. Challenge them to apply this technique to their datasets and share their insights.\n\n# Conclusion\n\nCongratulations, you've just unlocked the power of piecewise regression in R! By visualizing data, fitting models, and exploring breakpoints, you've gained a valuable tool for understanding complex relationships. Keep coding, keep exploring, and stay curious!\n\nHappy coding, and may your data always reveal its secrets!\n\nSteven P. Sanderson II, MPH",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}