{
  "hash": "5173f45be1ba1c8e01b148ec85c941bb",
  "result": {
    "markdown": "---\ntitle: \"tidyAML: Now supporting gee models\"\nauthor: \"Steven P. Sanderson II, MPH\"\ndate: \"2023-12-01\"\ncategories: [rtip, tidyaml, regression, classification]\n---\n\n\n# Introduction\n\nI am happy to announce that a new version of `tidyAML` is now available on CRAN. This version includes support for `gee` models. This is a big step forward for `tidyAML` as it now supports a wide variety of regression and classification models.\n\n# What is `tidyAML`?\n\nThe package is meant to be a way to quickly create many models of different algorithms, and this release is a small step forward in supporting that mission. The package is built upon the `tidymodels` packages.\n\n# What is `gee`?\n\n`gee` stands for Generalized Estimating Equations. It is a way to model correlated data. For example, if you have a dataset where you have multiple observations per person, you may want to use `gee` to account for the correlation between observations within a person. This is a very common situation in longitudinal studies. Here is [a link](https://parsnip.tidymodels.org/reference/details_linear_reg_gee.html?q=gee#null) to the `gee` parsnip model.\n\n# Example\n\nLet's see how it works, we will examine how it is setup to faily gracefully and how it works when the `multilevelmod` package is installed and loaded into your environment.\n\n## Load Library\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyAML)\n```\n:::\n\n\nNow, let's build a model that will fail, it's important I think to see the failure message so you can understand what is happening. It's likely because the library is not loaded, let's face it, it has happened to all of us.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(recipes)\nlibrary(dplyr)\n\nrec_obj <- recipe(mpg ~ ., data = mtcars)\nfrt_tbl <- fast_regression(\n  mtcars, \n  rec_obj, \n  .parsnip_eng = c(\"lm\",\"glm\",\"gee\"),\n  .parsnip_fns = \"linear_reg\"\n)\n\nglimpse(frt_tbl)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 3\nColumns: 8\n$ .model_id       <int> 1, 2, 3\n$ .parsnip_engine <chr> \"lm\", \"gee\", \"glm\"\n$ .parsnip_mode   <chr> \"regression\", \"regression\", \"regression\"\n$ .parsnip_fns    <chr> \"linear_reg\", \"linear_reg\", \"linear_reg\"\n$ model_spec      <list> [~NULL, ~NULL, NULL, regression, TRUE, NULL, lm, TRUE]…\n$ wflw            <list> [cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb, mp…\n$ fitted_wflw     <list> [cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb, mp…\n$ pred_wflw       <list> [<tbl_df[8 x 1]>], <NULL>, [<tbl_df[8 x 1]>]\n```\n:::\n\n```{.r .cell-code}\nfrt_tbl |> pull(pred_wflw) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n# A tibble: 8 × 1\n  .pred\n  <dbl>\n1 22.9 \n2 18.0 \n3 21.1 \n4 32.9 \n5 18.5 \n6 10.4 \n7  9.59\n8 24.7 \n\n[[2]]\nNULL\n\n[[3]]\n# A tibble: 8 × 1\n  .pred\n  <dbl>\n1 22.9 \n2 18.0 \n3 21.1 \n4 32.9 \n5 18.5 \n6 10.4 \n7  9.59\n8 24.7 \n```\n:::\n\n```{.r .cell-code}\nfrt_tbl |> pull(fitted_wflw) |> purrr::map(broom::tidy)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n# A tibble: 11 × 5\n   term         estimate std.error statistic p.value\n   <chr>           <dbl>     <dbl>     <dbl>   <dbl>\n 1 (Intercept) -40.3       30.5       -1.32   0.209 \n 2 cyl           0.907      1.09       0.830  0.421 \n 3 disp          0.0105     0.0189     0.557  0.587 \n 4 hp           -0.00487    0.0248    -0.196  0.847 \n 5 drat          1.73       2.04       0.846  0.413 \n 6 wt           -5.71       2.35      -2.43   0.0302\n 7 qsec          3.39       1.34       2.54   0.0248\n 8 vs           -3.85       2.99      -1.29   0.220 \n 9 am            2.16       2.29       0.942  0.364 \n10 gear          1.40       1.68       0.838  0.417 \n11 carb          0.200      0.835      0.239  0.815 \n\n[[2]]\n# A tibble: 0 × 0\n\n[[3]]\n# A tibble: 11 × 5\n   term         estimate std.error statistic p.value\n   <chr>           <dbl>     <dbl>     <dbl>   <dbl>\n 1 (Intercept) -40.3       30.5       -1.32   0.209 \n 2 cyl           0.907      1.09       0.830  0.421 \n 3 disp          0.0105     0.0189     0.557  0.587 \n 4 hp           -0.00487    0.0248    -0.196  0.847 \n 5 drat          1.73       2.04       0.846  0.413 \n 6 wt           -5.71       2.35      -2.43   0.0302\n 7 qsec          3.39       1.34       2.54   0.0248\n 8 vs           -3.85       2.99      -1.29   0.220 \n 9 am            2.16       2.29       0.942  0.364 \n10 gear          1.40       1.68       0.838  0.417 \n11 carb          0.200      0.835      0.239  0.815 \n```\n:::\n:::\n\n\nWe see that the `gee` model failed. This is because we did not load the `multilevelmod` package. Let's load it and try again.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(multilevelmod)\n\nfrt_tbl <- fast_regression(\n  mtcars, \n  rec_obj, \n  .parsnip_eng = c(\"lm\",\"glm\",\"gee\"),\n  .parsnip_fns = \"linear_reg\"\n)\n\nglimpse(frt_tbl)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 3\nColumns: 8\n$ .model_id       <int> 1, 2, 3\n$ .parsnip_engine <chr> \"lm\", \"gee\", \"glm\"\n$ .parsnip_mode   <chr> \"regression\", \"regression\", \"regression\"\n$ .parsnip_fns    <chr> \"linear_reg\", \"linear_reg\", \"linear_reg\"\n$ model_spec      <list> [~NULL, ~NULL, NULL, regression, TRUE, NULL, lm, TRUE]…\n$ wflw            <list> [cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb, mp…\n$ fitted_wflw     <list> [cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb, mp…\n$ pred_wflw       <list> [<tbl_df[8 x 1]>], [<tbl_df[8 x 1]>], [<tbl_df[8 x 1]>…\n```\n:::\n\n```{.r .cell-code}\nfrt_tbl |> pull(pred_wflw) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n# A tibble: 8 × 1\n  .pred\n  <dbl>\n1  20.6\n2  15.6\n3  15.8\n4  26.1\n5  27.8\n6  16.6\n7  25.4\n8  21.6\n\n[[2]]\n# A tibble: 8 × 1\n  .pred\n  <dbl>\n1  21.3\n2  15.2\n3  15.3\n4  25.7\n5  27.3\n6  16.5\n7  25.7\n8  20.5\n\n[[3]]\n# A tibble: 8 × 1\n  .pred\n  <dbl>\n1  20.6\n2  15.6\n3  15.8\n4  26.1\n5  27.8\n6  16.6\n7  25.4\n8  21.6\n```\n:::\n\n```{.r .cell-code}\nfrt_tbl |> pull(fitted_wflw) |> purrr::map(broom::tidy)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n# A tibble: 11 × 5\n   term        estimate std.error statistic p.value\n   <chr>          <dbl>     <dbl>     <dbl>   <dbl>\n 1 (Intercept) -3.70      18.9       -0.195  0.848 \n 2 cyl          0.668      1.03       0.647  0.529 \n 3 disp         0.00831    0.0153     0.544  0.596 \n 4 hp          -0.0124     0.0173    -0.717  0.486 \n 5 drat         2.87       1.44       2.00   0.0674\n 6 wt          -2.87       1.40      -2.05   0.0609\n 7 qsec         0.777      0.618      1.26   0.231 \n 8 vs           0.169      1.64       0.103  0.920 \n 9 am           1.90       1.79       1.07   0.306 \n10 gear         1.31       1.44       0.907  0.381 \n11 carb        -0.601      0.730     -0.823  0.425 \n\n[[2]]\n# A tibble: 10 × 6\n   term         estimate std.error statistic p.value        ``\n   <chr>           <dbl>     <dbl>     <dbl>   <dbl>     <dbl>\n 1 (Intercept)  6.54       10.2     0.643     4.01    1.63    \n 2 disp         0.0119      0.0140  0.849     0.0134  0.887   \n 3 hp          -0.0149      0.0165 -0.901     0.0104 -1.43    \n 4 drat         2.36        1.18    2.01      0.859   2.75    \n 5 wt          -3.01        1.35   -2.23      1.35   -2.23    \n 6 qsec         0.577       0.524   1.10      0.193   2.99    \n 7 vs           0.000922    1.58    0.000582  1.07    0.000860\n 8 am           1.35        1.54    0.880     0.886   1.53    \n 9 gear         1.00        1.33    0.752     0.527   1.90    \n10 carb        -0.355       0.611  -0.582     0.378  -0.940   \n\n[[3]]\n# A tibble: 11 × 5\n   term        estimate std.error statistic p.value\n   <chr>          <dbl>     <dbl>     <dbl>   <dbl>\n 1 (Intercept) -3.70      18.9       -0.195  0.848 \n 2 cyl          0.668      1.03       0.647  0.529 \n 3 disp         0.00831    0.0153     0.544  0.596 \n 4 hp          -0.0124     0.0173    -0.717  0.486 \n 5 drat         2.87       1.44       2.00   0.0674\n 6 wt          -2.87       1.40      -2.05   0.0609\n 7 qsec         0.777      0.618      1.26   0.231 \n 8 vs           0.169      1.64       0.103  0.920 \n 9 am           1.90       1.79       1.07   0.306 \n10 gear         1.31       1.44       0.907  0.381 \n11 carb        -0.601      0.730     -0.823  0.425 \n```\n:::\n:::\n\n\n# The recipe object\n\nLet's take a look at the model spec, the workflow and the fitted workflow to see what has happened behind the scenes. First let's look at the formula in the recipe object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nformula(prep(rec_obj))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nmpg ~ cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb\n<environment: 0x0000012c521f0c98>\n```\n:::\n:::\n\n\nSo we see what the formula is, but we also see that there is no `id_var` listed which means it would fail for the `gee` specification, but, our model worked! That is because behind the scenes in the fast sense at this point in development the first variable is taken to be the id variable. Let's see what the workflow looks like.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngee_wflw <- frt_tbl |> slice(2) |> pull(wflw)\n\ngee_wflw[[1]]$fit$actions$model$formula\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nmpg ~ id_var(cyl) + disp + hp + drat + wt + qsec + vs + am + \n    gear + carb\n<environment: 0x0000012c5206d0f8>\n```\n:::\n:::\n\n\nAs we can see the first predictor variable has been chosen as the id variable. This will change in the future, where you will be able to choose the `id_var`.\n\n# Conclusion\n\nThank you for reading and I hope you enjoy the new version of `tidyAML`. Please let me know if you have any questions or comments. We will continue our development of `tidyAML` and hope to have more updates soon.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}