{
  "hash": "20c4f2af311413bac2edf95f0f09bb61",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Stratified Sampling in R: A Practical Guide with Base R and `dplyr`\"\nauthor: \"Steven P. Sanderson II, MPH\"\ndate: \"2024-07-29\"\ncategories: [code, rtip, dplyr]\ntoc: TRUE\n---\n\n\n# Introduction\n\nStratified sampling is a technique used to ensure that different subgroups (strata) within a population are represented in a sample. This method is particularly useful when certain strata are underrepresented in a simple random sample. In this post, we'll explore how to perform stratified sampling in R using both base R and the `dplyr` package. We'll walk through examples and explain the code, so you can try these techniques on your own data.\n\n# What is Stratified Sampling?\n\nIn stratified sampling, the population is divided into different strata based on a specific characteristic (e.g., age, gender, income level). A random sample is then taken from each stratum. This method ensures that the sample represents the population accurately, especially when the strata are significantly different in size or characteristics.\n\n## Stratified Sampling with Base R\n\nLet's start with an example using base R. Suppose we have a dataset with information about individuals, including their gender and income. We want to sample a specific number of individuals from each gender group.\n\nHere's how we can do it:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Sample data\nset.seed(123) # For reproducibility\ndata <- data.frame(\n  ID = 1:100,\n  Gender = sample(c(\"Male\", \"Female\"), 100, replace = TRUE),\n  Income = rnorm(100, mean = 50000, sd = 10000)\n)\n\n# View the first few rows of the data\nhead(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  ID Gender   Income\n1  1   Male 52533.19\n2  2   Male 49714.53\n3  3   Male 49571.30\n4  4 Female 63686.02\n5  5   Male 47742.29\n6  6 Female 65164.71\n```\n\n\n:::\n:::\n\n\nIn this dataset, we have a column for `Gender` and another for `Income`. Let's say we want to sample 10 males and 10 females.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Stratified sampling function\nstratified_sample <- function(data, strat_column, size_per_stratum) {\n  strata <- unique(data[[strat_column]])\n  sampled_data <- do.call(rbind, lapply(strata, function(stratum) {\n    subset_data <- data[data[[strat_column]] == stratum, ]\n    subset_data[sample(nrow(subset_data), size_per_stratum), ]\n  }))\n  return(sampled_data)\n}\n\n# Perform stratified sampling\nsampled_data <- stratified_sample(data, \"Gender\", 10)\n\n# View the sampled data\ntable(sampled_data$Gender)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFemale   Male \n    10     10 \n```\n\n\n:::\n\n```{.r .cell-code}\nhead(sampled_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     ID Gender   Income\n45   45   Male 63606.52\n69   69   Male 41502.96\n83   83   Male 50412.33\n29   29   Male 51813.03\n49   49   Male 47643.00\n100 100   Male 37129.70\n```\n\n\n:::\n:::\n\n\nIn this example:\n\n-   We first create a function `stratified_sample` that takes the data, the column to stratify by, and the number of samples per stratum.\n-   The function identifies unique strata, then samples the specified number of rows from each stratum.\n-   The result is a combined dataset with samples from each group.\n\n## Stratified Sampling with `dplyr`\n\n### Using `sample_n`\n\nThe `dplyr` package makes data manipulation straightforward and efficient. Here's how to do stratified sampling using `dplyr`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n\n# Stratified sampling with sample_n()\nsampled_data_n <- data %>%\n  group_by(Gender) %>%\n  sample_n(10)\n\n# View the sampled data\nsampled_data_n %>% count(Gender)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n# Groups:   Gender [2]\n  Gender     n\n  <chr>  <int>\n1 Female    10\n2 Male      10\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(sampled_data_n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n# Groups:   Gender [1]\n     ID Gender Income\n  <int> <chr>   <dbl>\n1    81 Female 64446.\n2     6 Female 65165.\n3     8 Female 55846.\n4    22 Female 26908.\n5    98 Female 56879.\n6    11 Female 53796.\n```\n\n\n:::\n:::\n\n\nIn this approach:\n\n-   We use `group_by()` to group the data by the `Gender` column.\n-   `sample_n()` is used to take 10 samples from each group.\n-   `count()` helps us verify the number of samples from each group.\n\n### Using `sample_frac()` for Proportional Sampling\n\nIf you want to sample a proportion of each stratum, you can use the `sample_frac()` function. For example, if you want to sample 20% of each gender group:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Stratified sampling with sample_frac()\nsampled_data_frac <- data %>%\n  group_by(Gender) %>%\n  sample_frac(0.2)\n\n# View the sampled data\nsampled_data_frac %>% count(Gender)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n# Groups:   Gender [2]\n  Gender     n\n  <chr>  <int>\n1 Female     9\n2 Male      11\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(sampled_data_frac)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n# Groups:   Gender [1]\n     ID Gender Income\n  <int> <chr>   <dbl>\n1    71 Female 51176.\n2    92 Female 47378.\n3    13 Female 46668.\n4    48 Female 65326.\n5    42 Female 55484.\n6    76 Female 43481.\n```\n\n\n:::\n:::\n\n\nIn this example:\n\n-   `sample_frac()` is used to take 20% of the rows from each group. \n-   This is useful when you want the sample size to be proportional to the size of each stratum.\n\n# Conclusion\n\nStratified sampling is a powerful technique to ensure representation from all subgroups in your sample. Whether you're using base R or `dplyr`, the process is straightforward and allows you to draw balanced samples from your data.\n\nFeel free to try these methods on your data! Experimenting with different sizes and strata can help you understand how stratified sampling affects your analyses. Don't hesitate to dive into the code and see how you can adapt it to your needs. \n\n---\n\nHappy coding!",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}