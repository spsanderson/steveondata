{
  "hash": "98ba621463508cd737a9351bf81712dd",
  "result": {
    "markdown": "---\ntitle: \"A Complete Guide to Stepwise Regression in R\"\nauthor: \"Steven P. Sanderson II, MPH\"\ndate: \"2023-12-06\"\ncategories: [rtip, regression]\n---\n\n\n# Introduction \n\nStepwise regression is a powerful technique used to build predictive models by iteratively adding or removing variables based on statistical criteria. In R, this can be achieved using functions like `step()` or manually with forward and backward selection.\n\n# Example\n\n## Forward Stepwise Regression:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Initialize an empty model\nforward_model <- lm(mpg ~ ., data = mtcars)\n\n# Forward stepwise regression\nforward_model <- step(forward_model, direction = \"forward\", scope = formula(~ .))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nStart:  AIC=70.9\nmpg ~ cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb\n```\n:::\n:::\n\n\nIn simple terms, we start with a model containing no predictors (`mpg ~ 1`) and iteratively add the most statistically significant variables until no improvement is observed.\n\n## Backward Stepwise Regression:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Initialize a model with all predictors\nbackward_model <- lm(mpg ~ ., data = mtcars)\n\n# Backward stepwise regression\nbackward_model <- step(backward_model, direction = \"backward\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nStart:  AIC=70.9\nmpg ~ cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb\n\n       Df Sum of Sq    RSS    AIC\n- cyl   1    0.0799 147.57 68.915\n- vs    1    0.1601 147.66 68.932\n- carb  1    0.4067 147.90 68.986\n- gear  1    1.3531 148.85 69.190\n- drat  1    1.6270 149.12 69.249\n- disp  1    3.9167 151.41 69.736\n- hp    1    6.8399 154.33 70.348\n- qsec  1    8.8641 156.36 70.765\n<none>              147.49 70.898\n- am    1   10.5467 158.04 71.108\n- wt    1   27.0144 174.51 74.280\n\nStep:  AIC=68.92\nmpg ~ disp + hp + drat + wt + qsec + vs + am + gear + carb\n\n       Df Sum of Sq    RSS    AIC\n- vs    1    0.2685 147.84 66.973\n- carb  1    0.5201 148.09 67.028\n- gear  1    1.8211 149.40 67.308\n- drat  1    1.9826 149.56 67.342\n- disp  1    3.9009 151.47 67.750\n- hp    1    7.3632 154.94 68.473\n<none>              147.57 68.915\n- qsec  1   10.0933 157.67 69.032\n- am    1   11.8359 159.41 69.384\n- wt    1   27.0280 174.60 72.297\n\nStep:  AIC=66.97\nmpg ~ disp + hp + drat + wt + qsec + am + gear + carb\n\n       Df Sum of Sq    RSS    AIC\n- carb  1    0.6855 148.53 65.121\n- gear  1    2.1437 149.99 65.434\n- drat  1    2.2139 150.06 65.449\n- disp  1    3.6467 151.49 65.753\n- hp    1    7.1060 154.95 66.475\n<none>              147.84 66.973\n- am    1   11.5694 159.41 67.384\n- qsec  1   15.6830 163.53 68.200\n- wt    1   27.3799 175.22 70.410\n\nStep:  AIC=65.12\nmpg ~ disp + hp + drat + wt + qsec + am + gear\n\n       Df Sum of Sq    RSS    AIC\n- gear  1     1.565 150.09 63.457\n- drat  1     1.932 150.46 63.535\n<none>              148.53 65.121\n- disp  1    10.110 158.64 65.229\n- am    1    12.323 160.85 65.672\n- hp    1    14.826 163.35 66.166\n- qsec  1    26.408 174.94 68.358\n- wt    1    69.127 217.66 75.350\n\nStep:  AIC=63.46\nmpg ~ disp + hp + drat + wt + qsec + am\n\n       Df Sum of Sq    RSS    AIC\n- drat  1     3.345 153.44 62.162\n- disp  1     8.545 158.64 63.229\n<none>              150.09 63.457\n- hp    1    13.285 163.38 64.171\n- am    1    20.036 170.13 65.466\n- qsec  1    25.574 175.67 66.491\n- wt    1    67.572 217.66 73.351\n\nStep:  AIC=62.16\nmpg ~ disp + hp + wt + qsec + am\n\n       Df Sum of Sq    RSS    AIC\n- disp  1     6.629 160.07 61.515\n<none>              153.44 62.162\n- hp    1    12.572 166.01 62.682\n- qsec  1    26.470 179.91 65.255\n- am    1    32.198 185.63 66.258\n- wt    1    69.043 222.48 72.051\n\nStep:  AIC=61.52\nmpg ~ hp + wt + qsec + am\n\n       Df Sum of Sq    RSS    AIC\n- hp    1     9.219 169.29 61.307\n<none>              160.07 61.515\n- qsec  1    20.225 180.29 63.323\n- am    1    25.993 186.06 64.331\n- wt    1    78.494 238.56 72.284\n\nStep:  AIC=61.31\nmpg ~ wt + qsec + am\n\n       Df Sum of Sq    RSS    AIC\n<none>              169.29 61.307\n- am    1    26.178 195.46 63.908\n- qsec  1   109.034 278.32 75.217\n- wt    1   183.347 352.63 82.790\n```\n:::\n:::\n\n\nHere, we begin with a model including all predictors and iteratively remove the least statistically significant variables until the model no longer improves.\n\n## Both-Direction Stepwise Regression:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Initialize a model with all predictors\nboth_model <- lm(mpg ~ ., data = mtcars)\n\n# Both-direction stepwise regression\nboth_model <- step(both_model, direction = \"both\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nStart:  AIC=70.9\nmpg ~ cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb\n\n       Df Sum of Sq    RSS    AIC\n- cyl   1    0.0799 147.57 68.915\n- vs    1    0.1601 147.66 68.932\n- carb  1    0.4067 147.90 68.986\n- gear  1    1.3531 148.85 69.190\n- drat  1    1.6270 149.12 69.249\n- disp  1    3.9167 151.41 69.736\n- hp    1    6.8399 154.33 70.348\n- qsec  1    8.8641 156.36 70.765\n<none>              147.49 70.898\n- am    1   10.5467 158.04 71.108\n- wt    1   27.0144 174.51 74.280\n\nStep:  AIC=68.92\nmpg ~ disp + hp + drat + wt + qsec + vs + am + gear + carb\n\n       Df Sum of Sq    RSS    AIC\n- vs    1    0.2685 147.84 66.973\n- carb  1    0.5201 148.09 67.028\n- gear  1    1.8211 149.40 67.308\n- drat  1    1.9826 149.56 67.342\n- disp  1    3.9009 151.47 67.750\n- hp    1    7.3632 154.94 68.473\n<none>              147.57 68.915\n- qsec  1   10.0933 157.67 69.032\n- am    1   11.8359 159.41 69.384\n+ cyl   1    0.0799 147.49 70.898\n- wt    1   27.0280 174.60 72.297\n\nStep:  AIC=66.97\nmpg ~ disp + hp + drat + wt + qsec + am + gear + carb\n\n       Df Sum of Sq    RSS    AIC\n- carb  1    0.6855 148.53 65.121\n- gear  1    2.1437 149.99 65.434\n- drat  1    2.2139 150.06 65.449\n- disp  1    3.6467 151.49 65.753\n- hp    1    7.1060 154.95 66.475\n<none>              147.84 66.973\n- am    1   11.5694 159.41 67.384\n- qsec  1   15.6830 163.53 68.200\n+ vs    1    0.2685 147.57 68.915\n+ cyl   1    0.1883 147.66 68.932\n- wt    1   27.3799 175.22 70.410\n\nStep:  AIC=65.12\nmpg ~ disp + hp + drat + wt + qsec + am + gear\n\n       Df Sum of Sq    RSS    AIC\n- gear  1     1.565 150.09 63.457\n- drat  1     1.932 150.46 63.535\n<none>              148.53 65.121\n- disp  1    10.110 158.64 65.229\n- am    1    12.323 160.85 65.672\n- hp    1    14.826 163.35 66.166\n+ carb  1     0.685 147.84 66.973\n+ vs    1     0.434 148.09 67.028\n+ cyl   1     0.414 148.11 67.032\n- qsec  1    26.408 174.94 68.358\n- wt    1    69.127 217.66 75.350\n\nStep:  AIC=63.46\nmpg ~ disp + hp + drat + wt + qsec + am\n\n       Df Sum of Sq    RSS    AIC\n- drat  1     3.345 153.44 62.162\n- disp  1     8.545 158.64 63.229\n<none>              150.09 63.457\n- hp    1    13.285 163.38 64.171\n+ gear  1     1.565 148.53 65.121\n+ cyl   1     1.003 149.09 65.242\n+ vs    1     0.645 149.45 65.319\n+ carb  1     0.107 149.99 65.434\n- am    1    20.036 170.13 65.466\n- qsec  1    25.574 175.67 66.491\n- wt    1    67.572 217.66 73.351\n\nStep:  AIC=62.16\nmpg ~ disp + hp + wt + qsec + am\n\n       Df Sum of Sq    RSS    AIC\n- disp  1     6.629 160.07 61.515\n<none>              153.44 62.162\n- hp    1    12.572 166.01 62.682\n+ drat  1     3.345 150.09 63.457\n+ gear  1     2.977 150.46 63.535\n+ cyl   1     2.447 150.99 63.648\n+ vs    1     1.121 152.32 63.927\n+ carb  1     0.011 153.43 64.160\n- qsec  1    26.470 179.91 65.255\n- am    1    32.198 185.63 66.258\n- wt    1    69.043 222.48 72.051\n\nStep:  AIC=61.52\nmpg ~ hp + wt + qsec + am\n\n       Df Sum of Sq    RSS    AIC\n- hp    1     9.219 169.29 61.307\n<none>              160.07 61.515\n+ disp  1     6.629 153.44 62.162\n+ carb  1     3.227 156.84 62.864\n+ drat  1     1.428 158.64 63.229\n- qsec  1    20.225 180.29 63.323\n+ cyl   1     0.249 159.82 63.465\n+ vs    1     0.249 159.82 63.466\n+ gear  1     0.171 159.90 63.481\n- am    1    25.993 186.06 64.331\n- wt    1    78.494 238.56 72.284\n\nStep:  AIC=61.31\nmpg ~ wt + qsec + am\n\n       Df Sum of Sq    RSS    AIC\n<none>              169.29 61.307\n+ hp    1     9.219 160.07 61.515\n+ carb  1     8.036 161.25 61.751\n+ disp  1     3.276 166.01 62.682\n+ cyl   1     1.501 167.78 63.022\n+ drat  1     1.400 167.89 63.042\n+ gear  1     0.123 169.16 63.284\n+ vs    1     0.000 169.29 63.307\n- am    1    26.178 195.46 63.908\n- qsec  1   109.034 278.32 75.217\n- wt    1   183.347 352.63 82.790\n```\n:::\n:::\n\n\nIn both-direction regression, the algorithm combines both forward and backward steps, optimizing the model by adding significant variables and removing insignificant ones.\n\n#### Visualizing Data and Model Fit:\n\nNow, let's visualize the data and model fit using base R plots.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Scatter plot of mpg vs. hp\nplot(mtcars$hp, mtcars$mpg, \n     main = \"Scatter Plot of mpg vs. hp\", \n     xlab = \"hp\", ylab = \"mpg\", pch = 20\n     )\nabline(lm(mpg ~ hp, data = mtcars), col = \"black\", lwd = 2)\npoints(sort(mtcars$hp), forward_model$fitted.values, col = \"red\", pch = 20)\npoints(sort(mtcars$hp), backward_model$fitted.values, col = \"blue\", pch = 20)\npoints(sort(mtcars$hp), both_model$fitted.values, col = \"green\", pch = 20)\n\nlegend(\"topright\", legend = c(\"Forward\", \"Backward\", \"Both-Direction\"), \n       col = c(\"red\", \"blue\", \"green\"), pch = 20)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nThis plot displays the scatter plot of `mpg` against `hp` with fitted lines for each stepwise regression. The colors correspond to the models created earlier.\n\n#### Visualizing Residuals:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Residual plots for each model\npar(mfrow = c(2, 2))\n\n# Forward stepwise regression residuals\nplot(forward_model$residuals, main = \"Forward Residuals\", ylab = \"Residuals\")\n\n# Backward stepwise regression residuals\nplot(backward_model$residuals, main = \"Backward Residuals\", ylab = \"Residuals\")\n\n# Both-direction stepwise regression residuals\nplot(both_model$residuals, main = \"Both-Direction Residuals\", ylab = \"Residuals\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nThese plots help assess how well the models fit the data by examining the residuals.\n\n# Conclusion\n\nStepwise regression is a valuable tool, but it's crucial to interpret results cautiously and be aware of potential pitfalls.",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}