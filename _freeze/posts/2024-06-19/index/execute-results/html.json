{
  "hash": "092c7a0119adad982fa8b6e5f9a8dda1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Extracting Data from Another Workbook Using VBA and Executing It from R\"\nauthor: \"Steven P. Sanderson II, MPH\"\ndate: \"2024-06-19\"\ncategories: [code, rtip, vba, excel]\ntoc: TRUE\n---\n\n\n# Introduction\n\nWhen working with Excel files, you may need to extract data from one workbook and use it in another. This can be done manually by copying and pasting the data, but it can be time-consuming and error-prone, especially when dealing with large datasets. One way to automate this process is by using Visual Basic for Applications (VBA) to extract the data from one workbook and execute the VBA code from R.\n\nIn this blog post, I'll walk you through the process of extracting data from another workbook using VBA and how to execute this from R. We'll use the data in `Sheet1` from an example workbook.\n\n# Extracting Data from Another Workbook Using VBA\n\n## Step 1: Setting Up the VBA Code\n\nFirst, we need to write a VBA script that will open another workbook, extract data from `Sheet1`, and return this data. Here's a simple VBA code to accomplish this:\n\n1.    Open the VBA editor by pressing `Alt + F11`.\n2.    Insert a new module by right-clicking on any existing module or the workbook name, then selecting `Insert > Module`.\n3.    Copy and paste the following VBA code into the module:\n\n```vba\nSub ExtractData()\n    Dim sourceWorkbook As Workbook\n    Dim targetWorkbook As Workbook\n    Dim sourceSheet As Worksheet\n    Dim targetSheet As Worksheet\n    Dim sourceRange As Range\n    Dim targetRange As Range\n\n    ' Define the path to the source workbook\n    Dim sourceFilePath As String\n    sourceFilePath = \"C:\\Users\\ssanders\\Documents\\GitHub\\steveondata\\posts\\2024-06-19\\random_data.xlsx\" ' Change this to your actual file path\n\n    ' Open the source workbook\n    Set sourceWorkbook = Workbooks.Open(sourceFilePath)\n    Set sourceSheet = sourceWorkbook.Sheets(\"Sheet1\")\n    Set sourceRange = sourceSheet.Range(\"A1:B30\") ' Adjust the range as needed\n\n    ' Open the target workbook\n    Set targetWorkbook = ThisWorkbook\n    Set targetSheet = targetWorkbook.Sheets(\"Sheet1\")\n    Set targetRange = targetSheet.Range(\"A1:B30\") ' Adjust the range as needed\n\n    ' Clear the target range before pasting\n    targetRange.Clear\n\n    ' Copy the data from source to target\n    sourceRange.Copy Destination:=targetRange\n\n    ' Close the source workbook without saving\n    sourceWorkbook.Close SaveChanges:=False\n\n    ' Save and close the target workbook\n    targetWorkbook.Save\n    targetWorkbook.Close SaveChanges:=True\n    \n    ' Quit Excel\n    Application.Quit\nEnd Sub\n```\n\nThis script opens another workbook, copies the data from `Sheet1`, and pastes it into the current workbook's `Sheet1`. Modify the `sourceFilePath` to the location of your source workbook and adjust the ranges as necessary. The data was already in a workbook and thus we knew the dimensions of the data.\n\n## Step 2: Executing the VBA Code from R\n\nNow that we have the VBA code ready, let's write some R code to execute this VBA macro. We'll use the `RDCOMClient` package to interact with Excel from R.\n\n1. Install the `RDCOMClient` package if you haven't already:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"RDCOMClient\", repos = \"http://www.omegahat.net/R\")\n```\n:::\n\n\n2. Load the package and write the R code to run the VBA macro:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(RDCOMClient)\n\n# Path to your Excel workbook containing the VBA macro\nexcelFilePath <- \"C:/Users/ssanders/Documents/GitHub/steveondata/posts/2024-06-19/get_data_from_another_workbook.xlsm\"\n\n# Create a COM object to interact with Excel\nexcelApp <- COMCreate(\"Excel.Application\")\n\n# Open the workbook\nworkbook <- excelApp$Workbooks()$Open(excelFilePath)\n\n# Make Excel visible (optional)\nexcelApp[[\"Visible\"]] <- FALSE\n\n# Run the VBA macro\nexcelApp$Run(\"ExtractData\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNULL\n```\n\n\n:::\n\n```{.r .cell-code}\n# Close the workbook without saving\nworkbook$Close(FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\n# Quit Excel\nexcelApp$Quit()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNULL\n```\n\n\n:::\n\n```{.r .cell-code}\n# Release COM object\nrm(excelApp, workbook)\n```\n:::\n\n\nThis R script creates a COM object to interact with Excel, opens the workbook containing our VBA macro, runs the macro, and then quits Excel. Make sure to modify the `excelFilePath` to point to your actual workbook.\n\nNow let's see if it actually worked:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\n\nf_path <- \"C:/Users/ssanders/Documents/GitHub/steveondata/posts/2024-06-19/random_data.xlsx\"\nread_excel(f_path, sheet = \"Sheet1\", col_names = FALSE) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNew names:\n• `` -> `...1`\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 30 × 1\n     ...1\n    <dbl>\n 1 -0.371\n 2 -1.00 \n 3  0.226\n 4 -0.323\n 5 -0.142\n 6  1.19 \n 7 -0.827\n 8  0.715\n 9 -0.105\n10 -1.06 \n# ℹ 20 more rows\n```\n\n\n:::\n:::\n\n\n# Conclusion\n\nIn this post, we've covered how to set up a VBA macro to extract data from another workbook and how to execute this macro from R using the `RDCOMClient` package. This approach allows you to leverage the power of VBA for Excel automation while controlling the process from R, providing a seamless integration between the two environments.\n\nFeel free to adjust the VBA code and R script to suit your specific needs. Happy coding!\n\n---\n\nFor more information on integrating R with other tools, check out my other posts at www.spsanderson.com/steveondata/.\n\nIf you have any questions or run into issues, don't hesitate to reach out on LinkedIn or Mastodon. Let's keep the conversation going!",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}