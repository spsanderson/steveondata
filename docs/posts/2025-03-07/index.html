<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Steven P. Sanderson II, MPH">
<meta name="dcterms.date" content="2025-03-07">
<meta name="keywords" content="Programming, Top-Down Design, Linux Programming, Shell Functions, Bash Scripting, Code Organization, System Information Script, Modular Code, Local Variables in Bash, Shell Scripting Best Practices, Debugging Shell Scripts, How to implement top-down design in Linux, Benefits of using shell functions in Bash, Step-by-step guide to writing Linux scripts, Understanding local variables in Bash functions, Tips for organizing code in Linux shell scripts">
<meta name="description" content="“Learn top-down design in Linux programming with beginner-friendly examples. Master shell functions, decompose complex problems, and write cleaner, more maintainable code.”">

<title>Top-Down Design in Linux: Simplifying Complex Programming Tasks – Steve’s Data Tips and Tricks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JSJCM62KQJ"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-JSJCM62KQJ', { 'anonymize_ip': true});
</script>
<meta name="quarto:status" content="draft">


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Top-Down Design in Linux: Simplifying Complex Programming Tasks – Steve’s Data Tips and Tricks">
<meta property="og:description" content="“Learn top-down design in Linux programming with beginner-friendly examples. Master shell functions, decompose complex problems, and write cleaner, more maintainable code.”">
<meta property="og:site_name" content="Steve's Data Tips and Tricks">
<meta name="twitter:title" content="Top-Down Design in Linux: Simplifying Complex Programming Tasks – Steve’s Data Tips and Tricks">
<meta name="twitter:description" content="“Learn top-down design in Linux programming with beginner-friendly examples. Master shell functions, decompose complex problems, and write cleaner, more maintainable code.”">
<meta name="twitter:creator" content="@steveondata">
<meta name="twitter:site" content="@steveondata">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div>
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Steve’s Data Tips and Tricks</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/spsanderson"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://t.me/steveondata"> <i class="bi bi-telegram" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="http://feeds.feedburner.com/RBloggers"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.r-bloggers.com/"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.r-users.com/"> <i class="bi bi-briefcase" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Top-Down Design in Linux: Simplifying Complex Programming Tasks</h1>
                  <div>
        <div class="description">
          “Learn top-down design in Linux programming with beginner-friendly examples. Master shell functions, decompose complex problems, and write cleaner, more maintainable code.”
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">code</div>
                <div class="quarto-category">linux</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Steven P. Sanderson II, MPH </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 7, 2025</p>
      </div>
    </div>
    
      
    </div>
    

  <div>
    <div class="keywords">
      <div class="block-title">Keywords</div>
      <p>Programming, Top-Down Design, Linux Programming, Shell Functions, Bash Scripting, Code Organization, System Information Script, Modular Code, Local Variables in Bash, Shell Scripting Best Practices, Debugging Shell Scripts, How to implement top-down design in Linux, Benefits of using shell functions in Bash, Step-by-step guide to writing Linux scripts, Understanding local variables in Bash functions, Tips for organizing code in Linux shell scripts</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#what-is-top-down-design" id="toc-what-is-top-down-design" class="nav-link" data-scroll-target="#what-is-top-down-design">What Is Top-Down Design?</a>
  <ul class="collapse">
  <li><a href="#the-everyday-analogy" id="toc-the-everyday-analogy" class="nav-link" data-scroll-target="#the-everyday-analogy">The Everyday Analogy</a></li>
  </ul></li>
  <li><a href="#why-top-down-design-works-well-for-linux-shell-programming" id="toc-why-top-down-design-works-well-for-linux-shell-programming" class="nav-link" data-scroll-target="#why-top-down-design-works-well-for-linux-shell-programming">Why Top-Down Design Works Well for Linux Shell Programming</a></li>
  <li><a href="#shell-functions-the-building-blocks-of-top-down-design" id="toc-shell-functions-the-building-blocks-of-top-down-design" class="nav-link" data-scroll-target="#shell-functions-the-building-blocks-of-top-down-design">Shell Functions: The Building Blocks of Top-Down Design</a>
  <ul class="collapse">
  <li><a href="#basic-syntax-of-shell-functions" id="toc-basic-syntax-of-shell-functions" class="nav-link" data-scroll-target="#basic-syntax-of-shell-functions">Basic Syntax of Shell Functions</a></li>
  <li><a href="#a-simple-function-example" id="toc-a-simple-function-example" class="nav-link" data-scroll-target="#a-simple-function-example">A Simple Function Example</a></li>
  </ul></li>
  <li><a href="#practical-application-building-a-system-information-page" id="toc-practical-application-building-a-system-information-page" class="nav-link" data-scroll-target="#practical-application-building-a-system-information-page">Practical Application: Building a System Information Page</a>
  <ul class="collapse">
  <li><a href="#step-1-define-the-high-level-tasks" id="toc-step-1-define-the-high-level-tasks" class="nav-link" data-scroll-target="#step-1-define-the-high-level-tasks">Step 1: Define the High-Level Tasks</a></li>
  <li><a href="#step-2-create-the-initial-script-structure" id="toc-step-2-create-the-initial-script-structure" class="nav-link" data-scroll-target="#step-2-create-the-initial-script-structure">Step 2: Create the Initial Script Structure</a></li>
  <li><a href="#step-3-implement-each-function" id="toc-step-3-implement-each-function" class="nav-link" data-scroll-target="#step-3-implement-each-function">Step 3: Implement Each Function</a></li>
  <li><a href="#step-4-test-the-script" id="toc-step-4-test-the-script" class="nav-link" data-scroll-target="#step-4-test-the-script">Step 4: Test the Script</a></li>
  </ul></li>
  <li><a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn">Your Turn!</a></li>
  <li><a href="#the-power-of-local-variables-in-shell-functions" id="toc-the-power-of-local-variables-in-shell-functions" class="nav-link" data-scroll-target="#the-power-of-local-variables-in-shell-functions">The Power of Local Variables in Shell Functions</a>
  <ul class="collapse">
  <li><a href="#global-vs.-local-variables" id="toc-global-vs.-local-variables" class="nav-link" data-scroll-target="#global-vs.-local-variables">Global vs.&nbsp;Local Variables</a></li>
  <li><a href="#defining-local-variables" id="toc-defining-local-variables" class="nav-link" data-scroll-target="#defining-local-variables">Defining Local Variables</a></li>
  <li><a href="#practical-example-enhanced-home-space-report" id="toc-practical-example-enhanced-home-space-report" class="nav-link" data-scroll-target="#practical-example-enhanced-home-space-report">Practical Example: Enhanced Home Space Report</a></li>
  </ul></li>
  <li><a href="#keeping-scripts-running-during-development" id="toc-keeping-scripts-running-during-development" class="nav-link" data-scroll-target="#keeping-scripts-running-during-development">Keeping Scripts Running During Development</a>
  <ul class="collapse">
  <li><a href="#using-stub-functions-during-development" id="toc-using-stub-functions-during-development" class="nav-link" data-scroll-target="#using-stub-functions-during-development">Using Stub Functions During Development</a></li>
  <li><a href="#incremental-development" id="toc-incremental-development" class="nav-link" data-scroll-target="#incremental-development">Incremental Development</a></li>
  </ul></li>
  <li><a href="#shell-functions-beyond-scripts" id="toc-shell-functions-beyond-scripts" class="nav-link" data-scroll-target="#shell-functions-beyond-scripts">Shell Functions Beyond Scripts</a>
  <ul class="collapse">
  <li><a href="#adding-functions-to-your-.bashrc" id="toc-adding-functions-to-your-.bashrc" class="nav-link" data-scroll-target="#adding-functions-to-your-.bashrc">Adding Functions to Your .bashrc</a></li>
  <li><a href="#functions-vs.-aliases" id="toc-functions-vs.-aliases" class="nav-link" data-scroll-target="#functions-vs.-aliases">Functions vs.&nbsp;Aliases</a></li>
  </ul></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key Takeaways</a></li>
  <li><a href="#troubleshooting-common-issues" id="toc-troubleshooting-common-issues" class="nav-link" data-scroll-target="#troubleshooting-common-issues">Troubleshooting Common Issues</a>
  <ul class="collapse">
  <li><a href="#function-not-found" id="toc-function-not-found" class="nav-link" data-scroll-target="#function-not-found">Function Not Found</a></li>
  <li><a href="#unexpected-variable-values" id="toc-unexpected-variable-values" class="nav-link" data-scroll-target="#unexpected-variable-values">Unexpected Variable Values</a></li>
  <li><a href="#script-works-differently-as-root" id="toc-script-works-differently-as-root" class="nav-link" data-scroll-target="#script-works-differently-as-root">Script Works Differently As Root</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#faqs" id="toc-faqs" class="nav-link" data-scroll-target="#faqs">FAQs</a>
  <ul class="collapse">
  <li><a href="#what-is-the-main-benefit-of-top-down-design-for-beginners" id="toc-what-is-the-main-benefit-of-top-down-design-for-beginners" class="nav-link" data-scroll-target="#what-is-the-main-benefit-of-top-down-design-for-beginners">What is the main benefit of top-down design for beginners?</a></li>
  <li><a href="#can-i-use-shell-functions-in-any-linux-shell" id="toc-can-i-use-shell-functions-in-any-linux-shell" class="nav-link" data-scroll-target="#can-i-use-shell-functions-in-any-linux-shell">Can I use shell functions in any Linux shell?</a></li>
  <li><a href="#how-do-i-decide-what-should-be-its-own-function" id="toc-how-do-i-decide-what-should-be-its-own-function" class="nav-link" data-scroll-target="#how-do-i-decide-what-should-be-its-own-function">How do I decide what should be its own function?</a></li>
  <li><a href="#how-can-i-debug-shell-functions" id="toc-how-can-i-debug-shell-functions" class="nav-link" data-scroll-target="#how-can-i-debug-shell-functions">How can I debug shell functions?</a></li>
  <li><a href="#are-there-limits-to-how-many-functions-i-can-have-in-a-script" id="toc-are-there-limits-to-how-many-functions-i-can-have-in-a-script" class="nav-link" data-scroll-target="#are-there-limits-to-how-many-functions-i-can-have-in-a-script">Are there limits to how many functions I can have in a script?</a></li>
  <li><a href="#top-down-design-in-linux" id="toc-top-down-design-in-linux" class="nav-link" data-scroll-target="#top-down-design-in-linux"><img src="todays_post.png" class="img-fluid" alt="Top Down Design in Linux"></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><em>Author’s Note: I’m learning Linux as I write this series, so there may be mistakes along the way. If you spot any errors or have suggestions for improvement, please share them in the comments. We’re on this learning journey together!</em></p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Have you ever stared at a complex programming task and felt completely overwhelmed? You know what needs to be done, but the path from start to finish seems impossibly complicated. If so, you’re not alone! This is a common challenge for all programmers, especially those new to Linux.</p>
<p>In this article, we’ll explore a powerful problem-solving approach called <strong>top-down design</strong> that’s particularly well-suited to Linux shell programming. You’ll learn how to break daunting tasks into manageable pieces, use shell functions to organize your code, and create scripts that are easier to write, debug, and maintain.</p>
<p>By the end of this guide, you’ll have practical knowledge of: - The fundamentals of top-down design philosophy - How to implement shell functions in bash scripts - Working with local variables for modular code - Best practices for script development and testing</p>
<p>Let’s dive in and demystify top-down design in Linux!</p>
</section>
<section id="what-is-top-down-design" class="level1">
<h1>What Is Top-Down Design?</h1>
<p>Top-down design is a programming approach that starts with the big picture and progressively breaks it down into smaller, more manageable components. Think of it as tackling a complex problem by dividing it into several simpler problems, then solving each one separately.</p>
<section id="the-everyday-analogy" class="level2">
<h2 class="anchored" data-anchor-id="the-everyday-analogy">The Everyday Analogy</h2>
<p>To understand this concept, let’s consider an everyday task: going to the market to buy food. At the highest level, we might describe the process as:</p>
<ol type="1">
<li>Get in car</li>
<li>Drive to market</li>
<li>Park car</li>
<li>Enter market</li>
<li>Purchase food</li>
<li>Return to car</li>
<li>Drive home</li>
<li>Park car</li>
<li>Enter house</li>
</ol>
<p>But each of these steps can be broken down further. For example, “Park car” could be divided into:</p>
<ol type="1">
<li>Find parking space</li>
<li>Drive car into space</li>
<li>Turn off motor</li>
<li>Set parking brake</li>
<li>Exit car</li>
<li>Lock car</li>
</ol>
<p>And we could continue breaking things down even further. “Turn off motor” might include “Turn off ignition,” “Remove ignition key,” and so on.</p>
<p>This is exactly how top-down design works in programming. You start with the overall task and keep breaking it down until each subtask is simple enough to be easily implemented.</p>
</section>
</section>
<section id="why-top-down-design-works-well-for-linux-shell-programming" class="level1">
<h1>Why Top-Down Design Works Well for Linux Shell Programming</h1>
<p>Linux shell programming is particularly suited to top-down design for several reasons:</p>
<ol type="1">
<li><strong>Shell scripts often coordinate system commands</strong> - Much like our “going to market” example coordinates a series of activities</li>
<li><strong>Linux philosophy favors simple, focused tools</strong> - Each doing one thing well (similar to our detailed subtasks)</li>
<li><strong>Shell functions provide a natural way to implement subtasks</strong> - Making code organization straightforward</li>
</ol>
<p>Let’s see how to apply this approach in a real Linux shell script!</p>
</section>
<section id="shell-functions-the-building-blocks-of-top-down-design" class="level1">
<h1>Shell Functions: The Building Blocks of Top-Down Design</h1>
<p>Shell functions are “mini-scripts” within your main script. They serve as self-contained units that perform specific tasks, making them perfect for implementing the subtasks identified through top-down design.</p>
<section id="basic-syntax-of-shell-functions" class="level2">
<h2 class="anchored" data-anchor-id="basic-syntax-of-shell-functions">Basic Syntax of Shell Functions</h2>
<p>There are two equivalent ways to define a shell function in bash:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 1</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> name</span> <span class="kw">{</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">commands</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 2</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">name ()</span> <span class="kw">{</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">commands</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Both forms work exactly the same way - choose whichever style you prefer for consistency.</p>
</section>
<section id="a-simple-function-example" class="level2">
<h2 class="anchored" data-anchor-id="a-simple-function-example">A Simple Function Example</h2>
<p>Let’s see a basic example of how functions work:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Shell function demo</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> say_hello</span> <span class="kw">{</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Hello, world!"</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Main program starts here</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Starting program"</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="ex">say_hello</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Program finished"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When you run this script, it will output:</p>
<pre><code>Starting program
Hello, world!
Program finished</code></pre>
<p>The execution flow is straightforward: 1. The shell reads the entire script but doesn’t execute the function definition 2. Execution begins with the first command after the function definition 3. When the function is called, execution jumps to the function body 4. After the function completes (or encounters <code>return</code>), execution resumes where it left off</p>
</section>
</section>
<section id="practical-application-building-a-system-information-page" class="level1">
<h1>Practical Application: Building a System Information Page</h1>
<p>Let’s apply top-down design to a real-world example: creating a script that generates an HTML report about your system.</p>
<section id="step-1-define-the-high-level-tasks" class="level2">
<h2 class="anchored" data-anchor-id="step-1-define-the-high-level-tasks">Step 1: Define the High-Level Tasks</h2>
<p>At the highest level, our script needs to: 1. Create the HTML document structure 2. Generate a title and header 3. Report system uptime 4. Report disk space usage 5. Report home directory space usage 6. Close the HTML document</p>
</section>
<section id="step-2-create-the-initial-script-structure" class="level2">
<h2 class="anchored" data-anchor-id="step-2-create-the-initial-script-structure">Step 2: Create the Initial Script Structure</h2>
<p>Using top-down design, we’ll first create a script with “stub” functions - empty placeholders that we’ll fill in later:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Program to output a system information page</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="va">TITLE</span><span class="op">=</span><span class="st">"System Information Report For </span><span class="va">$HOSTNAME</span><span class="st">"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="va">CURRENT_TIME</span><span class="op">=</span><span class="va">$(</span><span class="fu">date</span> +<span class="st">"%x %r %Z"</span><span class="va">)</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="va">TIMESTAMP</span><span class="op">=</span><span class="st">"Generated </span><span class="va">$CURRENT_TIME</span><span class="st">, by </span><span class="va">$USER</span><span class="st">"</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">report_uptime ()</span> <span class="kw">{</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">report_disk_space ()</span> <span class="kw">{</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">report_home_space ()</span> <span class="kw">{</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;&lt; _EOF_</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;HTML&gt;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;HEAD&gt;</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;TITLE&gt;</span><span class="va">$TITLE</span><span class="st">&lt;/TITLE&gt;</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/HEAD&gt;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;BODY&gt;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;H1&gt;</span><span class="va">$TITLE</span><span class="st">&lt;/H1&gt;</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;P&gt;</span><span class="va">$TIMESTAMP</span><span class="st">&lt;/P&gt;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="va">$(</span><span class="ex">report_uptime</span><span class="va">)</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="va">$(</span><span class="ex">report_disk_space</span><span class="va">)</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="va">$(</span><span class="ex">report_home_space</span><span class="va">)</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/BODY&gt;</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/HTML&gt;</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="op">_EOF_</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This script outlines the overall structure but doesn’t yet implement the individual information-gathering functions.</p>
</section>
<section id="step-3-implement-each-function" class="level2">
<h2 class="anchored" data-anchor-id="step-3-implement-each-function">Step 3: Implement Each Function</h2>
<p>Now, we’ll implement each function one by one:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report_uptime ()</span> <span class="kw">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span> <span class="op">&lt;&lt;- _EOF_</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;H2&gt;System Uptime&lt;/H2&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;PRE&gt;</span><span class="va">$(</span><span class="fu">uptime</span><span class="va">)</span><span class="st">&lt;/PRE&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="st">    _EOF_</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="st">    return</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="st">report_disk_space () {</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="st">    cat &lt;&lt;- _EOF_</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;H2&gt;Disk Space Utilization&lt;/H2&gt;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;PRE&gt;</span><span class="va">$(</span><span class="fu">df</span> <span class="at">-h</span><span class="va">)</span><span class="st">&lt;/PRE&gt;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="st">    _EOF_</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="st">    return</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="st">report_home_space () {</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="st">    cat &lt;&lt;- _EOF_</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;H2&gt;Home Space Utilization&lt;/H2&gt;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;PRE&gt;</span><span class="va">$(</span><span class="fu">du</span> <span class="at">-sh</span> /home/<span class="pp">*</span><span class="va">)</span><span class="st">&lt;/PRE&gt;</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="st">    _EOF_</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="st">    return</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Each function now handles a specific part of the report generation. Let’s break down what’s happening:</p>
<ol type="1">
<li><code>report_uptime</code> uses the <code>uptime</code> command to show system uptime</li>
<li><code>report_disk_space</code> uses <code>df -h</code> to show disk usage in human-readable format</li>
<li><code>report_home_space</code> uses <code>du -sh</code> to show home directory sizes</li>
</ol>
</section>
<section id="step-4-test-the-script" class="level2">
<h2 class="anchored" data-anchor-id="step-4-test-the-script">Step 4: Test the Script</h2>
<p>When we run this script, it produces a complete HTML document with system information sections. Each function contributes its part to the final output.</p>
</section>
</section>
<section id="your-turn" class="level1">
<h1>Your Turn!</h1>
<p>Now that you understand the basics of top-down design and shell functions, let’s try a small exercise. Imagine you want to create a script that backs up important files. Break down this task into high-level steps, then further break down one of those steps.</p>
<details>
<summary>
See Solution
</summary>
<p>High-level steps for a backup script: 1. Define which files/directories to back up 2. Create a timestamp for the backup 3. Create a backup destination 4. Copy files to the backup location 5. Verify the backup completed successfully 6. Log the backup details</p>
<p>Breaking down step 4 (Copy files): 1. Check if source files/directories exist 2. Create target directory structure if needed 3. Copy files preserving permissions 4. Handle errors if files cannot be copied</p>
<p>This could be implemented with shell functions:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">backup_files ()</span> <span class="kw">{</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if source exists</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">[[</span> <span class="ot">!</span> <span class="ot">-e</span> <span class="va">$SOURCE</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">"Error: Source </span><span class="va">$SOURCE</span><span class="st"> does not exist"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create target directory if needed</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mkdir</span> <span class="at">-p</span> <span class="va">$DEST</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Copy files with permissions</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cp</span> <span class="at">-rp</span> <span class="va">$SOURCE</span> <span class="va">$DEST</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for errors</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">[[</span> <span class="va">$?</span> <span class="ot">-eq</span> 0 <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">"Backup completed successfully"</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">"Backup failed"</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">2</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="the-power-of-local-variables-in-shell-functions" class="level1">
<h1>The Power of Local Variables in Shell Functions</h1>
<p>One key aspect of effective top-down design is the independence of each component. In shell scripts, we achieve this using local variables within our functions.</p>
<section id="global-vs.-local-variables" class="level2">
<h2 class="anchored" data-anchor-id="global-vs.-local-variables">Global vs.&nbsp;Local Variables</h2>
<p>By default, variables in bash scripts are global, meaning they can be accessed from anywhere in the script. While convenient, this can lead to problems when different parts of your script unintentionally interfere with each other.</p>
<p>Local variables solve this problem by limiting a variable’s scope to the function in which it’s defined. This prevents functions from accidentally modifying variables used elsewhere.</p>
</section>
<section id="defining-local-variables" class="level2">
<h2 class="anchored" data-anchor-id="defining-local-variables">Defining Local Variables</h2>
<p>To create a local variable, simply prefix the variable name with the <code>local</code> keyword:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_function ()</span> <span class="kw">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">my_variable</span><span class="op">=</span><span class="st">"This is local"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Inside function: </span><span class="va">$my_variable</span><span class="st">"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="va">my_variable</span><span class="op">=</span><span class="st">"This is global"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Before function: </span><span class="va">$my_variable</span><span class="st">"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="ex">my_function</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"After function: </span><span class="va">$my_variable</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Running this script would output:</p>
<pre><code>Before function: This is global
Inside function: This is local
After function: This is global</code></pre>
<p>The function’s local variable doesn’t affect the global variable with the same name!</p>
</section>
<section id="practical-example-enhanced-home-space-report" class="level2">
<h2 class="anchored" data-anchor-id="practical-example-enhanced-home-space-report">Practical Example: Enhanced Home Space Report</h2>
<p>Let’s improve our <code>report_home_space</code> function using local variables:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report_home_space ()</span> <span class="kw">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">home_dirs</span><span class="op">=</span><span class="va">$(</span><span class="fu">ls</span> <span class="at">-d</span> /home/<span class="pp">*</span><span class="va">)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">total_size</span><span class="op">=</span>0</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span> <span class="op">&lt;&lt;- _EOF_</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;H2&gt;Home Space Utilization&lt;/H2&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;PRE&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="st">    _EOF_</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="st">    for dir in </span><span class="va">$home_dirs</span><span class="st">; do</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="st">        local user=</span><span class="va">$(</span><span class="fu">basename</span> <span class="st">"</span><span class="va">$dir</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="st">        local size=</span><span class="va">$(</span><span class="fu">du</span> <span class="at">-sh</span> <span class="st">"</span><span class="va">$dir</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span><span class="va">)</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="st">        echo "User </span><span class="va">$user</span><span class="st">: </span><span class="va">$size</span><span class="st">"</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="st">        # In a real script, we'd add code to calculate total_size</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="st">    done</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="st">    echo "&lt;/PRE&gt;"</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="st">    return</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By using local variables, this function won’t interfere with any other part of the script that might use variables with the same names.</p>
</section>
</section>
<section id="keeping-scripts-running-during-development" class="level1">
<h1>Keeping Scripts Running During Development</h1>
<p>When developing using top-down design, it’s important to keep your script in a runnable state. This allows you to test frequently and catch errors early.</p>
<section id="using-stub-functions-during-development" class="level2">
<h2 class="anchored" data-anchor-id="using-stub-functions-during-development">Using Stub Functions During Development</h2>
<p>Remember those empty functions we created earlier? These are called “stubs” - placeholder functions that do nothing yet but allow the script to run without errors.</p>
<p>As you develop, it’s helpful to add feedback to your stubs:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report_uptime ()</span> <span class="kw">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Function report_uptime executed."</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This way, when you run your script, you can confirm that the function is being called correctly, even before implementing its actual functionality.</p>
</section>
<section id="incremental-development" class="level2">
<h2 class="anchored" data-anchor-id="incremental-development">Incremental Development</h2>
<p>The top-down approach naturally leads to incremental development:</p>
<ol type="1">
<li>First, outline the overall program structure</li>
<li>Create stub functions for each component</li>
<li>Test that the basic structure works</li>
<li>Implement and test each function one by one</li>
<li>Refine and integrate the functions</li>
</ol>
<p>This methodical approach makes debugging much easier since you’re only changing a small part of the code at a time.</p>
</section>
</section>
<section id="shell-functions-beyond-scripts" class="level1">
<h1>Shell Functions Beyond Scripts</h1>
<p>Shell functions aren’t limited to scripts - you can also use them in your interactive shell sessions!</p>
<section id="adding-functions-to-your-.bashrc" class="level2">
<h2 class="anchored" data-anchor-id="adding-functions-to-your-.bashrc">Adding Functions to Your .bashrc</h2>
<p>You can define useful functions in your <code>~/.bashrc</code> file to create custom commands:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to your .bashrc</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds ()</span> <span class="kw">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Disk Space Utilization For </span><span class="va">$HOSTNAME</span><span class="st">"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">df</span> <span class="at">-h</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After sourcing your <code>.bashrc</code> or opening a new terminal, you can simply type <code>ds</code> to check disk space - much more convenient than remembering the full <code>df -h</code> command and its options.</p>
</section>
<section id="functions-vs.-aliases" class="level2">
<h2 class="anchored" data-anchor-id="functions-vs.-aliases">Functions vs.&nbsp;Aliases</h2>
<p>While bash aliases are useful for simple command substitutions, shell functions offer several advantages:</p>
<ol type="1">
<li>Functions can contain multiple commands</li>
<li>Functions can use control structures (if/else, loops)</li>
<li>Functions can process arguments more flexibly</li>
<li>Functions can use local variables</li>
</ol>
<p>When deciding between an alias and a function, choose a function if your command needs any logic or complexity.</p>
</section>
</section>
<section id="key-takeaways" class="level1">
<h1>Key Takeaways</h1>
<ul>
<li><strong>Top-down design</strong> breaks complex problems into manageable subtasks, making programming more approachable</li>
<li><strong>Shell functions</strong> create modular components that implement individual subtasks</li>
<li><strong>Local variables</strong> make functions independent and reusable</li>
<li><strong>Stub functions</strong> allow for incremental development and testing</li>
<li><strong>Development best practices</strong> include keeping scripts runnable and testing frequently</li>
<li><strong>Shell functions in .bashrc</strong> extend their usefulness beyond scripts</li>
</ul>
</section>
<section id="troubleshooting-common-issues" class="level1">
<h1>Troubleshooting Common Issues</h1>
<section id="function-not-found" class="level2">
<h2 class="anchored" data-anchor-id="function-not-found">Function Not Found</h2>
<p>If you see an error like <code>function_name: command not found</code>, check that: 1. The function is defined before it’s called in the script 2. There are no syntax errors in the function definition 3. The function name is spelled correctly</p>
</section>
<section id="unexpected-variable-values" class="level2">
<h2 class="anchored" data-anchor-id="unexpected-variable-values">Unexpected Variable Values</h2>
<p>If variables aren’t behaving as expected: 1. Check if you meant to use a local variable but forgot the <code>local</code> keyword 2. Verify variable names for typos 3. Use <code>echo</code> statements to debug variable values</p>
</section>
<section id="script-works-differently-as-root" class="level2">
<h2 class="anchored" data-anchor-id="script-works-differently-as-root">Script Works Differently As Root</h2>
<p>Some commands (like the <code>du</code> example in <code>report_home_space</code>) may behave differently depending on user permissions. Always consider how your script will behave when run by different users.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Top-down design is a powerful approach for Linux shell programming that helps you tackle complex problems systematically. By breaking large tasks into small, manageable functions and using local variables to keep those functions independent, you can create scripts that are easier to write, debug, and maintain.</p>
<p>The next time you face a daunting programming task, remember to start by thinking about the big picture, then progressively refine each component until the entire solution becomes clear. This methodical approach will serve you well not only in Linux shell programming but in many other programming languages and environments.</p>
<p>Ready to keep learning? In the next article, we’ll explore how to make our scripts more adaptable by responding to different user privileges and system environments.</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ol type="1">
<li><a href="https://en.wikipedia.org/wiki/Top-down_design">Wikipedia: Top-down Design</a></li>
<li><a href="https://en.wikipedia.org/wiki/Subroutines">Wikipedia: Subroutines</a></li>
<li><a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Functions.html">GNU Bash Manual: Shell Functions</a></li>
<li><a href="https://tldp.org/LDP/abs/html/functions.html">Linux Documentation Project: Advanced Bash-Scripting Guide</a></li>
<li><a href="https://help.ubuntu.com/community/Beginners/BashScripting">Ubuntu Documentation: Shell Scripting</a></li>
</ol>
</section>
<section id="faqs" class="level1">
<h1>FAQs</h1>
<section id="what-is-the-main-benefit-of-top-down-design-for-beginners" class="level2">
<h2 class="anchored" data-anchor-id="what-is-the-main-benefit-of-top-down-design-for-beginners">What is the main benefit of top-down design for beginners?</h2>
<p>Top-down design helps beginners by breaking overwhelming tasks into smaller, more manageable pieces. This makes it easier to know where to start and how to make progress on complex problems.</p>
</section>
<section id="can-i-use-shell-functions-in-any-linux-shell" class="level2">
<h2 class="anchored" data-anchor-id="can-i-use-shell-functions-in-any-linux-shell">Can I use shell functions in any Linux shell?</h2>
<p>While the examples in this article use bash syntax, most shells support functions, though the exact syntax may vary. Bash, zsh, ksh, and many others all support shell functions.</p>
</section>
<section id="how-do-i-decide-what-should-be-its-own-function" class="level2">
<h2 class="anchored" data-anchor-id="how-do-i-decide-what-should-be-its-own-function">How do I decide what should be its own function?</h2>
<p>A good rule of thumb is to create a function when a task is logically separate, might be reused, or makes your script more readable. If a section of code is longer than 15-20 lines or performs a distinct operation, it’s often a good candidate for a function.</p>
</section>
<section id="how-can-i-debug-shell-functions" class="level2">
<h2 class="anchored" data-anchor-id="how-can-i-debug-shell-functions">How can I debug shell functions?</h2>
<p>You can add <code>echo</code> statements to track execution flow, use <code>set -x</code> to enable bash trace mode, or implement error checking with conditional statements and meaningful error messages.</p>
</section>
<section id="are-there-limits-to-how-many-functions-i-can-have-in-a-script" class="level2">
<h2 class="anchored" data-anchor-id="are-there-limits-to-how-many-functions-i-can-have-in-a-script">Are there limits to how many functions I can have in a script?</h2>
<p>While technically there’s no hard limit, script readability and maintainability should guide you. If your script has dozens of functions, consider whether it should be split into multiple scripts.</p>
<hr>
<p><em>Did you find this guide to top-down design in Linux helpful? Share your thoughts and experiences in the comments below, or connect with me from one of the below to continue the conversation!</em></p>
<hr>
<p>Happy Coding! 🚀</p>
</section>
<section id="top-down-design-in-linux" class="level2">
<h2 class="anchored" data-anchor-id="top-down-design-in-linux"><img src="todays_post.png" class="img-fluid" alt="Top Down Design in Linux"></h2>
<p><em>You can connect with me at any one of the below</em>:</p>
<p><em>Telegram Channel here</em>: <a href="https://t.me/steveondata" class="uri">https://t.me/steveondata</a></p>
<p><em>LinkedIn Network here</em>: <a href="https://www.linkedin.com/in/spsanderson/" class="uri">https://www.linkedin.com/in/spsanderson/</a></p>
<p><em>Mastadon Social here</em>: <a href="https://mstdn.social/@stevensanderson">https://mstdn.social/@stevensanderson</a></p>
<p><em>RStats Network here</em>: <a href="https://rstats.me/@spsanderson">https://rstats.me/@spsanderson</a></p>
<p><em>GitHub Network here</em>: <a href="https://github.com/spsanderson" class="uri">https://github.com/spsanderson</a></p>
<p><em>Bluesky Network here</em>: <a href="https://bsky.app/profile/spsanderson.com" class="uri">https://bsky.app/profile/spsanderson.com</a></p>
<p><em>My Book: Extending Excel with Python and R</em> here: <a href="https://packt.link/oTyZJ" class="uri">https://packt.link/oTyZJ</a></p>
<p><em>You.com Referral Link</em>: <a href="https://you.com/join/EHSLDTL6" class="uri">https://you.com/join/EHSLDTL6</a></p>
<hr>
<script src="https://giscus.app/client.js" data-repo="spsanderson/steveondata" data-repo-id="R_kgDOIIxnLw" data-category="Comments" data-category-id="DIC_kwDOIIxnL84ChTk8" data-mapping="url" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="dark" data-lang="en" data-loading="lazy" crossorigin="anonymous" async="">
</script>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.spsanderson\.com\/steveondata\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>