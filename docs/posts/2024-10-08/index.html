<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Steven P. Sanderson II, MPH">
<meta name="dcterms.date" content="2024-10-08">
<meta name="keywords" content="Programming">

<title>How to Combine Two Columns into One in R With Examples in Base R and tidyr â€“ Steveâ€™s Data Tips and Tricks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JSJCM62KQJ"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-JSJCM62KQJ', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="How to Combine Two Columns into One in R With Examples in Base R and tidyr â€“ Steveâ€™s Data Tips and Tricks">
<meta property="og:description" content="">
<meta property="og:site_name" content="Steve's Data Tips and Tricks">
<meta name="twitter:title" content="How to Combine Two Columns into One in R With Examples in Base R and tidyr â€“ Steveâ€™s Data Tips and Tricks">
<meta name="twitter:description" content="">
<meta name="twitter:creator" content="@steveondata">
<meta name="twitter:site" content="@steveondata">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Steveâ€™s Data Tips and Tricks</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/spsanderson"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://t.me/steveondata"> <i class="bi bi-telegram" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="http://feeds.feedburner.com/RBloggers"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.r-bloggers.com/"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.r-users.com/"> <i class="bi bi-briefcase" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">How to Combine Two Columns into One in R With Examples in Base R and tidyr</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">code</div>
                <div class="quarto-category">rtip</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Steven P. Sanderson II, MPH </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 8, 2024</p>
      </div>
    </div>
    
      
    </div>
    

  <div>
    <div class="keywords">
      <div class="block-title">Keywords</div>
      <p>Programming</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#understanding-the-need-to-combine-columns-in-r" id="toc-understanding-the-need-to-combine-columns-in-r" class="nav-link" data-scroll-target="#understanding-the-need-to-combine-columns-in-r">Understanding the Need to Combine Columns in R</a></li>
  <li><a href="#basic-concepts-data-frames-and-columns-in-r" id="toc-basic-concepts-data-frames-and-columns-in-r" class="nav-link" data-scroll-target="#basic-concepts-data-frames-and-columns-in-r">Basic Concepts: Data Frames and Columns in R</a></li>
  <li><a href="#methods-to-combine-two-columns-in-base-r" id="toc-methods-to-combine-two-columns-in-base-r" class="nav-link" data-scroll-target="#methods-to-combine-two-columns-in-base-r">Methods to Combine Two Columns in Base R</a>
  <ul class="collapse">
  <li><a href="#using-the-paste-function" id="toc-using-the-paste-function" class="nav-link" data-scroll-target="#using-the-paste-function">Using the paste() function</a></li>
  <li><a href="#using-the-sprintf-function" id="toc-using-the-sprintf-function" class="nav-link" data-scroll-target="#using-the-sprintf-function">Using the sprintf() function</a></li>
  <li><a href="#using-the-unite-function-from-tidyr" id="toc-using-the-unite-function-from-tidyr" class="nav-link" data-scroll-target="#using-the-unite-function-from-tidyr">Using the unite() function from tidyr</a></li>
  </ul></li>
  <li><a href="#combining-columns-with-tidyr" id="toc-combining-columns-with-tidyr" class="nav-link" data-scroll-target="#combining-columns-with-tidyr">Combining Columns with tidyr</a>
  <ul class="collapse">
  <li><a href="#introduction-to-tidyr" id="toc-introduction-to-tidyr" class="nav-link" data-scroll-target="#introduction-to-tidyr">Introduction to tidyr</a></li>
  <li><a href="#using-unite-function-in-tidyr" id="toc-using-unite-function-in-tidyr" class="nav-link" data-scroll-target="#using-unite-function-in-tidyr">Using unite() function in tidyr</a></li>
  <li><a href="#advanced-unite-options" id="toc-advanced-unite-options" class="nav-link" data-scroll-target="#advanced-unite-options">Advanced unite() options</a></li>
  </ul></li>
  <li><a href="#handling-different-data-types-when-combining-columns" id="toc-handling-different-data-types-when-combining-columns" class="nav-link" data-scroll-target="#handling-different-data-types-when-combining-columns">Handling Different Data Types When Combining Columns</a></li>
  <li><a href="#best-practices-for-column-combination-in-r" id="toc-best-practices-for-column-combination-in-r" class="nav-link" data-scroll-target="#best-practices-for-column-combination-in-r">Best Practices for Column Combination in R</a></li>
  <li><a href="#common-errors-and-troubleshooting" id="toc-common-errors-and-troubleshooting" class="nav-link" data-scroll-target="#common-errors-and-troubleshooting">Common Errors and Troubleshooting</a></li>
  <li><a href="#real-world-applications-of-column-combination-in-r" id="toc-real-world-applications-of-column-combination-in-r" class="nav-link" data-scroll-target="#real-world-applications-of-column-combination-in-r">Real-world Applications of Column Combination in R</a></li>
  <li><a href="#performance-considerations" id="toc-performance-considerations" class="nav-link" data-scroll-target="#performance-considerations">Performance Considerations</a></li>
  <li><a href="#try-it-yourself-and-share-your-experience" id="toc-try-it-yourself-and-share-your-experience" class="nav-link" data-scroll-target="#try-it-yourself-and-share-your-experience">Try It Yourself and Share Your Experience</a></li>
  <li><a href="#share-your-thoughts" id="toc-share-your-thoughts" class="nav-link" data-scroll-target="#share-your-thoughts">Share Your Thoughts</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#faqs" id="toc-faqs" class="nav-link" data-scroll-target="#faqs">FAQs</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>As a beginner R programmer, youâ€™ll often encounter situations where you need to manipulate data frames by combining columns. This article will guide you through the process of combining two columns into one in R, using both base R functions and the tidyr package. Weâ€™ll provide clear examples and explanations to help you master this essential skill.</p>
</section>
<section id="understanding-the-need-to-combine-columns-in-r" class="level1">
<h1>Understanding the Need to Combine Columns in R</h1>
<p>Combining columns in R is a common operation when working with data frames. This technique is useful in various scenarios, such as:</p>
<ol type="1">
<li>Creating full names from first and last name columns</li>
<li>Generating unique identifiers by combining multiple fields</li>
<li>Consolidating related information for easier analysis</li>
</ol>
<p>By learning how to combine columns effectively, youâ€™ll be able to streamline your data preprocessing and analysis workflows.</p>
</section>
<section id="basic-concepts-data-frames-and-columns-in-r" class="level1">
<h1>Basic Concepts: Data Frames and Columns in R</h1>
<p>Before diving into the methods of combining columns, letâ€™s review some fundamental concepts:</p>
<ul>
<li><strong>Data Frame</strong>: A two-dimensional table-like structure in R that can hold different types of data.</li>
<li><strong>Column</strong>: A vertical series of data in a data frame, typically representing a specific variable or attribute.</li>
</ul>
<p>Understanding these concepts is crucial for manipulating data in R effectively.</p>
</section>
<section id="methods-to-combine-two-columns-in-base-r" class="level1">
<h1>Methods to Combine Two Columns in Base R</h1>
<p>R provides several built-in functions to combine columns without requiring additional packages. Letâ€™s explore three common methods:</p>
<section id="using-the-paste-function" class="level2">
<h2 class="anchored" data-anchor-id="using-the-paste-function">Using the paste() function</h2>
<p>The <code>paste()</code> function is a versatile tool for combining strings in R. Hereâ€™s how you can use it to combine two columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a sample data frame</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">first_name =</span> <span class="fu">c</span>(<span class="st">"John"</span>, <span class="st">"Jane"</span>, <span class="st">"Mike"</span>),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">last_name =</span> <span class="fu">c</span>(<span class="st">"Doe"</span>, <span class="st">"Smith"</span>, <span class="st">"Johnson"</span>))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine first_name and last_name columns</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>full_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(df<span class="sc">$</span>first_name, df<span class="sc">$</span>last_name)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># View the result</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  first_name last_name    full_name
1       John       Doe     John Doe
2       Jane     Smith   Jane Smith
3       Mike   Johnson Mike Johnson</code></pre>
</div>
</div>
<p>This code will create a new column called <code>full_name</code> that combines the <code>first_name</code> and <code>last_name</code> columns.</p>
</section>
<section id="using-the-sprintf-function" class="level2">
<h2 class="anchored" data-anchor-id="using-the-sprintf-function">Using the sprintf() function</h2>
<p>The <code>sprintf()</code> function allows for more formatted string combinations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine columns with a specific format</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>formatted_name <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%s, %s"</span>, df<span class="sc">$</span>last_name, df<span class="sc">$</span>first_name)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View the result</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  first_name last_name    full_name formatted_name
1       John       Doe     John Doe      Doe, John
2       Jane     Smith   Jane Smith    Smith, Jane
3       Mike   Johnson Mike Johnson  Johnson, Mike</code></pre>
</div>
</div>
<p>This method is particularly useful when you need to combine columns in a specific format or with additional text.</p>
</section>
<section id="using-the-unite-function-from-tidyr" class="level2">
<h2 class="anchored" data-anchor-id="using-the-unite-function-from-tidyr">Using the unite() function from tidyr</h2>
<p>Although <code>unite()</code> is part of the tidyr package, it can be used in base R by loading the package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Unite first_name and last_name columns</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>df_united <span class="ot">&lt;-</span> <span class="fu">unite</span>(df, full_name, first_name, last_name, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the result</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_united)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     full_name formatted_name
1     John Doe      Doe, John
2   Jane Smith    Smith, Jane
3 Mike Johnson  Johnson, Mike</code></pre>
</div>
</div>
<p>The <code>unite()</code> function is a convenient way to combine multiple columns into one.</p>
</section>
</section>
<section id="combining-columns-with-tidyr" class="level1">
<h1>Combining Columns with tidyr</h1>
<section id="introduction-to-tidyr" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-tidyr">Introduction to tidyr</h2>
<p>tidyr is a powerful package for data tidying in R. It provides functions that help you create tidy data, where each variable is in a column, each observation is in a row, and each value is in a cell.</p>
</section>
<section id="using-unite-function-in-tidyr" class="level2">
<h2 class="anchored" data-anchor-id="using-unite-function-in-tidyr">Using unite() function in tidyr</h2>
<p>The <code>unite()</code> function from tidyr is specifically designed for combining multiple columns into one. Hereâ€™s how to use it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a sample data frame</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">city =</span> <span class="fu">c</span>(<span class="st">"New York"</span>, <span class="st">"Los Angeles"</span>, <span class="st">"Chicago"</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">state =</span> <span class="fu">c</span>(<span class="st">"NY"</span>, <span class="st">"CA"</span>, <span class="st">"IL"</span>),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">zip =</span> <span class="fu">c</span>(<span class="st">"10001"</span>, <span class="st">"90001"</span>, <span class="st">"60601"</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Unite city and state columns</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>df_united <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(location, city, state, <span class="at">sep =</span> <span class="st">", "</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># View the result</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_united)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         location   zip
1    New York, NY 10001
2 Los Angeles, CA 90001
3     Chicago, IL 60601</code></pre>
</div>
</div>
<p>This code will create a new column called <code>location</code> that combines the <code>city</code> and <code>state</code> columns with a comma and space separator.</p>
</section>
<section id="advanced-unite-options" class="level2">
<h2 class="anchored" data-anchor-id="advanced-unite-options">Advanced unite() options</h2>
<p>The <code>unite()</code> function offers additional options for more complex column combinations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unite multiple columns and remove original columns</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df_united_advanced <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(full_address, city, state, zip, <span class="at">sep =</span> <span class="st">", "</span>, <span class="at">remove =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># View the result</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_united_advanced)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            full_address
1    New York, NY, 10001
2 Los Angeles, CA, 90001
3     Chicago, IL, 60601</code></pre>
</div>
</div>
<p>This example combines three columns into one and removes the original columns from the data frame.</p>
</section>
</section>
<section id="handling-different-data-types-when-combining-columns" class="level1">
<h1>Handling Different Data Types When Combining Columns</h1>
<p>When combining columns, you may encounter different data types. Hereâ€™s how to handle common scenarios:</p>
<ol type="1">
<li><strong>Numeric and character columns</strong>: Convert numeric columns to characters before combining.</li>
<li><strong>Factor columns</strong>: Convert factors to characters using <code>as.character()</code> before combining.</li>
<li><strong>Date columns</strong>: Format dates as strings before combining with other columns.</li>
</ol>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Charlie"</span>),</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">joined_date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2022-01-01"</span>, <span class="st">"2022-02-15"</span>, <span class="st">"2022-03-30"</span>)))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>info <span class="ot">&lt;-</span> <span class="fu">paste</span>(df<span class="sc">$</span>name, <span class="st">"is"</span>, df<span class="sc">$</span>age, <span class="st">"years old and joined on"</span>, <span class="fu">format</span>(df<span class="sc">$</span>joined_date, <span class="st">"%B %d, %Y"</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name age joined_date                                                 info
1   Alice  25  2022-01-01 Alice is 25 years old and joined on January 01, 2022
2     Bob  30  2022-02-15  Bob is 30 years old and joined on February 15, 2022
3 Charlie  35  2022-03-30 Charlie is 35 years old and joined on March 30, 2022</code></pre>
</div>
</div>
</section>
<section id="best-practices-for-column-combination-in-r" class="level1">
<h1>Best Practices for Column Combination in R</h1>
<p>To ensure efficient and maintainable code when combining columns in R:</p>
<ol type="1">
<li>Use descriptive names for new columns</li>
<li>Consider the appropriate separator for your data</li>
<li>Handle missing values appropriately (e.g., using <code>na.rm = TRUE</code> in <code>paste()</code>)</li>
<li>Document your code with comments explaining the purpose of column combinations</li>
</ol>
</section>
<section id="common-errors-and-troubleshooting" class="level1">
<h1>Common Errors and Troubleshooting</h1>
<p>When combining columns, you might encounter these common issues:</p>
<ol type="1">
<li><strong>Mismatched column lengths</strong>: Ensure all columns have the same number of rows.</li>
<li><strong>Data type mismatches</strong>: Convert columns to compatible types before combining.</li>
<li><strong>Unexpected NA values</strong>: Handle missing values explicitly in your code.</li>
</ol>
</section>
<section id="real-world-applications-of-column-combination-in-r" class="level1">
<h1>Real-world Applications of Column Combination in R</h1>
<p>Combining columns has various practical applications in data analysis:</p>
<ol type="1">
<li><strong>Customer data management</strong>: Creating full addresses from separate fields.</li>
<li><strong>Financial analysis</strong>: Combining date and transaction ID for unique identifiers.</li>
<li><strong>Scientific research</strong>: Merging species and location data for ecological studies.</li>
</ol>
</section>
<section id="performance-considerations" class="level1">
<h1>Performance Considerations</h1>
<p>When working with large datasets, consider these performance tips:</p>
<ol type="1">
<li>Use vectorized operations (like <code>paste()</code>) instead of loops</li>
<li>For very large datasets, consider data.table or dplyr for improved performance</li>
<li>Profile your code to identify bottlenecks in column combination operations</li>
</ol>
</section>
<section id="try-it-yourself-and-share-your-experience" class="level1">
<h1>Try It Yourself and Share Your Experience</h1>
<p>Now that youâ€™ve learned various methods to combine columns in R, itâ€™s time to put your knowledge into practice! We encourage you to experiment with these techniques using your own datasets or by creating sample data frames. Here are a few suggestions to get you started:</p>
<ol type="1">
<li>Create a data frame with different types of information (e.g., names, ages, cities) and try combining them using different methods.</li>
<li>Experiment with various separators in the <code>paste()</code> and <code>unite()</code> functions to see how they affect the output.</li>
<li>Challenge yourself by combining columns with mixed data types and handling any errors that arise.</li>
<li>Try to recreate some of the real-world applications mentioned earlier using sample data.</li>
</ol>
<p>As you work through these exercises, you may discover new insights or encounter interesting challenges. Weâ€™d love to hear about your experiences!</p>
</section>
<section id="share-your-thoughts" class="level1">
<h1>Share Your Thoughts</h1>
<p>Once youâ€™ve had a chance to practice, we invite you to share your experiences in the comment section below. Here are some prompts to consider:</p>
<ul>
<li>Which method did you find most intuitive for combining columns?</li>
<li>Did you encounter any unexpected issues? How did you resolve them?</li>
<li>Can you think of any other real-world scenarios where combining columns would be useful?</li>
<li>Do you have any tips or tricks for efficient column combination that werenâ€™t covered in this article?</li>
</ul>
<p>Your comments and questions not only help us improve our content but also create a valuable resource for other R learners. Donâ€™t hesitate to share your successes, challenges, or any creative solutions youâ€™ve developed.</p>
<p>Remember, learning is a collaborative process, and your input can make a significant difference to fellow R enthusiasts. We look forward to reading your comments and engaging in insightful discussions about combining columns in R!</p>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Combining two columns into one in R is a fundamental skill for data manipulation. Whether youâ€™re using base R functions or the tidyr package, you now have the tools to efficiently combine columns in your data frames. Practice these techniques with your own datasets to become proficient in R data manipulation.</p>
</section>
<section id="faqs" class="level1">
<h1>FAQs</h1>
<ol type="1">
<li><p><strong>Q: Can I combine more than two columns at once?</strong> A: Yes, you can use functions like <code>paste()</code> or <code>unite()</code> to combine multiple columns simultaneously.</p></li>
<li><p><strong>Q: How do I handle missing values when combining columns?</strong> A: Use the <code>na.rm = TRUE</code> option in <code>unite()</code> to handle missing values.</p></li>
<li><p><strong>Q: Whatâ€™s the difference between <code>paste()</code> and <code>paste0()</code>?</strong> A: <code>paste0()</code> is a shorthand for <code>paste()</code> with <code>sep = ""</code>, meaning it concatenates strings without any separator.</p></li>
<li><p><strong>Q: Can I combine columns of different data types?</strong> A: Yes, but you may need to convert them to a common type (usually character) before combining.</p></li>
<li><p><strong>Q: How can I split a combined column back into separate columns?</strong> A: You can use the <code>separate()</code> function from tidyr to split a combined column into multiple columns.</p></li>
</ol>
<p>We hope this guide helps you master the art of combining columns in R.</p>
<hr>
<p>Happy coding! ðŸš€</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="todays_post.PNG" class="img-fluid figure-img"></p>
<figcaption>Uniting Columns in R</figcaption>
</figure>
</div>
<script src="https://giscus.app/client.js" data-repo="spsanderson/steveondata" data-repo-id="R_kgDOIIxnLw" data-category="Comments" data-category-id="DIC_kwDOIIxnL84ChTk8" data-mapping="url" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="dark" data-lang="en" data-loading="lazy" crossorigin="anonymous" async="">
</script>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.spsanderson\.com\/steveondata\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>