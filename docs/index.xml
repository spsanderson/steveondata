<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Steve&#39;s Data Tips and Tricks</title>
<link>https://www.spsanderson.com/steveondata/index.html</link>
<atom:link href="https://www.spsanderson.com/steveondata/index.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.3.450</generator>
<lastBuildDate>Fri, 29 Dec 2023 05:00:00 GMT</lastBuildDate>
<item>
  <title>Unlocking the Power of Time: Transforming Data Frames into Time Series in R</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-12-29/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Hey there, fellow R enthusiasts! Today, we’re diving into the realm of time series, where data dances along the temporal dimension. To join this rhythmic analysis, we’ll first learn how to convert our trusty data frames into time series objects—the heart of time-based exploration in R.</p>
</section>
<section id="ready-to-time-warp-lets-get-started" class="level1">
<h1>Ready to Time Warp? Let’s Get Started!</h1>
<section id="gather-your-data" class="level2">
<h2 class="anchored" data-anchor-id="gather-your-data">1. Gather Your Data</h2>
<p>Every journey begins with preparation. Here’s our sample data frame containing daily sales:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2022-01-01'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,</span>
<span id="cb1-2">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sales =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</div>
</section>
<section id="choose-your-time-series-destination" class="level2">
<h2 class="anchored" data-anchor-id="choose-your-time-series-destination">2. Choose Your Time Series Destination</h2>
<p>R offers two primary time series classes:</p>
<ul>
<li><strong>“ts”:</strong> Base R’s classic time series object, designed for regularly spaced data.</li>
<li><strong>“xts”:</strong> Part of the ‘xts’ package, offering enhanced flexibility and features.</li>
</ul>
</section>
<section id="embark-on-the-conversion-quest" class="level2">
<h2 class="anchored" data-anchor-id="embark-on-the-conversion-quest">3. Embark on the Conversion Quest</h2>
<p><strong>A. Transforming into “ts”:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(stats)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Package for 'ts' class</span></span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Unleash the time series magic!</span></span>
<span id="cb2-4">ts_sales <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ts</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sales, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">frequency =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Daily data</span></span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Admire your creation:</span></span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(ts_sales)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = c(2022, 1) 
End = c(2022, 10) 
Frequency = 365 
 [1] 2728.713 3026.967 2769.227 2928.872 3401.730 3129.780 3303.479 3414.551
 [9] 3584.525 3922.348</code></pre>
</div>
</div>
<p><strong>Explanation:</strong></p>
<ul>
<li><code>ts()</code> function creates the time series object.</li>
<li><code>df$sales</code> specifies the data for conversion.</li>
<li><code>start = c(2022, 1)</code> sets the starting year and month.</li>
<li><code>frequency = 365</code> indicates daily observations (365 days per year).</li>
</ul>
<p><strong>B. Shaping into “xts”:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(xts)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Package for 'xts' class</span></span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Time to shine!</span></span>
<span id="cb4-4">xts_sales <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xts</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sales, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order.by =</span> df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>date)</span>
<span id="cb4-5"></span>
<span id="cb4-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Behold your masterpiece:</span></span>
<span id="cb4-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(xts_sales)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               [,1]
2022-01-01 2728.713
2022-01-02 3026.967
2022-01-03 2769.227
2022-01-04 2928.872
2022-01-05 3401.730
2022-01-06 3129.780
2022-01-07 3303.479
2022-01-08 3414.551
2022-01-09 3584.525
2022-01-10 3922.348</code></pre>
</div>
</div>
<p><strong>Explanation:</strong></p>
<ul>
<li><code>xts()</code> function constructs the time series object.</li>
<li><code>df$sales</code> provides the data.</li>
<li><code>order.by = df$date</code> sets the time-based ordering.</li>
</ul>
<p><strong>4. Your Time to Experiment!</strong></p>
<p>Now that you’ve mastered the conversion, unleash your creativity:</p>
<ul>
<li>Visualize trends with plots.</li>
<li>Forecast future values.</li>
<li>Analyze patterns and seasonality.</li>
<li>Decompose time series into components.</li>
<li>And much more!</li>
</ul>
<p>The possibilities are as boundless as time itself.</p>
<p><strong>Remember:</strong></p>
<ul>
<li>Choose the time series class that best suits your analysis needs.</li>
<li>Always ensure your data frame has a column with valid date or time values.</li>
<li>Explore the rich functionalities of R’s time series packages.</li>
</ul>
<p>Happy time series adventures!</p>


</section>
</section>

 ]]></description>
  <category>rtip</category>
  <category>timeseries</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-12-29/index.html</guid>
  <pubDate>Fri, 29 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Unveiling the Time Traveler: Plotting Time Series in R</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-12-28/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p><strong>Ready to journey through time with R?</strong> Buckle up, because we’re about to explore the art of visualizing time-dependent data, known as time series analysis. Whether you’re tracking monthly sales patterns or analyzing yearly climate trends, R has your back with powerful tools to visualize these stories through time.</p>
<p><strong>Our Flight Plan:</strong></p>
<ol type="1">
<li><strong>Loading Up with Data:</strong> Grabbing our trusty dataset, AirPassengers.</li>
<li><strong>Taking Off with Base R:</strong> Creating a basic time series plot using base R functions.</li>
<li><strong>Soaring with ggplot2:</strong> Crafting a visually stunning time series plot using the ggplot2 library.</li>
<li><strong>Navigating Date Formatting:</strong> Customizing axis labels with scale_x_date() for clarity.</li>
<li><strong>Landing with Your Own Exploration:</strong> Encouraging you to take the controls and create your own time series plots!</li>
</ol>
<p><strong>1. Ready for Takeoff: Loading Data</strong></p>
<p>We’ll start by loading the built-in AirPassengers dataset, which chronicles monthly passenger totals from 1949 to 1960:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">AirPassengers</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
1949 112 118 132 129 121 135 148 148 136 119 104 118
1950 115 126 141 135 125 149 170 170 158 133 114 140
1951 145 150 178 163 172 178 199 199 184 162 146 166
1952 171 180 193 181 183 218 230 242 209 191 172 194
1953 196 196 236 235 229 243 264 272 237 211 180 201
1954 204 188 235 227 234 264 302 293 259 229 203 229
1955 242 233 267 269 270 315 364 347 312 274 237 278
1956 284 277 317 313 318 374 413 405 355 306 271 306
1957 315 301 356 348 355 422 465 467 404 347 305 336
1958 340 318 362 348 363 435 491 505 404 359 310 337
1959 360 342 406 396 420 472 548 559 463 407 362 405
1960 417 391 419 461 472 535 622 606 508 461 390 432</code></pre>
</div>
</div>
<p><strong>2. Base R: The Simple and Straightforward Route</strong></p>
<p>Base R offers a direct path to creating a time series plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(AirPassengers)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-28/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This generates a basic line plot, revealing an upward trend in air passengers over time.</p>
<p><strong>3. ggplot2: The High-Flying, Visually Staggering Journey</strong></p>
<p>For more customization and visual appeal, we’ll turn to the ggplot2 library and the healthyR.ts library to first convert the AirPassengers Data set into a tibble:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(healthyR.ts)</span>
<span id="cb4-4"></span>
<span id="cb4-5">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ts_to_tbl</span>(AirPassengers)</span>
<span id="cb4-6"></span>
<span id="cb4-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date_col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Monthly Air Passengers (1949-1960)"</span>,</span>
<span id="cb4-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>,</span>
<span id="cb4-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Passengers"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-28/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This creates a more refined plot with informative labels and a sleeker aesthetic.</p>
<p><strong>4. Mastering Time with scale_x_date()</strong></p>
<p>To fine-tune the x-axis date labels, ggplot2 offers the versatile scale_x_date() function. Let’s display years and abbreviated months:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date_col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_labels =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%b %Y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Monthly Air Passengers (1949-1960)"</span>,</span>
<span id="cb5-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Passengers"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-28/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>5. Your Turn to Pilot: Experiment and Explore!</strong></p>
<p>R is your playground for time series visualization! Try these challenges:</p>
<ul>
<li>Explore other time series datasets in R.</li>
<li>Customize plots further with colors, themes, and annotations.</li>
<li>Use scale_x_date() to display different date formats.</li>
<li>Combine multiple time series in a single plot.</li>
</ul>
<p>Unleash your creativity and uncover the captivating stories hidden within time series data! For a start here are some resources:</p>
<ul>
<li><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date()</a></li>
</ul>
<p>The <code>scale_x_date()</code> functiontakes the following arguments:</p>
<ul>
<li>%d: Day as a number between 0 and 31</li>
<li>%a: Abbreviated weekday (e.g.&nbsp;“Tue”)</li>
<li>%A: Unabbreviated weekday (e.g.&nbsp;“Tuesday”)</li>
<li>%m: Month between 0 and 12</li>
<li>%b: Abbreviated month (e.g.&nbsp;“Jan”)</li>
<li>%B: Unabbreviated month (e.g.&nbsp;“January”)</li>
<li>%y: 2-digit year (e.g.&nbsp;“21”)</li>
<li>%Y: 4-digit year (e.g.&nbsp;“2021”)</li>
<li>%W: Week of the year between 0 and 52</li>
</ul>


</section>

 ]]></description>
  <category>rtip</category>
  <category>timeseries</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-12-28/index.html</guid>
  <pubDate>Thu, 28 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Creating Time Series in R with the ts() Function</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-12-27/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Time series analysis is a powerful tool in the hands of a data scientist or analyst. It allows us to uncover patterns, trends, and insights hidden within temporal data. In this blog post, we’ll explore how to create a time series in R using the base R function <code>ts()</code>.</p>
</section>
<section id="the-ts-function" class="level1">
<h1>The ts() Function</h1>
<p>The <code>ts()</code> function in R is a fundamental tool for handling time series data. It takes four main arguments:</p>
<ol type="1">
<li><strong>data:</strong> A vector or matrix of time series values.</li>
<li><strong>start:</strong> The time of the first observation.</li>
<li><strong>end:</strong> The time of the last observation.</li>
<li><strong>frequency:</strong> The number of observations per unit of time.</li>
</ol>
<p>Let’s dive into a practical example. Suppose we have a vector <code>sales</code> representing monthly sales data for a year. We can create a time series object using the <code>ts()</code> function as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sample data</span></span>
<span id="cb1-2">sales <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">280</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">320</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">350</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">380</span>)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Creating a time series</span></span>
<span id="cb1-5">sales_ts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ts</span>(</span>
<span id="cb1-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> sales, </span>
<span id="cb1-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb1-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>), </span>
<span id="cb1-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">frequency =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span></span>
<span id="cb1-10">  )</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Display the time series</span></span>
<span id="cb1-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(sales_ts)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
2022 120 150 200 180 250 300 280 320 400 350 300 380</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(sales_ts)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-27/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This example creates a monthly time series for sales data throughout the year 2022.</p>
</section>
<section id="try-it-out" class="level1">
<h1>Try it out!</h1>
<p>Creating time series in R is a hands-on task. I encourage you to pick a dataset relevant to your interests or work and follow the same steps. You can use various time frequencies (e.g., daily, weekly, monthly) depending on your data.</p>
</section>
<section id="bonus-using-convert_to_ts-from-tidydensity" class="level1">
<h1>Bonus: Using <code>convert_to_ts()</code> from TidyDensity</h1>
<p>Now, let’s explore a bonus section discussing the <code>convert_to_ts()</code> function from TidyDensity. This function is designed to convert data in a data frame or tibble into a time series format. It works seamlessly with data generated from tidy_distribution functions.</p>
<section id="convert_to_ts-function-details" class="level2">
<h2 class="anchored" data-anchor-id="convert_to_ts-function-details"><code>convert_to_ts()</code> Function Details</h2>
<p>The <code>convert_to_ts()</code> function takes the following arguments:</p>
<ul>
<li><strong>.data:</strong> A data frame or tibble to be converted into a time series format.</li>
<li><strong>.return_ts:</strong> A logical value indicating whether to return the time series data. Default is TRUE.</li>
<li><strong>.pivot_longer:</strong> A logical value indicating whether to pivot the data into long format. Default is FALSE.</li>
</ul>
</section>
<section id="how-it-works" class="level2">
<h2 class="anchored" data-anchor-id="how-it-works">How It Works</h2>
<ol type="1">
<li>The function checks if the input is a data frame or tibble; otherwise, it raises an error.</li>
<li>It verifies if the data comes from a tidy_distribution function; otherwise, it raises an error.</li>
<li>The data is then converted into a time series format, grouping it by “sim_number” and transforming the “y” column into a time series.</li>
</ol>
</section>
<section id="example-usage" class="level2">
<h2 class="anchored" data-anchor-id="example-usage">Example Usage</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(TidyDensity)</span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Assuming you have a tidy data frame 'tidy_data'</span></span>
<span id="cb4-4">tidy_time_series <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">convert_to_ts</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy_normal</span>(), </span>
<span id="cb4-5">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.return_ts =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, </span>
<span id="cb4-6">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.pivot_longer =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb4-7"></span>
<span id="cb4-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Display the result</span></span>
<span id="cb4-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(tidy_time_series)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              y
[1,] -2.1617445
[2,]  0.7630891
[3,]  0.1951564
[4,]  1.0558584
[5,] -1.5169866
[6,] -1.4532770</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(tidy_time_series)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-27/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">multiple_simulations_series <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">convert_to_ts</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy_normal</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.num_sims =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb7-2">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.return_ts =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, </span>
<span id="cb7-3">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.pivot_longer =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb7-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(multiple_simulations_series)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              1          2           3           4          5          6
[1,]  0.6591429  1.0850380 -1.41562870 -0.59330831 -0.2680326  0.6516654
[2,] -1.7456947 -0.5792555  0.95670979  0.35232047  1.3702818 -1.0709930
[3,]  0.2665711 -2.1701118  2.18141262  0.25480605  1.5762242 -0.8022482
[4,]  0.3128563  0.4328502  0.55082256  0.06628991  0.7984409  0.3048087
[5,]  0.6763225 -0.3997367 -0.09709908  1.13736623  1.0121689  0.3383476
[6,] -0.1086352  1.3522350 -1.00235321  0.14722832  1.3395307 -0.1026343
              7          8          9         10
[1,] -0.1113009  1.6959992 -1.1897814 -0.2290430
[2,] -0.7512943 -0.6969146  1.1334643  0.7554655
[3,]  1.0782559  0.5296079 -1.0057891  1.1089107
[4,] -1.8030557  1.5021519  0.7094383 -1.0848102
[5,] -0.5539205  0.7127801 -1.3130555 -0.6742046
[6,] -0.7625295 -1.1712384  0.8147821  0.8036737</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(multiple_simulations_series)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-27/index_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">convert_to_ts</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy_normal</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.num_sims =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb10-2">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.return_ts =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, </span>
<span id="cb10-3">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.pivot_longer =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 10
       `1`    `2`    `3`      `4`    `5`    `6`     `7`    `8`     `9`   `10`
     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1  1.34    0.300  0.475 -3.07     1.35   1.18   0.403  -0.104 -0.347  -0.590
 2  0.153  -0.563 -1.28  -0.0429   0.354  1.24  -0.184   0.850  0.338  -0.700
 3 -0.448   0.160 -1.22   0.600   -0.532 -0.357 -0.759   0.659  0.691  -0.778
 4  0.0384 -1.38  -0.918  1.12    -1.09   0.949  0.0276  0.456  0.510   1.10 
 5 -0.0148 -0.663  0.401  0.00200 -0.790 -1.98   0.714   0.613  0.658   1.02 
 6  0.528   0.164 -0.104 -0.977   -0.889 -0.589  1.39    0.916  0.496   0.326
 7  1.08   -1.21   0.116  0.685    1.22   0.132  0.608  -0.322 -1.06   -0.624
 8 -0.620   1.45   0.666 -1.39    -1.20  -0.175  0.0665  1.21   1.95   -0.237
 9 -0.143  -1.93  -0.683  0.603   -1.24   0.623 -0.564  -0.417  0.0639  1.34 
10  0.125   0.869 -1.47   0.953    0.608 -1.80   0.272   1.16   1.17   -1.09 
# ℹ 40 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">convert_to_ts</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy_normal</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.num_sims =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb12-2">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.pivot_longer =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 1 
End = 50 
Frequency = 1 
              1            2           3           4           5           6
 1 -0.655132170  1.124119928 -1.68015013  0.27119005 -1.34222309 -0.85029821
 2 -0.563753358  0.148496529 -0.08420323  0.52425342 -0.22838128  0.38009238
 3  0.162642987  0.944409541 -0.31995660  1.62739294  0.04586743 -1.00996184
 4 -1.946332513  1.693491637 -0.76559306  2.58711915 -0.67796334  0.73113802
 5  0.009260305  0.563304432 -0.90409541 -0.74206033  1.18933630  1.19979835
 6  0.422154075 -0.827368569  0.38440082  1.58106342  0.53744939 -0.01699670
 7  0.672312916  1.917586521  0.18758750  0.52812847  0.04987565  0.42471806
 8 -0.099748356  0.548332963 -0.44544054 -0.74466540  0.27741779  0.03754982
 9  0.599374087  2.416047894  0.13083797 -0.71925129  1.46397148  0.21928699
10  2.137103506  1.012679620  0.10946528 -1.21309250 -0.40298312 -0.06149162
11 -0.584328794 -0.977150553  1.98763118  0.80100807  1.59761439  0.96962954
12 -0.977410854  0.153227900 -0.89588458 -0.04738268 -0.99671233 -0.79875286
13  0.348559098 -0.139254894  0.17014759 -0.41635428  1.16343543  0.45536856
14  2.050755613  0.379570270 -1.57943509 -0.49670553 -0.49108776 -0.81654431
15 -0.536403083  0.815378564  0.44909230 -0.17645908  2.14187118  0.85912010
16  0.154173100 -0.009842145 -0.06548799  1.36411289 -0.26842334  1.69185208
17  0.526008171 -1.021411558 -0.01515875 -0.39923678 -1.91505446  1.47060381
18 -0.382628412  1.554043999 -0.99083886  0.03813862 -0.12122244  0.78097490
19  0.068027520  1.559917873  1.56624132 -0.72556821  0.04364763 -1.08713622
20 -0.375312760  0.182453162 -0.29118413  0.63647087  1.14593859  0.33562580
21  0.527199674  0.514358677 -0.85199804 -0.65959289  1.34991539 -0.88580797
22  0.606739583 -0.349281940 -0.42159565 -0.29988202  0.86897866  0.83607508
23 -0.750044523 -0.721098218  0.81759595  1.81533167  1.67514533  0.49723656
24 -0.167121348  1.050352702  1.70669358 -2.78197517  0.70872919 -1.19627981
25 -0.442427162 -0.009639385  0.66120474  0.07333735  0.39692306  2.72030582
26 -0.405109397 -0.463937639  2.92697938  0.64263562 -0.59588190  1.27812303
27  0.554957737  1.508452736 -0.67384362 -1.14296113  0.25859866 -0.09516432
28 -0.167333762 -0.154519359  1.29634414  2.05276305  1.22046958 -0.20261165
29 -0.426751358  0.299516899 -0.10270470  0.45218446 -1.01077778  0.41069225
30 -0.915369502 -1.134302489 -0.45195412 -0.02372924 -0.87979497 -2.22429752
31  0.398618595 -0.246544276  0.63197257  0.04685569  0.46524825 -0.41017315
32  0.001083079 -0.530058643  0.82139589  0.39120899  0.63881495  0.63570075
33 -0.502176823 -0.642359996  0.42880920 -0.44803379 -0.01992917  0.38896456
34  0.276462923 -1.042478900  1.14313112 -1.55697201  0.52390061  0.07794736
35  0.923405153 -0.237080174  0.96970857  0.86964379 -0.91567940 -0.63612591
36 -0.400504232  0.217544505 -0.63904106  0.91258477 -0.01156312 -0.41156245
37  0.458010625 -1.456299801 -0.95303905 -1.01123779 -0.04321204 -0.84060963
38 -0.202664022 -0.729410616  1.10544600 -1.54460728  0.48443033 -0.67777269
39  0.041503245 -0.610875862 -0.45167645 -0.47658183 -2.46133081  0.26514433
40 -0.121966128 -0.265657879 -0.40754380  0.41665215 -3.23015392 -0.11733447
41  2.275054279 -0.140453274  1.01738854  1.08335318 -0.72963796 -0.07750213
42  0.305032329 -0.912897889 -0.54486760 -0.06350812  0.35661866 -0.89575613
43 -0.097368038  0.879480923  0.42349178  0.90800105  1.22592750 -1.93884437
44 -0.053250772  0.590070911 -0.04377062  0.38001642 -0.56422962 -1.55652310
45 -0.631346970  0.510970484  1.03953655 -0.52313314  0.66643930 -0.50328900
46 -0.573835910  0.662271162 -0.94615866 -1.09348403  1.51469795  0.02769026
47  2.056373176 -1.438372766  0.64932666 -1.17330573  0.41932438  1.53009528
48 -2.353078785  0.487698963 -0.81844578 -0.92462341  0.27244456  0.42617475
49 -3.231722103 -1.271841203  0.24348256 -1.36611307 -0.97603663 -1.95217754
50  0.753719680 -0.366101153 -0.01044950 -1.59566595  0.08057617  1.11583833
              7            8            9           10
 1  0.171342136 -1.143037486  0.798526236 -0.244110488
 2 -0.940732995 -0.098286237 -0.002464059 -1.329350897
 3 -0.694053671 -0.861938231 -0.981141759 -0.016408426
 4  0.715770296  0.891107430 -1.631236257 -0.812448587
 5 -1.487322100  1.513993297  1.034899433 -1.562309837
 6 -2.299581079 -1.372057771  1.141053483 -0.523175745
 7 -1.551226431  0.584053401 -0.124530500  1.386795935
 8  0.199088420  0.176433940  0.896122531  0.150326444
 9 -2.610686399  1.619626479 -0.304107194  1.999026100
10  0.993024200 -1.717659646 -0.936505161  0.249643134
11  0.242493969 -1.104745018  2.139557395  1.308248416
12  1.438262730 -0.371852512 -0.367182295 -1.589296525
13 -0.149204186 -1.054119573 -0.465127766  0.423034528
14  1.199604760 -0.295676868  1.818224237  1.651671457
15  0.682116022  1.589055554  0.940553190  0.044546697
16 -0.023887103 -0.544176304  0.078750649 -1.618718807
17  0.783402254 -0.024077038  1.530981707  0.610937582
18  0.840292783 -0.781554633  0.177714516 -0.059345413
19 -1.313595307 -1.101811653  0.057190918  0.067426355
20  0.005232829  0.145444788  1.066697084  1.068481723
21 -0.554820885  0.380379950 -0.162190910  1.185489015
22 -0.861222004  0.030283953  0.908438632 -0.231394452
23  1.157935009  0.063995477  2.361496504 -0.396326692
24 -0.897071507  0.369621973 -0.266053668 -0.131590687
25  0.035629927 -0.084923255  0.003248558 -0.368614537
26  0.509364566 -1.832084693  0.890542325  0.888462980
27  1.207424021 -2.671878721  0.063299112 -0.878590418
28  0.211237171  1.535283026  0.759650387  0.549046140
29 -0.595276048 -2.514556134  0.445083701 -0.769968392
30  1.348793576  0.004755218 -0.301946343 -2.037938159
31  0.361619164 -1.340745382 -0.706048393 -0.003291719
32  0.014851985 -0.249794267  0.741063865 -0.398728564
33 -1.172677388 -0.193834398  1.018583201 -0.351067819
34 -0.572769045 -2.072442096  0.577545791  1.284331483
35  0.443800268 -0.108977727  1.866110069 -0.020469667
36  0.926425998 -0.687618149  1.224365387 -0.096690188
37 -0.460173605 -0.302608648  0.671541153 -2.696710002
38  0.277085477  0.335125232 -0.754473314  0.619338071
39  1.279310040 -0.842097806 -0.275860802 -0.768216600
40  0.015055026  0.835779589 -0.535925622 -0.990428811
41  0.690052418  1.488830535  0.318262300 -0.265301715
42 -2.342151157 -0.587400371  1.794438099  1.190162522
43 -1.284973383  0.976120498 -0.678730423  0.895248035
44 -1.857641265 -0.484324204  1.312931115  1.671816010
45 -0.828061584 -1.461679865  1.175113675  0.392315093
46 -0.124694812  0.800465295 -0.328118006  0.170025963
47  0.698593283  0.676449924  1.963221359 -0.477702054
48  0.118048192  0.257227889 -0.600914093  0.908605679
49 -0.101844218  0.458018251  0.177924006 -0.469079298
50  0.249644640 -1.684424651  0.620835209  1.330859032</code></pre>
</div>
</div>
<p>This example showcases how to leverage TidyDensity’s functionality to convert tidy data into a time series format effortlessly. At this point in time though, the parameters of the <code>ts()</code> function are not utilized, meaning you cannot also pass in a start, end or frequency, but that will be added in the future.</p>
<p>In conclusion, mastering the <code>ts()</code> function in base R and exploring additional tools like <code>convert_to_ts()</code> opens up new avenues for time series analysis. So, roll up your sleeves, experiment with your data, and unlock the insights hidden in the temporal dimension. Happy coding!</p>


</section>
</section>

 ]]></description>
  <category>rtip</category>
  <category>timeseries</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-12-27/index.html</guid>
  <pubDate>Wed, 27 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>A Gentle Introduction to Poisson Regression for Count Data: School’s Out, Job Offers Incoming!</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-12-19/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Hey data enthusiasts! Today, we’re diving into the fascinating world of count data and its trusty sidekick, Poisson regression. Buckle up, because we’re about to explore how this statistical powerhouse helps us understand the factors influencing, you guessed it, counts.</p>
<p><em>Scenario:</em> Imagine you’re an education researcher, eager to understand how a student’s GPA might influence their job offer count after graduation. But hold on, job offers aren’t continuous – they’re discrete, ranging from 0 to a handful. That’s where Poisson regression comes in!</p>
</section>
<section id="generating-data" class="level1">
<h1>Generating Data</h1>
<p>We’ll keep the data generation part the same, just adjusting the variables in our data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set seed for reproducibility</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Creating data frame</span></span>
<span id="cb1-7">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb1-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">School =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb1-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GPA =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb1-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb1-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb1-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-13">  ),</span>
<span id="cb1-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">JobOffers =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb1-15">)</span>
<span id="cb1-16"></span>
<span id="cb1-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    School               GPA          JobOffers   
 Length:100         Min.   :1.000   Min.   :0.00  
 Class :character   1st Qu.:1.875   1st Qu.:0.00  
 Mode  :character   Median :2.600   Median :0.50  
                    Mean   :2.532   Mean   :0.83  
                    3rd Qu.:3.200   3rd Qu.:1.00  
                    Max.   :4.000   Max.   :4.00  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(JobOffers) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean_gpa =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(GPA))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  JobOffers mean_gpa
      &lt;dbl&gt;    &lt;dbl&gt;
1         0     1.94
2         1     2.87
3         2     3.41
4         3     3.5 
5         4     3.8 </code></pre>
</div>
</div>
<section id="visualizing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-the-data">Visualizing the Data</h2>
<p>Let’s update the plots to reflect the change in the predictor and outcome.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plotting GPA distribution by school</span></span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(JobOffers, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> School)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodge"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-19/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The density plot now showcases the distribution of GPA scores for each school.</p>
<p>Next, let’s visualize the relationship between GPA and job offers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plotting Job Offers vs. GPA</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> GPA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> JobOffers, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> School)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> JobOffers), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">628</span>,</span>
<span id="cb6-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_jitter</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scatter Plot of Job Offers vs. GPA"</span>,</span>
<span id="cb6-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GPA"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Job Offers"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-19/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This scatter plot gives us a visual cue that higher GPAs might correlate with more job offers.</p>
</section>
<section id="poisson-regression" class="level2">
<h2 class="anchored" data-anchor-id="poisson-regression">Poisson Regression</h2>
<p>Now, let’s adjust the Poisson Regression model to reflect the change in predictor and outcome.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fitting Poisson Regression model</span></span>
<span id="cb7-2">poisson_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(JobOffers <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> GPA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> School, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"poisson"</span>)</span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Summary of the model</span></span>
<span id="cb7-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(poisson_model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = JobOffers ~ GPA + School, family = "poisson", data = data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.2452  -0.5856  -0.3483   0.3221   1.6491  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -5.25817    0.70621  -7.446 9.65e-14 ***
GPA          1.73169    0.21241   8.153 3.56e-16 ***
SchoolB      0.03135    0.27524   0.114    0.909    
SchoolC     -0.19137    0.27637  -0.692    0.489    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 138.07  on 99  degrees of freedom
Residual deviance:  43.18  on 96  degrees of freedom
AIC: 168.06

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>The model summary will now provide insights into how GPA influences the number of job offers.</p>
</section>
<section id="visualizing-model-fits" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-model-fits">Visualizing Model Fits</h2>
<p>Let’s update the plot to reflect the relationship between GPA and predicted job offers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Adding predicted values to the data frame</span></span>
<span id="cb9-2">data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Predicted <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(poisson_model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"response"</span>)</span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plotting observed vs. predicted values</span></span>
<span id="cb9-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> GPA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Predicted, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> School)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> JobOffers), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">628</span>,</span>
<span id="cb9-7">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_jitter</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb9-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observed vs. Predicted Job Offers"</span>,</span>
<span id="cb9-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GPA"</span>, </span>
<span id="cb9-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Job Offers"</span>,</span>
<span id="cb9-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"School"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-19/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot now illustrates how the Poisson Regression model predicts job offers based on GPA.</p>
</section>
</section>
<section id="predicted-vs.-actual-values" class="level1">
<h1>Predicted vs.&nbsp;actual values</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> JobOffers, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(poisson_model),</span>
<span id="cb10-2">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> School)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> JobOffers), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">628</span>,</span>
<span id="cb10-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_jitter</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb10-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual Job Offers"</span>, </span>
<span id="cb10-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Job Offers"</span>, </span>
<span id="cb10-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Job Offers"</span>,</span>
<span id="cb10-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"School"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-19/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="residuals-vs.-predicted-values" class="level1">
<h1>Residuals vs.&nbsp;predicted values</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(poisson_model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">which =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-19/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-12-19/index.html</guid>
  <pubDate>Tue, 19 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Exploring Variance Inflation Factor (VIF) in R: A Practical Guide</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-12-18/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Hey there fellow R enthusiasts! Today, we’re diving into the fascinating world of Variance Inflation Factor (VIF) and how to calculate it using R. VIF is a crucial metric that helps us understand the level of multicollinearity among predictors in a regression model. So, buckle up your seatbelts, and let’s embark on this coding adventure!</p>
</section>
<section id="setting-the-stage" class="level1">
<h1>Setting the Stage</h1>
<p>Let’s start by setting up our stage. We’ll use a linear regression model with the <code>mtcars</code> dataset. Here’s the model we’re going to work with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Setting up the model</span></span>
<span id="cb1-2">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> disp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> hp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> wt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> drat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars)</span></code></pre></div>
</div>
</section>
<section id="calculating-vif-with-car-library" class="level1">
<h1>Calculating VIF with <code>car</code> library</h1>
<p>Now, the exciting part! We’ll employ the <code>car</code> library to compute the VIF using the <code>vif</code> function. VIF measures how much the variance of an estimated regression coefficient increases if your predictors are correlated. It’s a handy tool to identify collinearity issues in your model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Installing and loading the 'car' library</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("car")</span></span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(car)</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculating VIF</span></span>
<span id="cb2-6">vif_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vif</span>(model)</span>
<span id="cb2-7">vif_values</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    disp       hp       wt     drat 
8.209402 2.894373 5.096601 2.279547 </code></pre>
</div>
</div>
</section>
<section id="visualizing-the-model-and-residuals" class="level1">
<h1>Visualizing the Model and Residuals</h1>
<p>To gain deeper insights, let’s visualize our model and its residuals. Visualizations often provide a clearer picture of what’s happening under the hood.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualizing the model</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">which =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Fit"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-18/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>These plots will give us a sense of how well our model fits the data and whether there are any patterns in the residuals.</p>
</section>
<section id="visualizing-vif" class="level1">
<h1>Visualizing VIF</h1>
<p>Now, let’s bring our VIF into the spotlight. We’ll use a barplot to showcase the VIF values for each predictor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualizing VIF</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">barplot</span>(vif_values, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"skyblue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variance Inflation Factor (VIF)"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-18/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This barplot will help us identify predictors that might be causing multicollinearity issues in our model.</p>
</section>
<section id="correlation-matrix-and-visualization" class="level1">
<h1>Correlation Matrix and Visualization</h1>
<p>To complete our journey, let’s create a correlation matrix of the predictors and visualize it. Understanding the correlations between variables is crucial in regression analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Creating a correlation matrix</span></span>
<span id="cb6-2">cor_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(mtcars[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"disp"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hp"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drat"</span>)])</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualizing the correlation matrix</span></span>
<span id="cb6-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">image</span>(cor_matrix, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correlation Matrix"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>))(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-18/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This visualization will give us a colorful snapshot of how our predictors are correlated.</p>
</section>
<section id="wrapping-up" class="level1">
<h1>Wrapping Up</h1>
<p>And there you have it, folks! We’ve explored the ins and outs of calculating VIF in R, visualized our model, checked residuals, and even took a colorful glance at predictor correlations. These tools are invaluable in ensuring the health and accuracy of our regression models.</p>
<p>Feel free to tweak and play around with the code, and don’t forget to share your findings with the R community. Happy coding!</p>
<p>Keep calm and code in R, Steve</p>


</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-12-18/index.html</guid>
  <pubDate>Mon, 18 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Demystifying Odds Ratios in Logistic Regression: Your R Recipe for Loan Defaults</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-12-15/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Ever wondered why some individuals default on loans while others don’t? Logistic regression can shed light on this, and calculating odds ratios in R is the secret sauce. So, strap on your data aprons, folks, and let’s cook up some insights!</p>
</section>
<section id="what-are-odds-ratios" class="level1">
<h1>What are Odds Ratios?</h1>
<p>Imagine a loan officer flipping a coin to decide whether to approve your loan. Odds ratios tell you how much more likely one factor (like your income) makes the “heads” (approval) side appear compared to another (like your student status).</p>
<p>In logistic regression, odds ratios compare the odds of an event (loan default, in our case) for two groups defined by a specific variable. They’re like multipliers: greater than 1 means something increases the chances of default, while less than 1 means it decreases them.</p>
</section>
<section id="the-r-recipe-with-islr-flavor" class="level1">
<h1>The R Recipe (with ISLR Flavor)</h1>
<ol type="1">
<li><strong>Gather your ingredients:</strong> Load the ISLR package and the <code>Default</code> dataset. This data tells us whether individuals defaulted on loans, their student status, bank balance, and income.</li>
<li><strong>Whip up the model:</strong> Use the <code>glm()</code> function with <code>family='binomial'</code> to fit a logistic regression model that predicts loan defaults based on student status, balance, and income. Think of it as the base for your delicious insights.</li>
<li><strong>Extract the spices:</strong> Use the <code>summary()</code> function to access the estimated coefficients for each variable. These are the secret ingredients that give your model flavor.</li>
<li><strong>Unleash the magic of exponentiation:</strong> Apply the <code>exp()</code> function to transform the coefficients back to the odds ratio scale. Remember, logistic regression operates on log-odds, so we need to break the code.</li>
<li><strong>Savor the results:</strong> Analyze the odds ratios. Are they greater than 1? Those factors increase default odds. Less than 1? They decrease them. A value near 1 suggests little to no effect.</li>
</ol>
</section>
<section id="example-time" class="level1">
<h1>Example Time</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load ISLR package and data</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ISLR)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(Default)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  default student   balance    income
1      No      No  729.5265 44361.625
2      No     Yes  817.1804 12106.135
3      No      No 1073.5492 31767.139
4      No      No  529.2506 35704.494
5      No      No  785.6559 38463.496
6      No     Yes  919.5885  7491.559</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the model</span></span>
<span id="cb3-2">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(default<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>student<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>balance<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>income, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'binomial'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>Default)</span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#disable scientific notation for model summary</span></span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scipen=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">999</span>)</span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract and exponentiate coefficients</span></span>
<span id="cb3-8">odds_ratios <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model))</span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print the odds ratios</span></span>
<span id="cb3-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Odds ratios:"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Odds ratios:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(odds_ratios)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept)    studentYes       balance        income 
0.00001903854 0.52373166965 1.00575299051 1.00000303345 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Odds ratios with confidence intervals:"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Odds ratios with confidence intervals:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Odds_Ratio =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confint</span>(model)))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>               Odds_Ratio          2.5 %       97.5 %
(Intercept) 0.00001903854 0.000007074481 0.0000487808
studentYes  0.52373166965 0.329882707270 0.8334223982
balance     1.00575299051 1.005308940686 1.0062238757
income      1.00000303345 0.999986952969 1.0000191246</code></pre>
</div>
</div>
<p>Interpretation time! Being a student decreases default with log odds by -0.646, while higher income leaves log odds basically flat.</p>
<p><strong>Go Forth and Experiment!</strong></p>
<p>This is just the tip of the iceberg! Play around with different models, variables, and visualizations using RStudio. Remember, the more you experiment, the better you’ll understand the magic of odds ratios and logistic regression. Now, go forth and analyze!</p>
<p><strong>Bonus Tip:</strong> Check out the <code>confint()</code> function to calculate confidence intervals for your odds ratios. This adds another layer of spice to your statistical analysis!</p>
<p>So, there you have it! Odds ratios in R, made easy with the ISLR package and a dash of culinary magic. Remember, the key ingredients are understanding, practice, and a sprinkle of creativity. Bon appétit, data chefs!</p>


</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-12-15/index.html</guid>
  <pubDate>Fri, 15 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Decoding the Mystery: How to Interpret Regression Output in R Like a Champ</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-12-14/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Ever run an R regression and stared at the output, feeling like you’re deciphering an ancient scroll? Fear not, fellow data enthusiasts! Today, we’ll crack the code and turn those statistics into meaningful insights.</p>
<p><strong>Let’s grab our trusty R arsenal and set up the scene:</strong></p>
<ul>
<li><strong>Dataset:</strong> <code>mtcars</code> (a classic car dataset in R)</li>
<li><strong>Regression:</strong> Linear model with <code>mpg</code> as the dependent variable (miles per gallon) and all other variables as independent variables (predictors)</li>
</ul>
</section>
<section id="step-1-summon-the-stats-gods-with-summary" class="level1">
<h1>Step 1: Summon the Stats Gods with “summary()”</h1>
<p>First, cast your R spell with <code>summary(lm(mpg ~ ., data = mtcars))</code>. This incantation conjures a table of coefficients, p-values, and other stats. Don’t panic if it looks like a cryptic riddle! We’ll break it down:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars)</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mpg ~ ., data = mtcars)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.4506 -1.6044 -0.1196  1.2193  4.6271 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept) 12.30337   18.71788   0.657   0.5181  
cyl         -0.11144    1.04502  -0.107   0.9161  
disp         0.01334    0.01786   0.747   0.4635  
hp          -0.02148    0.02177  -0.987   0.3350  
drat         0.78711    1.63537   0.481   0.6353  
wt          -3.71530    1.89441  -1.961   0.0633 .
qsec         0.82104    0.73084   1.123   0.2739  
vs           0.31776    2.10451   0.151   0.8814  
am           2.52023    2.05665   1.225   0.2340  
gear         0.65541    1.49326   0.439   0.6652  
carb        -0.19942    0.82875  -0.241   0.8122  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.65 on 21 degrees of freedom
Multiple R-squared:  0.869, Adjusted R-squared:  0.8066 
F-statistic: 13.93 on 10 and 21 DF,  p-value: 3.793e-07</code></pre>
</div>
</div>
<section id="coefficients" class="level2">
<h2 class="anchored" data-anchor-id="coefficients">Coefficients</h2>
<p>These tell you how much, on average, the dependent variable changes for a one-unit increase in the corresponding independent variable (holding other variables constant). For example, a coefficient of 0.05 for <code>cyl</code> means for every one more cylinder, mpg is expected to increase by 0.05 miles per gallon, on average.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         cyl        disp          hp        drat          wt 
12.30337416 -0.11144048  0.01333524 -0.02148212  0.78711097 -3.71530393 
       qsec          vs          am        gear        carb 
 0.82104075  0.31776281  2.52022689  0.65541302 -0.19941925 </code></pre>
</div>
</div>
</section>
<section id="p-values" class="level2">
<h2 class="anchored" data-anchor-id="p-values">P-values</h2>
<p>These whisper secrets about significance. A p-value less than 0.05 would mean the observed relationship between the variable and mpg is unlikely to be due to chance. The following are the individual p-values for each variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(model)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         cyl        disp          hp        drat          wt 
 0.51812440  0.91608738  0.46348865  0.33495531  0.63527790  0.06325215 
       qsec          vs          am        gear        carb 
 0.27394127  0.88142347  0.23398971  0.66520643  0.81217871 </code></pre>
</div>
</div>
<p>Now the overall p-value for the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">model_p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(.model) {</span>
<span id="cb7-2">  </span>
<span id="cb7-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get p-values</span></span>
<span id="cb7-4">  fstat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(.model)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fstatistic</span>
<span id="cb7-5">  p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pf</span>(fstat[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], fstat[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], fstat[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(p)</span>
<span id="cb7-7">}</span>
<span id="cb7-8"></span>
<span id="cb7-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">model_p</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.model =</span> model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       value 
3.793152e-07 </code></pre>
</div>
</div>
</section>
</section>
<section id="step-2-lets-talk-turkey---interpreting-the-numbers" class="level1">
<h1>Step 2: Let’s Talk Turkey - Interpreting the Numbers</h1>
<section id="coefficients-1" class="level2">
<h2 class="anchored" data-anchor-id="coefficients-1">Coefficients</h2>
<p>Think of them as slopes. A positive coefficient means the dependent variable increases with the independent variable. Negative? The opposite! For example, <code>disp</code> has a negative coefficient, so bigger engines (larger displacement) tend to have lower mpg.</p>
</section>
<section id="p-values-1" class="level2">
<h2 class="anchored" data-anchor-id="p-values-1">P-values</h2>
<p>Imagine a courtroom. A low p-value is like a strong witness, convincing you the relationship between the variables is real. High p-values (like for <code>am</code>!) are like unreliable witnesses, leaving us unsure.</p>
</section>
</section>
<section id="step-3-zoom-out---the-bigger-picture" class="level1">
<h1>Step 3: Zoom Out - The Bigger Picture</h1>
<section id="r-squared" class="level2">
<h2 class="anchored" data-anchor-id="r-squared">R-squared</h2>
<p>This tells you how well the model explains the variation in mpg. A value close to 1 is fantastic, while closer to 0 means the model needs work. In our case, it’s not bad, but there’s room for improvement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(model)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>r.squared</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8690158</code></pre>
</div>
</div>
</section>
<section id="residuals" class="level2">
<h2 class="anchored" data-anchor-id="residuals">Residuals</h2>
<p>These are the differences between the actual mpg values and the model’s predictions. Analyzing them can reveal hidden patterns and model issues.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>residuals)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    model.residuals
Mazda RX4              -1.599505761
Mazda RX4 Wag          -1.111886079
Datsun 710             -3.450644085
Hornet 4 Drive          0.162595453
Hornet Sportabout       1.006565971
Valiant                -2.283039036
Duster 360             -0.086256253
Merc 240D               1.903988115
Merc 230               -1.619089898
Merc 280                0.500970058
Merc 280C              -1.391654392
Merc 450SE              2.227837890
Merc 450SL              1.700426404
Merc 450SLC            -0.542224699
Cadillac Fleetwood     -1.634013415
Lincoln Continental    -0.536437711
Chrysler Imperial       4.206370638
Fiat 128                4.627094192
Honda Civic             0.503261089
Toyota Corolla          4.387630904
Toyota Corona          -2.143103442
Dodge Challenger       -1.443053221
AMC Javelin            -2.532181498
Camaro Z28             -0.006021976
Pontiac Firebird        2.508321011
Fiat X1-9              -0.993468693
Porsche 914-2          -0.152953961
Lotus Europa            2.763727417
Ford Pantera L         -3.070040803
Ferrari Dino            0.006171846
Maserati Bora           1.058881618
Volvo 142E             -2.968267683</code></pre>
</div>
</div>
<p><strong>Bonus Tip:</strong> Visualize the data! Scatter plots and other graphs can make relationships between variables pop.</p>
<p><strong>Remember:</strong> Interpreting regression output is an art, not a science. Use your domain knowledge, consider the context, and don’t hesitate to explore further!</p>
<p><strong>So next time you face regression output, channel your inner R wizard and remember:</strong></p>
<ul>
<li>Coefficients whisper about slopes and changes.</li>
<li>P-values tell tales of significance, true or false.</li>
<li>R-squared unveils the model’s explanatory magic.</li>
<li>Residuals hold hidden clues, waiting to be discovered.</li>
</ul>
<p>With these tools in your belt, you’ll be interpreting regression output like a pro in no time! Now go forth and conquer the data, fellow R adventurers!</p>
<p><strong>Note:</strong> This is just a brief example. For a deeper dive, explore specific diagnostics, model selection techniques, and other advanced topics to truly master the art of regression interpretation.</p>


</section>
</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-12-14/index.html</guid>
  <pubDate>Thu, 14 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Conquering Unequal Variance with Weighted Least Squares in R: A Practical Guide</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-12-12/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Tired of your least-squares regression model giving wonky results because some data points shout louder than others? Meet Weighted Least Squares (WLS), the superhero of regression, ready to tackle unequal variance (heteroscedasticity) and give your model the justice it deserves! Today, we’ll dive into the world of WLS in R, using base functions for maximum transparency. Buckle up, data warriors!</p>
</section>
<section id="example" class="level1">
<h1>Example</h1>
<p><strong>The Scenario:</strong> Imagine studying the relationship between exam scores and study hours. But wait, some students took the test multiple times, inflating their data points! This unequal variance can skew your ordinary least squares (OLS) model, making it unreliable. WLS to the rescue!</p>
<section id="steps" class="level2">
<h2 class="anchored" data-anchor-id="steps">Steps</h2>
<p><strong>Step 1: Gathering the Troops (Data):</strong></p>
<p>Let’s create some simulated data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate exam scores and study hours</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb1-3">scores <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb1-4">hours <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb1-5">hours <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> hours <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add heteroscedasticity</span></span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a data frame</span></span>
<span id="cb1-8">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(scores, hours)</span></code></pre></div>
</div>
<p><strong>Step 2: Visualizing the Battlefield:</strong></p>
<p>A scatter plot is our trusty map:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hours, data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>scores)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-12/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Do you see those clusters of high-scoring students with more study hours? They’re the loud ones skewing the OLS line.</p>
<p><strong>Step 3: Building the WLS Wall:</strong></p>
<p>It’s time to define our weights. We want to give less weight to observations with high variance (those loud students) and more weight to those with low variance. Here’s a simple approach:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate inverse of variance</span></span>
<span id="cb3-2">weights <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hours)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit WLS model</span></span>
<span id="cb3-5">wls_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(scores <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> hours, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weights =</span> weights, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data)</span></code></pre></div>
</div>
<p><strong>Step 4: Inspecting the Model’s Performance:</strong></p>
<p>Let’s see if WLS silenced the loud ones:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(wls_model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = scores ~ hours, data = data, weights = weights)

Weighted Residuals:
    Min      1Q  Median      3Q     Max 
-75.854  -1.456   0.927   3.509  57.472 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   68.524      0.632 108.421   &lt;2e-16 ***
hours         -1.085      1.480  -0.733    0.465    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 14.65 on 98 degrees of freedom
Multiple R-squared:  0.00545,   Adjusted R-squared:  -0.004698 
F-statistic: 0.537 on 1 and 98 DF,  p-value: 0.4654</code></pre>
</div>
</div>
<p>Compare this summary to your OLS model’s. Do the coefficients and residuals look more sensible?</p>
<p><strong>Step 5: Visualizing the Conquered Land:</strong></p>
<p>Time to see if WLS straightened the line:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hours, data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>scores)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hours, wls_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitted, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-12/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notice how the red WLS line now passes closer to the majority of data points, unlike the blue OLS line that chased the loud ones.</p>
<p><strong>Step 6: Residuals: The Echoes of Battle:</strong></p>
<p>Let’s see if the residuals (errors) are under control:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hours, wls_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>residuals)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-12/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A random scatterplot of residuals is a good sign! No more funky patterns indicating heteroscedasticity.</p>
<p><strong>The Victory Lap:</strong></p>
<p>WLS has restored justice to your regression model! Remember, this is just a basic example. You can customize your weights based on your specific data and needs.</p>
<p><strong>Now it’s your turn!</strong> Try WLS on your own data and see the magic unfold. Remember, data analysis is an adventure, and WLS is your trusty steed. Ride on, data warrior!</p>
<p><strong>Bonus Tip:</strong> Check out the <code>lmtest</code> and <code>sandwich</code> packages for even more advanced WLS analysis.</p>
<p>Happy coding!</p>


</section>
</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-12-12/index.html</guid>
  <pubDate>Tue, 12 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Exploring TidyAML: Simplifying Regression Analysis in R</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-12-08/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>If you’re a data enthusiast diving into the world of regression analysis in R, you’ve likely encountered the challenges of managing code complexity and juggling different modeling engines. The good news is that there’s a powerful tool to streamline your regression workflow – the tidyAML R package.</p>
</section>
<section id="getting-started-with-tidyaml" class="level1">
<h1>Getting Started with TidyAML</h1>
<p>Before we dive into the script, let’s make sure you have the necessary libraries installed. Fire up your R console and install the tidyAML package along with its dependencies:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyAML"</span>)</span></code></pre></div>
<p>Now, let’s explore a script that leverages tidyAML for quick and efficient regression analysis. Here’s a breakdown of the key components:</p>
</section>
<section id="intial-setup" class="level1">
<h1>Intial Setup</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyAML)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidymodels)</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(multilevelmod)</span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(earth)</span>
<span id="cb2-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(randomForest)</span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rpart)</span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(lightgbm)</span>
<span id="cb2-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(baguette)</span>
<span id="cb2-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(bonsai)</span>
<span id="cb2-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(gee)</span>
<span id="cb2-12"></span>
<span id="cb2-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidymodels_prefer</span>()</span></code></pre></div>
</div>
<section id="setting-up-the-recipe" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-the-recipe">Setting Up the Recipe</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mtcars</span>
<span id="cb3-2">recipe <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">recipe</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df)</span></code></pre></div>
</div>
<p>In this snippet, we’re creating a recipe for our regression analysis. The response variable (<code>mpg</code>) is modeled against all other variables in the <code>mtcars</code> dataset.</p>
</section>
<section id="fast-regression-with-tidyaml" class="level2">
<h2 class="anchored" data-anchor-id="fast-regression-with-tidyaml">Fast Regression with TidyAML</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">fr_tbl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fast_regression</span>(</span>
<span id="cb4-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.data =</span> df,</span>
<span id="cb4-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.rec_obj =</span> recipe,</span>
<span id="cb4-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.parsnip_fns =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linear_reg"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mars"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bag_mars"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rand_forest"</span>,</span>
<span id="cb4-5">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"boost_tree"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bag_tree"</span>),</span>
<span id="cb4-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.parsnip_eng =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gee"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"glm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gls"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"earth"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rpart"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightgbm"</span>)</span>
<span id="cb4-7">)</span></code></pre></div>
</div>
<p>This is where the magic happens. The <code>fast_regression</code> function performs regression using various modeling functions (<code>linear_reg</code>, <code>mars</code>, etc.) and engines (<code>lm</code>, <code>gee</code>, etc.) specified. It’s a versatile approach to quickly explore different models.</p>
</section>
<section id="visualizing-residuals" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-residuals">Visualizing Residuals</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">fr_tbl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">res =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(fitted_wflw, \(x) x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-3">                     broom<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">augment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">new_data =</span> df))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> res) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pfe =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(.parsnip_engine, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" - "</span>, .parsnip_fns)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.res =</span> mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> .pred) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> pfe, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> .res, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> pfe)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals by Fitted Model"</span>,</span>
<span id="cb5-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals are mpg - .pred"</span>,</span>
<span id="cb5-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>,</span>
<span id="cb5-13">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals"</span>,</span>
<span id="cb5-14">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Engine + Function"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-08/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This block of code generates a boxplot visualizing residuals by model. Residuals are the differences between observed and predicted values. The plot helps you assess how well your models are performing.</p>
</section>
</section>
<section id="try-it-yourself" class="level1">
<h1>Try It Yourself!</h1>
<p>Now that you’ve seen the power of tidyAML in action, it’s time to try it yourself. Install the package, load your data, and adapt the script to your specific use case. TidyAML provides a clean and efficient way to explore different regression models, making your analysis more manageable and insightful.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyAML"</span>)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyAML)</span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Your data loading and analysis code here</span></span></code></pre></div>
<p>Happy coding, and may your regression analyses be tidy and insightful!</p>


</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-12-08/index.html</guid>
  <pubDate>Fri, 08 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Unraveling Patterns: A Step-by-Step Guide to Piecewise Regression in R</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-12-07/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Hey there, fellow R enthusiasts! Today, let’s embark on a fascinating journey into the realm of piecewise regression using R. If you’ve ever wondered how to uncover hidden trends and breakpoints in your data, you’re in for a treat. Buckle up, and let’s dive into the world of piecewise regression!</p>
</section>
<section id="piecewise-regression" class="level1">
<h1>Piecewise Regression</h1>
<p>Piecewise regression is a powerful technique that allows us to model distinct segments of a dataset with different linear relationships. It’s like fitting multiple straight lines to capture the nuances of different regions in your data. So, grab your virtual lab coat, and let’s get started.</p>
</section>
<section id="example" class="level1">
<h1>Example</h1>
<section id="step-1-load-your-data-and-libraries" class="level2">
<h2 class="anchored" data-anchor-id="step-1-load-your-data-and-libraries">Step 1: Load Your Data and Libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install and load necessary packages</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("segmented")</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(segmented)</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sample data</span></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb1-7">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-8">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine data</span></span>
<span id="cb1-11">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(x, y)</span></code></pre></div>
</div>
</section>
<section id="step-2-explore-your-data" class="level2">
<h2 class="anchored" data-anchor-id="step-2-explore-your-data">Step 2: Explore Your Data</h2>
<p>Before diving into the regression, let’s take a peek at our data. Visualizing the data often provides insights into potential breakpoints.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot to visualize the data</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(</span>
<span id="cb2-3">  data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y, </span>
<span id="cb2-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scatter Plot of Your Data"</span>,</span>
<span id="cb2-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Independent Variable (x)"</span>, </span>
<span id="cb2-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dependent Variable (y)"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-07/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="step-3-perform-piecewise-regression" class="level2">
<h2 class="anchored" data-anchor-id="step-3-perform-piecewise-regression">Step 3: Perform Piecewise Regression</h2>
<p>Now, the exciting part! Let’s fit our piecewise regression model using the <code>segmented</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the piecewise regression model</span></span>
<span id="cb3-2">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data)</span>
<span id="cb3-3">segmented_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">segmented</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seg.Z =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>x)</span></code></pre></div>
</div>
</section>
<section id="step-4-visualize-the-results" class="level2">
<h2 class="anchored" data-anchor-id="step-4-visualize-the-results">Step 4: Visualize the Results:</h2>
<p>To truly understand the magic happening, let’s visualize the fitted model and residuals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">seg_preds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(segmented_model)</span>
<span id="cb4-2">seg_res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> seg_preds</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the original data with the fitted model</span></span>
<span id="cb4-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(</span>
<span id="cb4-6">  data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y,</span>
<span id="cb4-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Piecewise Regression Fit"</span>,</span>
<span id="cb4-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Independent Variable (x)"</span>,</span>
<span id="cb4-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dependent Variable (y)"</span>,</span>
<span id="cb4-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span></span>
<span id="cb4-11">)</span>
<span id="cb4-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, seg_preds,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-07/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot residuals</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the residuals for each segment</span></span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, seg_res, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals"</span>)</span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-07/index_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="step-5-interpret-the-breakpoints" class="level2">
<h2 class="anchored" data-anchor-id="step-5-interpret-the-breakpoints">Step 5: Interpret the Breakpoints:</h2>
<p>Inspecting the segmented model will reveal the breakpoints and the corresponding regression lines. It’s like deciphering the story your data is trying to tell.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View breakpoints and coefficients</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(segmented_model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    ***Regression Model with Segmented Relationship(s)***

Call: 
segmented.lm(obj = model, seg.Z = ~x)

Estimated Break-Point(s):
          Est. St.Err
psi1.x 24.757  3.074

Coefficients of the linear terms:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)  2.49825    2.55867   0.976    0.331
x           -0.04055    0.17907  -0.226    0.821
U1.x         0.93569    0.18186   5.145       NA

Residual standard error: 6.073 on 96 degrees of freedom
Multiple R-Squared: 0.9333,  Adjusted R-squared: 0.9312 

Boot restarting based on 6 samples. Last fit:
Convergence attained in 2 iterations (rel. change 2.9855e-12)</code></pre>
</div>
</div>
</section>
<section id="step-6-encourage-exploration" class="level2">
<h2 class="anchored" data-anchor-id="step-6-encourage-exploration">Step 6: Encourage Exploration:</h2>
<p>Now that you’ve conquered piecewise regression, encourage your fellow data explorers to try it themselves. Challenge them to apply this technique to their datasets and share their insights.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Congratulations, you’ve just unlocked the power of piecewise regression in R! By visualizing data, fitting models, and exploring breakpoints, you’ve gained a valuable tool for understanding complex relationships. Keep coding, keep exploring, and stay curious!</p>
<p>Happy coding, and may your data always reveal its secrets!</p>
<p>Steven P. Sanderson II, MPH</p>


</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-12-07/index.html</guid>
  <pubDate>Thu, 07 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>A Complete Guide to Stepwise Regression in R</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-12-06/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Stepwise regression is a powerful technique used to build predictive models by iteratively adding or removing variables based on statistical criteria. In R, this can be achieved using functions like <code>step()</code> or manually with forward and backward selection.</p>
</section>
<section id="example" class="level1">
<h1>Example</h1>
<section id="forward-stepwise-regression" class="level2">
<h2 class="anchored" data-anchor-id="forward-stepwise-regression">Forward Stepwise Regression:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize an empty model</span></span>
<span id="cb1-2">forward_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Forward stepwise regression</span></span>
<span id="cb1-5">forward_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step</span>(forward_model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">direction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forward"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scope =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">formula</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> .))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=70.9
mpg ~ cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb</code></pre>
</div>
</div>
<p>In simple terms, we start with a model containing no predictors (<code>mpg ~ 1</code>) and iteratively add the most statistically significant variables until no improvement is observed.</p>
</section>
<section id="backward-stepwise-regression" class="level2">
<h2 class="anchored" data-anchor-id="backward-stepwise-regression">Backward Stepwise Regression:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize a model with all predictors</span></span>
<span id="cb3-2">backward_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars)</span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Backward stepwise regression</span></span>
<span id="cb3-5">backward_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step</span>(backward_model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">direction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"backward"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=70.9
mpg ~ cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb

       Df Sum of Sq    RSS    AIC
- cyl   1    0.0799 147.57 68.915
- vs    1    0.1601 147.66 68.932
- carb  1    0.4067 147.90 68.986
- gear  1    1.3531 148.85 69.190
- drat  1    1.6270 149.12 69.249
- disp  1    3.9167 151.41 69.736
- hp    1    6.8399 154.33 70.348
- qsec  1    8.8641 156.36 70.765
&lt;none&gt;              147.49 70.898
- am    1   10.5467 158.04 71.108
- wt    1   27.0144 174.51 74.280

Step:  AIC=68.92
mpg ~ disp + hp + drat + wt + qsec + vs + am + gear + carb

       Df Sum of Sq    RSS    AIC
- vs    1    0.2685 147.84 66.973
- carb  1    0.5201 148.09 67.028
- gear  1    1.8211 149.40 67.308
- drat  1    1.9826 149.56 67.342
- disp  1    3.9009 151.47 67.750
- hp    1    7.3632 154.94 68.473
&lt;none&gt;              147.57 68.915
- qsec  1   10.0933 157.67 69.032
- am    1   11.8359 159.41 69.384
- wt    1   27.0280 174.60 72.297

Step:  AIC=66.97
mpg ~ disp + hp + drat + wt + qsec + am + gear + carb

       Df Sum of Sq    RSS    AIC
- carb  1    0.6855 148.53 65.121
- gear  1    2.1437 149.99 65.434
- drat  1    2.2139 150.06 65.449
- disp  1    3.6467 151.49 65.753
- hp    1    7.1060 154.95 66.475
&lt;none&gt;              147.84 66.973
- am    1   11.5694 159.41 67.384
- qsec  1   15.6830 163.53 68.200
- wt    1   27.3799 175.22 70.410

Step:  AIC=65.12
mpg ~ disp + hp + drat + wt + qsec + am + gear

       Df Sum of Sq    RSS    AIC
- gear  1     1.565 150.09 63.457
- drat  1     1.932 150.46 63.535
&lt;none&gt;              148.53 65.121
- disp  1    10.110 158.64 65.229
- am    1    12.323 160.85 65.672
- hp    1    14.826 163.35 66.166
- qsec  1    26.408 174.94 68.358
- wt    1    69.127 217.66 75.350

Step:  AIC=63.46
mpg ~ disp + hp + drat + wt + qsec + am

       Df Sum of Sq    RSS    AIC
- drat  1     3.345 153.44 62.162
- disp  1     8.545 158.64 63.229
&lt;none&gt;              150.09 63.457
- hp    1    13.285 163.38 64.171
- am    1    20.036 170.13 65.466
- qsec  1    25.574 175.67 66.491
- wt    1    67.572 217.66 73.351

Step:  AIC=62.16
mpg ~ disp + hp + wt + qsec + am

       Df Sum of Sq    RSS    AIC
- disp  1     6.629 160.07 61.515
&lt;none&gt;              153.44 62.162
- hp    1    12.572 166.01 62.682
- qsec  1    26.470 179.91 65.255
- am    1    32.198 185.63 66.258
- wt    1    69.043 222.48 72.051

Step:  AIC=61.52
mpg ~ hp + wt + qsec + am

       Df Sum of Sq    RSS    AIC
- hp    1     9.219 169.29 61.307
&lt;none&gt;              160.07 61.515
- qsec  1    20.225 180.29 63.323
- am    1    25.993 186.06 64.331
- wt    1    78.494 238.56 72.284

Step:  AIC=61.31
mpg ~ wt + qsec + am

       Df Sum of Sq    RSS    AIC
&lt;none&gt;              169.29 61.307
- am    1    26.178 195.46 63.908
- qsec  1   109.034 278.32 75.217
- wt    1   183.347 352.63 82.790</code></pre>
</div>
</div>
<p>Here, we begin with a model including all predictors and iteratively remove the least statistically significant variables until the model no longer improves.</p>
</section>
<section id="both-direction-stepwise-regression" class="level2">
<h2 class="anchored" data-anchor-id="both-direction-stepwise-regression">Both-Direction Stepwise Regression:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize a model with all predictors</span></span>
<span id="cb5-2">both_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars)</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Both-direction stepwise regression</span></span>
<span id="cb5-5">both_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step</span>(both_model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">direction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"both"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=70.9
mpg ~ cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb

       Df Sum of Sq    RSS    AIC
- cyl   1    0.0799 147.57 68.915
- vs    1    0.1601 147.66 68.932
- carb  1    0.4067 147.90 68.986
- gear  1    1.3531 148.85 69.190
- drat  1    1.6270 149.12 69.249
- disp  1    3.9167 151.41 69.736
- hp    1    6.8399 154.33 70.348
- qsec  1    8.8641 156.36 70.765
&lt;none&gt;              147.49 70.898
- am    1   10.5467 158.04 71.108
- wt    1   27.0144 174.51 74.280

Step:  AIC=68.92
mpg ~ disp + hp + drat + wt + qsec + vs + am + gear + carb

       Df Sum of Sq    RSS    AIC
- vs    1    0.2685 147.84 66.973
- carb  1    0.5201 148.09 67.028
- gear  1    1.8211 149.40 67.308
- drat  1    1.9826 149.56 67.342
- disp  1    3.9009 151.47 67.750
- hp    1    7.3632 154.94 68.473
&lt;none&gt;              147.57 68.915
- qsec  1   10.0933 157.67 69.032
- am    1   11.8359 159.41 69.384
+ cyl   1    0.0799 147.49 70.898
- wt    1   27.0280 174.60 72.297

Step:  AIC=66.97
mpg ~ disp + hp + drat + wt + qsec + am + gear + carb

       Df Sum of Sq    RSS    AIC
- carb  1    0.6855 148.53 65.121
- gear  1    2.1437 149.99 65.434
- drat  1    2.2139 150.06 65.449
- disp  1    3.6467 151.49 65.753
- hp    1    7.1060 154.95 66.475
&lt;none&gt;              147.84 66.973
- am    1   11.5694 159.41 67.384
- qsec  1   15.6830 163.53 68.200
+ vs    1    0.2685 147.57 68.915
+ cyl   1    0.1883 147.66 68.932
- wt    1   27.3799 175.22 70.410

Step:  AIC=65.12
mpg ~ disp + hp + drat + wt + qsec + am + gear

       Df Sum of Sq    RSS    AIC
- gear  1     1.565 150.09 63.457
- drat  1     1.932 150.46 63.535
&lt;none&gt;              148.53 65.121
- disp  1    10.110 158.64 65.229
- am    1    12.323 160.85 65.672
- hp    1    14.826 163.35 66.166
+ carb  1     0.685 147.84 66.973
+ vs    1     0.434 148.09 67.028
+ cyl   1     0.414 148.11 67.032
- qsec  1    26.408 174.94 68.358
- wt    1    69.127 217.66 75.350

Step:  AIC=63.46
mpg ~ disp + hp + drat + wt + qsec + am

       Df Sum of Sq    RSS    AIC
- drat  1     3.345 153.44 62.162
- disp  1     8.545 158.64 63.229
&lt;none&gt;              150.09 63.457
- hp    1    13.285 163.38 64.171
+ gear  1     1.565 148.53 65.121
+ cyl   1     1.003 149.09 65.242
+ vs    1     0.645 149.45 65.319
+ carb  1     0.107 149.99 65.434
- am    1    20.036 170.13 65.466
- qsec  1    25.574 175.67 66.491
- wt    1    67.572 217.66 73.351

Step:  AIC=62.16
mpg ~ disp + hp + wt + qsec + am

       Df Sum of Sq    RSS    AIC
- disp  1     6.629 160.07 61.515
&lt;none&gt;              153.44 62.162
- hp    1    12.572 166.01 62.682
+ drat  1     3.345 150.09 63.457
+ gear  1     2.977 150.46 63.535
+ cyl   1     2.447 150.99 63.648
+ vs    1     1.121 152.32 63.927
+ carb  1     0.011 153.43 64.160
- qsec  1    26.470 179.91 65.255
- am    1    32.198 185.63 66.258
- wt    1    69.043 222.48 72.051

Step:  AIC=61.52
mpg ~ hp + wt + qsec + am

       Df Sum of Sq    RSS    AIC
- hp    1     9.219 169.29 61.307
&lt;none&gt;              160.07 61.515
+ disp  1     6.629 153.44 62.162
+ carb  1     3.227 156.84 62.864
+ drat  1     1.428 158.64 63.229
- qsec  1    20.225 180.29 63.323
+ cyl   1     0.249 159.82 63.465
+ vs    1     0.249 159.82 63.466
+ gear  1     0.171 159.90 63.481
- am    1    25.993 186.06 64.331
- wt    1    78.494 238.56 72.284

Step:  AIC=61.31
mpg ~ wt + qsec + am

       Df Sum of Sq    RSS    AIC
&lt;none&gt;              169.29 61.307
+ hp    1     9.219 160.07 61.515
+ carb  1     8.036 161.25 61.751
+ disp  1     3.276 166.01 62.682
+ cyl   1     1.501 167.78 63.022
+ drat  1     1.400 167.89 63.042
+ gear  1     0.123 169.16 63.284
+ vs    1     0.000 169.29 63.307
- am    1    26.178 195.46 63.908
- qsec  1   109.034 278.32 75.217
- wt    1   183.347 352.63 82.790</code></pre>
</div>
</div>
<p>In both-direction regression, the algorithm combines both forward and backward steps, optimizing the model by adding significant variables and removing insignificant ones.</p>
<section id="visualizing-data-and-model-fit" class="level4">
<h4 class="anchored" data-anchor-id="visualizing-data-and-model-fit">Visualizing Data and Model Fit:</h4>
<p>Now, let’s visualize the data and model fit using base R plots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot of mpg vs. hp</span></span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(mtcars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hp, mtcars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpg, </span>
<span id="cb7-3">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scatter Plot of mpg vs. hp"</span>, </span>
<span id="cb7-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hp"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb7-5">     )</span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> hp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb7-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">points</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(mtcars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hp), forward_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitted.values, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb7-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">points</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(mtcars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hp), backward_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitted.values, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb7-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">points</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(mtcars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hp), both_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitted.values, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Forward"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Backward"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Both-Direction"</span>), </span>
<span id="cb7-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-06/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot displays the scatter plot of <code>mpg</code> against <code>hp</code> with fitted lines for each stepwise regression. The colors correspond to the models created earlier.</p>
</section>
<section id="visualizing-residuals" class="level4">
<h4 class="anchored" data-anchor-id="visualizing-residuals">Visualizing Residuals:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Residual plots for each model</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Forward stepwise regression residuals</span></span>
<span id="cb8-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(forward_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>residuals, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Forward Residuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals"</span>)</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Backward stepwise regression residuals</span></span>
<span id="cb8-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(backward_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>residuals, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Backward Residuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals"</span>)</span>
<span id="cb8-9"></span>
<span id="cb8-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Both-direction stepwise regression residuals</span></span>
<span id="cb8-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(both_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>residuals, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Both-Direction Residuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-06/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>These plots help assess how well the models fit the data by examining the residuals.</p>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Stepwise regression is a valuable tool, but it’s crucial to interpret results cautiously and be aware of potential pitfalls.</p>


</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-12-06/index.html</guid>
  <pubDate>Wed, 06 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Unveiling the Magic of Polynomial Regression in R: A Step-by-Step Guide</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-12-05/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Hey folks! 👋 Today, let’s embark on a coding adventure and explore the fascinating world of Polynomial Regression in R. Whether you’re new to R or a seasoned coder, we’re going to break down the complexities and make this journey enjoyable and insightful.</p>
</section>
<section id="what-is-polynomial-regression" class="level1">
<h1>What is Polynomial Regression?</h1>
<p>At its core, Polynomial Regression is an extension of linear regression, allowing us to capture more complex relationships between variables. It’s like upgrading from a straight road to a curvy one, better accommodating the twists and turns of our data.</p>
</section>
<section id="lets-dive-in" class="level1">
<h1>Let’s Dive In!</h1>
<section id="step-1-set-the-stage" class="level2">
<h2 class="anchored" data-anchor-id="step-1-set-the-stage">Step 1: Set the Stage</h2>
<p>First things first, fire up your RStudio and load your favorite dataset. For our journey, I’ll use a hypothetical dataset about, say, the growth of healthyR packages over the years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Assume 'years' and 'growth' are our dataset columns</span></span>
<span id="cb1-2">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">years =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),</span>
<span id="cb1-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">growth =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>))</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualize the data</span></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>years, data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>growth, </span>
<span id="cb1-7">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HealthyR Package Growth Over the Years"</span>,</span>
<span id="cb1-8">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Years"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Growth"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-05/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="step-2-lets-fit-a-polynomial" class="level2">
<h2 class="anchored" data-anchor-id="step-2-lets-fit-a-polynomial">Step 2: Let’s Fit a Polynomial</h2>
<p>Now, let’s fit a polynomial regression model to our data. We’ll use the <code>lm()</code> function, and don’t worry, it’s simpler than it sounds!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit a polynomial regression model (let's go quadratic)</span></span>
<span id="cb2-2">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(growth <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">poly</span>(years, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data)</span></code></pre></div>
</div>
</section>
<section id="step-3-visualize-the-magic" class="level2">
<h2 class="anchored" data-anchor-id="step-3-visualize-the-magic">Step 3: Visualize the Magic</h2>
<p>Time to visualize the results. We’ll create a smooth curve representing our polynomial fit, compare it against the actual data, and also peek at the residuals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate points for smooth curve</span></span>
<span id="cb3-2">curve_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">years =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))</span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Predict growth based on the model</span></span>
<span id="cb3-5">predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> curve_data)</span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The data</span></span>
<span id="cb3-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>years, data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>growth, </span>
<span id="cb3-9">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HealthyR Package Growth Over the Years"</span>,</span>
<span id="cb3-10">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Years"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Growth"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb3-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualize the fitted model</span></span>
<span id="cb3-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(curve_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>years, predictions, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-05/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="step-4-assess-residuals" class="level2">
<h2 class="anchored" data-anchor-id="step-4-assess-residuals">Step 4: Assess Residuals</h2>
<p>To ensure our model is doing its job, let’s examine the residuals. These are the differences between our predictions and the actual values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate residuals</span></span>
<span id="cb4-2">residuals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(model)</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualize the residuals</span></span>
<span id="cb4-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>years, residuals, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals Analysis"</span>,</span>
<span id="cb4-6">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Years"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb4-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-05/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="conclusion-try-it-yourself" class="level1">
<h1>Conclusion: Try It Yourself!</h1>
<p>There you have it—a whirlwind tour of Polynomial Regression in R using base R for visuals! I encourage you to take the wheel and try it on your own datasets. Adjust the degree of your polynomial, explore different visualizations, and let the data unveil its secrets.</p>
<p>Remember, coding is an adventure, and each line is a step into the unknown. Happy coding! 🚀</p>
<p>Feel free to reach out if you have any questions or want to share your coding escapades. Until next time, happy data wrangling!</p>


</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-12-05/index.html</guid>
  <pubDate>Tue, 05 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Understanding Spline Regression</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-12-04/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Spline regression is particularly useful when the relationship between the independent and dependent variables is not adequately captured by a linear model. It involves fitting a piecewise continuous curve (spline) to the data. Let’s dive into the process using R.</p>
</section>
<section id="example" class="level1">
<h1>Example</h1>
<section id="step-1-load-the-necessary-libraries" class="level2">
<h2 class="anchored" data-anchor-id="step-1-load-the-necessary-libraries">Step 1: Load the Necessary Libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install and load the required libraries</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("splines")</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(splines)</span></code></pre></div>
</div>
</section>
<section id="step-2-generate-sample-data" class="level2">
<h2 class="anchored" data-anchor-id="step-2-generate-sample-data">Step 2: Generate Sample Data</h2>
<p>For our example, let’s create a hypothetical dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate sample data</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb2-3">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb2-4">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sin</span>(x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span></code></pre></div>
</div>
</section>
<section id="step-3-fit-a-spline-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="step-3-fit-a-spline-regression-model">Step 3: Fit a Spline Regression Model</h2>
<p>Now, let’s fit a spline regression model to our data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit a spline regression model</span></span>
<span id="cb3-2">spline_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span></code></pre></div>
</div>
<p>Here, <code>ns</code> from the <code>splines</code> package is used to create a natural spline basis with 4 degrees of freedom.</p>
</section>
<section id="step-4-visualize-the-results" class="level2">
<h2 class="anchored" data-anchor-id="step-4-visualize-the-results">Step 4: Visualize the Results</h2>
<p>Visualizing the data and the fitted spline is crucial for understanding the model’s performance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualize the data and fitted spline</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spline Regression Example"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>)</span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(spline_model), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fitted Spline"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-04/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This code generates a plot with the original data points and overlays the fitted spline.</p>
</section>
<section id="step-5-examine-residuals" class="level2">
<h2 class="anchored" data-anchor-id="step-5-examine-residuals">Step 5: Examine Residuals</h2>
<p>Checking residuals helps assess the model’s goodness of fit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Examine residuals</span></span>
<span id="cb5-2">residuals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(spline_model)</span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, residuals, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals of Spline Regression"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, </span>
<span id="cb5-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals"</span>)</span>
<span id="cb5-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-12-04/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot shows the residuals (the differences between observed and predicted values) against the independent variable.</p>
</section>
</section>
<section id="you-try" class="level1">
<h1>You Try!</h1>
<p>Now that you’ve seen the basics, I encourage you to try spline regression on your own datasets. Experiment with different degrees of freedom (<code>df</code> parameter) in the <code>ns</code> function to observe how it affects the fit.</p>
<p>Remember, the power of spline regression lies in its ability to capture complex patterns in your data. Don’t hesitate to tweak the code and visualize the results to gain a deeper understanding.</p>
<p>Feel free to share your experiences or ask questions in the comments. Happy coding!</p>
<p>That wraps up our journey into spline regression in R. I hope you found this tutorial helpful and inspiring for your data analysis endeavors.</p>


</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-12-04/index.html</guid>
  <pubDate>Mon, 04 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>tidyAML: Now supporting gee models</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-12-01/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>I am happy to announce that a new version of <code>tidyAML</code> is now available on CRAN. This version includes support for <code>gee</code> models. This is a big step forward for <code>tidyAML</code> as it now supports a wide variety of regression and classification models.</p>
</section>
<section id="what-is-tidyaml" class="level1">
<h1>What is <code>tidyAML</code>?</h1>
<p>The package is meant to be a way to quickly create many models of different algorithms, and this release is a small step forward in supporting that mission. The package is built upon the <code>tidymodels</code> packages.</p>
</section>
<section id="what-is-gee" class="level1">
<h1>What is <code>gee</code>?</h1>
<p><code>gee</code> stands for Generalized Estimating Equations. It is a way to model correlated data. For example, if you have a dataset where you have multiple observations per person, you may want to use <code>gee</code> to account for the correlation between observations within a person. This is a very common situation in longitudinal studies. Here is <a href="https://parsnip.tidymodels.org/reference/details_linear_reg_gee.html?q=gee#null">a link</a> to the <code>gee</code> parsnip model.</p>
</section>
<section id="example" class="level1">
<h1>Example</h1>
<p>Let’s see how it works, we will examine how it is setup to faily gracefully and how it works when the <code>multilevelmod</code> package is installed and loaded into your environment.</p>
<section id="load-library" class="level2">
<h2 class="anchored" data-anchor-id="load-library">Load Library</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyAML)</span></code></pre></div>
</div>
<p>Now, let’s build a model that will fail, it’s important I think to see the failure message so you can understand what is happening. It’s likely because the library is not loaded, let’s face it, it has happened to all of us.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(recipes)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb2-3"></span>
<span id="cb2-4">rec_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">recipe</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars)</span>
<span id="cb2-5">frt_tbl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fast_regression</span>(</span>
<span id="cb2-6">  mtcars, </span>
<span id="cb2-7">  rec_obj, </span>
<span id="cb2-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.parsnip_eng =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"glm"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gee"</span>),</span>
<span id="cb2-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.parsnip_fns =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linear_reg"</span></span>
<span id="cb2-10">)</span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(frt_tbl)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3
Columns: 8
$ .model_id       &lt;int&gt; 1, 2, 3
$ .parsnip_engine &lt;chr&gt; "lm", "gee", "glm"
$ .parsnip_mode   &lt;chr&gt; "regression", "regression", "regression"
$ .parsnip_fns    &lt;chr&gt; "linear_reg", "linear_reg", "linear_reg"
$ model_spec      &lt;list&gt; [~NULL, ~NULL, NULL, regression, TRUE, NULL, lm, TRUE]…
$ wflw            &lt;list&gt; [cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb, mp…
$ fitted_wflw     &lt;list&gt; [cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb, mp…
$ pred_wflw       &lt;list&gt; [&lt;tbl_df[8 x 1]&gt;], &lt;NULL&gt;, [&lt;tbl_df[8 x 1]&gt;]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">frt_tbl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(pred_wflw) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 8 × 1
  .pred
  &lt;dbl&gt;
1 22.9 
2 18.0 
3 21.1 
4 32.9 
5 18.5 
6 10.4 
7  9.59
8 24.7 

[[2]]
NULL

[[3]]
# A tibble: 8 × 1
  .pred
  &lt;dbl&gt;
1 22.9 
2 18.0 
3 21.1 
4 32.9 
5 18.5 
6 10.4 
7  9.59
8 24.7 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">frt_tbl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(fitted_wflw) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(broom<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>tidy)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 11 × 5
   term         estimate std.error statistic p.value
   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept) -40.3       30.5       -1.32   0.209 
 2 cyl           0.907      1.09       0.830  0.421 
 3 disp          0.0105     0.0189     0.557  0.587 
 4 hp           -0.00487    0.0248    -0.196  0.847 
 5 drat          1.73       2.04       0.846  0.413 
 6 wt           -5.71       2.35      -2.43   0.0302
 7 qsec          3.39       1.34       2.54   0.0248
 8 vs           -3.85       2.99      -1.29   0.220 
 9 am            2.16       2.29       0.942  0.364 
10 gear          1.40       1.68       0.838  0.417 
11 carb          0.200      0.835      0.239  0.815 

[[2]]
# A tibble: 0 × 0

[[3]]
# A tibble: 11 × 5
   term         estimate std.error statistic p.value
   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept) -40.3       30.5       -1.32   0.209 
 2 cyl           0.907      1.09       0.830  0.421 
 3 disp          0.0105     0.0189     0.557  0.587 
 4 hp           -0.00487    0.0248    -0.196  0.847 
 5 drat          1.73       2.04       0.846  0.413 
 6 wt           -5.71       2.35      -2.43   0.0302
 7 qsec          3.39       1.34       2.54   0.0248
 8 vs           -3.85       2.99      -1.29   0.220 
 9 am            2.16       2.29       0.942  0.364 
10 gear          1.40       1.68       0.838  0.417 
11 carb          0.200      0.835      0.239  0.815 </code></pre>
</div>
</div>
<p>We see that the <code>gee</code> model failed. This is because we did not load the <code>multilevelmod</code> package. Let’s load it and try again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(multilevelmod)</span>
<span id="cb8-2"></span>
<span id="cb8-3">frt_tbl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fast_regression</span>(</span>
<span id="cb8-4">  mtcars, </span>
<span id="cb8-5">  rec_obj, </span>
<span id="cb8-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.parsnip_eng =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"glm"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gee"</span>),</span>
<span id="cb8-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.parsnip_fns =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linear_reg"</span></span>
<span id="cb8-8">)</span>
<span id="cb8-9"></span>
<span id="cb8-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(frt_tbl)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3
Columns: 8
$ .model_id       &lt;int&gt; 1, 2, 3
$ .parsnip_engine &lt;chr&gt; "lm", "gee", "glm"
$ .parsnip_mode   &lt;chr&gt; "regression", "regression", "regression"
$ .parsnip_fns    &lt;chr&gt; "linear_reg", "linear_reg", "linear_reg"
$ model_spec      &lt;list&gt; [~NULL, ~NULL, NULL, regression, TRUE, NULL, lm, TRUE]…
$ wflw            &lt;list&gt; [cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb, mp…
$ fitted_wflw     &lt;list&gt; [cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb, mp…
$ pred_wflw       &lt;list&gt; [&lt;tbl_df[8 x 1]&gt;], [&lt;tbl_df[8 x 1]&gt;], [&lt;tbl_df[8 x 1]&gt;…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">frt_tbl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(pred_wflw) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 8 × 1
  .pred
  &lt;dbl&gt;
1  20.6
2  15.6
3  15.8
4  26.1
5  27.8
6  16.6
7  25.4
8  21.6

[[2]]
# A tibble: 8 × 1
  .pred
  &lt;dbl&gt;
1  21.3
2  15.2
3  15.3
4  25.7
5  27.3
6  16.5
7  25.7
8  20.5

[[3]]
# A tibble: 8 × 1
  .pred
  &lt;dbl&gt;
1  20.6
2  15.6
3  15.8
4  26.1
5  27.8
6  16.6
7  25.4
8  21.6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">frt_tbl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(fitted_wflw) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(broom<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>tidy)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 11 × 5
   term        estimate std.error statistic p.value
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept) -3.70      18.9       -0.195  0.848 
 2 cyl          0.668      1.03       0.647  0.529 
 3 disp         0.00831    0.0153     0.544  0.596 
 4 hp          -0.0124     0.0173    -0.717  0.486 
 5 drat         2.87       1.44       2.00   0.0674
 6 wt          -2.87       1.40      -2.05   0.0609
 7 qsec         0.777      0.618      1.26   0.231 
 8 vs           0.169      1.64       0.103  0.920 
 9 am           1.90       1.79       1.07   0.306 
10 gear         1.31       1.44       0.907  0.381 
11 carb        -0.601      0.730     -0.823  0.425 

[[2]]
# A tibble: 10 × 6
   term         estimate std.error statistic p.value        ``
   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
 1 (Intercept)  6.54       10.2     0.643     4.01    1.63    
 2 disp         0.0119      0.0140  0.849     0.0134  0.887   
 3 hp          -0.0149      0.0165 -0.901     0.0104 -1.43    
 4 drat         2.36        1.18    2.01      0.859   2.75    
 5 wt          -3.01        1.35   -2.23      1.35   -2.23    
 6 qsec         0.577       0.524   1.10      0.193   2.99    
 7 vs           0.000922    1.58    0.000582  1.07    0.000860
 8 am           1.35        1.54    0.880     0.886   1.53    
 9 gear         1.00        1.33    0.752     0.527   1.90    
10 carb        -0.355       0.611  -0.582     0.378  -0.940   

[[3]]
# A tibble: 11 × 5
   term        estimate std.error statistic p.value
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept) -3.70      18.9       -0.195  0.848 
 2 cyl          0.668      1.03       0.647  0.529 
 3 disp         0.00831    0.0153     0.544  0.596 
 4 hp          -0.0124     0.0173    -0.717  0.486 
 5 drat         2.87       1.44       2.00   0.0674
 6 wt          -2.87       1.40      -2.05   0.0609
 7 qsec         0.777      0.618      1.26   0.231 
 8 vs           0.169      1.64       0.103  0.920 
 9 am           1.90       1.79       1.07   0.306 
10 gear         1.31       1.44       0.907  0.381 
11 carb        -0.601      0.730     -0.823  0.425 </code></pre>
</div>
</div>
</section>
</section>
<section id="the-recipe-object" class="level1">
<h1>The recipe object</h1>
<p>Let’s take a look at the model spec, the workflow and the fitted workflow to see what has happened behind the scenes. First let’s look at the formula in the recipe object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">formula</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prep</span>(rec_obj))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mpg ~ cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb
&lt;environment: 0x0000012c521f0c98&gt;</code></pre>
</div>
</div>
<p>So we see what the formula is, but we also see that there is no <code>id_var</code> listed which means it would fail for the <code>gee</code> specification, but, our model worked! That is because behind the scenes in the fast sense at this point in development the first variable is taken to be the id variable. Let’s see what the workflow looks like.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">gee_wflw <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> frt_tbl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(wflw)</span>
<span id="cb16-2"></span>
<span id="cb16-3">gee_wflw[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>actions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>formula</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mpg ~ id_var(cyl) + disp + hp + drat + wt + qsec + vs + am + 
    gear + carb
&lt;environment: 0x0000012c5206d0f8&gt;</code></pre>
</div>
</div>
<p>As we can see the first predictor variable has been chosen as the id variable. This will change in the future, where you will be able to choose the <code>id_var</code>.</p>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Thank you for reading and I hope you enjoy the new version of <code>tidyAML</code>. Please let me know if you have any questions or comments. We will continue our development of <code>tidyAML</code> and hope to have more updates soon.</p>


</section>

 ]]></description>
  <category>rtip</category>
  <category>tidyaml</category>
  <category>regression</category>
  <category>classification</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-12-01/index.html</guid>
  <pubDate>Fri, 01 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Navigating Quantile Regression with R: A Comprehensive Guide</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-11-29/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Quantile regression is a robust statistical method that goes beyond traditional linear regression by allowing us to model the relationship between variables at different quantiles of the response distribution. In this blog post, we’ll explore how to perform quantile regression in R using the quantreg library.</p>
</section>
<section id="setting-the-stage" class="level1">
<h1>Setting the Stage</h1>
<p>First things first, let’s create some data to work with. We’ll generate a data frame <code>df</code> with two variables: ‘hours’ and ‘score’. The relationship between ‘hours’ and ‘score’ will have a bit of noise to make things interesting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb1-2">hours <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb1-3">score <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> hours <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.45</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> hours)</span>
<span id="cb1-4">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(hours, score)</span></code></pre></div>
</div>
</section>
<section id="visualizing-the-data" class="level1">
<h1>Visualizing the Data</h1>
<p>Before we jump into regression, it’s always a good idea to visualize our data. Let’s start with a scatter plot to get a sense of the relationship between hours and scores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hours, df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>score, </span>
<span id="cb2-3">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scatter Plot of Hours vs. Score"</span>, </span>
<span id="cb2-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hours"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Score"</span></span>
<span id="cb2-5">     )</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-11-29/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now that we’ve got a clear picture of our data, it’s time to perform quantile regression.</p>
</section>
<section id="quantile-regression-with-quantreg" class="level1">
<h1>Quantile Regression with quantreg</h1>
<p>We’ll use the <code>quantreg</code> library to perform quantile regression. The key function here is <code>rq()</code> (Quantile Regression). We’ll run quantile regression for a few quantiles, say 0.25, 0.5, and 0.75.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install and load quantreg if not already installed</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("quantreg")</span></span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(quantreg)</span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Quantile regression</span></span>
<span id="cb3-6">quant_reg_25 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rq</span>(score <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> hours, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>)</span>
<span id="cb3-7">quant_reg_50 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rq</span>(score <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> hours, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb3-8">quant_reg_75 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rq</span>(score <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> hours, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>)</span>
<span id="cb3-9"></span>
<span id="cb3-10">purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(quant_reg_25, quant_reg_50, quant_reg_75), broom<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>tidy)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 2 × 5
  term        estimate conf.low conf.high   tau
  &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
1 (Intercept)    60.3     59.0      61.1   0.25
2 hours           1.56     1.33      1.82  0.25

[[2]]
# A tibble: 2 × 5
  term        estimate conf.low conf.high   tau
  &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
1 (Intercept)    60.2     59.6      60.5    0.5
2 hours           1.96     1.86      2.20   0.5

[[3]]
# A tibble: 2 × 5
  term        estimate conf.low conf.high   tau
  &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
1 (Intercept)    59.9     59.5      60.7   0.75
2 hours           2.36     2.16      2.53  0.75</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(quant_reg_25, quant_reg_50, quant_reg_75), broom<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>glance)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 1 × 5
    tau logLik      AIC   BIC df.residual
  &lt;dbl&gt; &lt;logLik&gt;  &lt;dbl&gt; &lt;dbl&gt;       &lt;int&gt;
1  0.25 -259.6364  523.  528.          98

[[2]]
# A tibble: 1 × 5
    tau logLik      AIC   BIC df.residual
  &lt;dbl&gt; &lt;logLik&gt;  &lt;dbl&gt; &lt;dbl&gt;       &lt;int&gt;
1   0.5 -249.6752  503.  509.          98

[[3]]
# A tibble: 1 × 5
    tau logLik      AIC   BIC df.residual
  &lt;dbl&gt; &lt;logLik&gt;  &lt;dbl&gt; &lt;dbl&gt;       &lt;int&gt;
1  0.75 -252.0106  508.  513.          98</code></pre>
</div>
</div>
</section>
<section id="visualizing-model-performance" class="level1">
<h1>Visualizing Model Performance</h1>
<p>Now, let’s visualize how well our quantile regression models perform. We’ll overlay the regression lines on our scatter plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression lines</span></span>
<span id="cb7-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression lines</span></span>
<span id="cb7-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hours, df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>score, </span>
<span id="cb7-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantile Regression: Hours vs. Score"</span>, </span>
<span id="cb7-5">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hours"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Score"</span>)</span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(quant_reg_25), </span>
<span id="cb7-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(quant_reg_25)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hours"</span>], </span>
<span id="cb7-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb7-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(quant_reg_50), </span>
<span id="cb7-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(quant_reg_50)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hours"</span>], </span>
<span id="cb7-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb7-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(quant_reg_75), </span>
<span id="cb7-13">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(quant_reg_75)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hours"</span>], </span>
<span id="cb7-14">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb7-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topleft"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantile 0.25"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantile 0.5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantile 0.75"</span>),</span>
<span id="cb7-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-11-29/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>In this blog post, we delved into the fascinating world of quantile regression using R and the quantreg library. We generated some synthetic data, visualized it, and then performed quantile regression at different quantiles. The final touch was overlaying the regression lines on our scatter plot to visualize how well our models fit the data.</p>
<p>Quantile regression provides a more nuanced view of the relationship between variables, especially when dealing with skewed or non-normally distributed data. It’s a valuable tool in your statistical toolkit. Happy coding, and may your regressions be ever quantile-wise accurate!</p>


</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-11-29/index.html</guid>
  <pubDate>Wed, 29 Nov 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Understanding and Implementing Robust Regression in R</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-11-28/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>If you’re familiar with linear regression in R, you’ve probably encountered the traditional <code>lm()</code> function. While this is a powerful tool, it might not be the best choice when dealing with outliers or influential observations. In such cases, robust regression comes to the rescue, and in R, the <code>rlm()</code> function from the MASS package is a valuable resource. In this blog post, we’ll delve into the step-by-step process of performing robust regression in R, using a dataset to illustrate the differences between the base R lm model and the robust rlm model.</p>
</section>
<section id="the-dataset" class="level1">
<h1>The Dataset</h1>
<p>Let’s start by loading the dataset into R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb1-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>),</span>
<span id="cb1-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">31</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">31</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>),</span>
<span id="cb1-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">170</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">194</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">61</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">61</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">67</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>)</span>
<span id="cb1-5">)</span></code></pre></div>
</div>
<p>This dataset contains three variables: <code>x1</code>, <code>x2</code>, and <code>y</code>. Now, let’s explore how to fit a linear regression model using both the traditional <code>lm()</code> function and the robust <code>rlm()</code> function.</p>
</section>
<section id="fitting-a-model" class="level1">
<h1>Fitting a Model</h1>
<section id="traditional-linear-regression-lm" class="level2">
<h2 class="anchored" data-anchor-id="traditional-linear-regression-lm">Traditional Linear Regression (lm)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the lm model</span></span>
<span id="cb2-2">lm_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> x2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print the summary</span></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(lm_model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x2, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-72.020 -27.290  -0.138   4.487 124.144 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)   41.106     29.940   1.373    0.188
x1            -0.605      2.066  -0.293    0.773
x2             1.075      1.857   0.579    0.570

Residual standard error: 49.42 on 17 degrees of freedom
Multiple R-squared:  0.02203,   Adjusted R-squared:  -0.09303 
F-statistic: 0.1914 on 2 and 17 DF,  p-value: 0.8275</code></pre>
</div>
</div>
<p>The <code>lm()</code> function provides a standard linear regression model. However, it assumes that the data follows a normal distribution and is sensitive to outliers. This sensitivity can lead to biased coefficient estimates.</p>
</section>
<section id="robust-linear-regression-rlm" class="level2">
<h2 class="anchored" data-anchor-id="robust-linear-regression-rlm">Robust Linear Regression (rlm)</h2>
<p>Now, let’s contrast this with the robust approach using the <code>rlm()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load the MASS package</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(MASS)</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the rlm model</span></span>
<span id="cb4-5">robust_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rlm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> x2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df)</span>
<span id="cb4-6"></span>
<span id="cb4-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print the summary</span></span>
<span id="cb4-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(robust_model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call: rlm(formula = y ~ x1 + x2, data = df)
Residuals:
     Min       1Q   Median       3Q      Max 
-24.9296  -6.1604  -0.5812   6.4648 170.4612 

Coefficients:
            Value   Std. Error t value
(Intercept) 21.4109  5.9703     3.5862
x1           2.3077  0.4121     5.6004
x2          -0.2449  0.3703    -0.6615

Residual standard error: 9.369 on 17 degrees of freedom</code></pre>
</div>
</div>
<p>The <code>rlm()</code> function, part of the MASS package, uses a robust M-estimation approach. It downplays the impact of outliers, making it more suitable for datasets with influential observations.</p>
</section>
</section>
<section id="understanding-the-results" class="level1">
<h1>Understanding the Results</h1>
<p>When you compare the summaries of the two models, you’ll notice differences in the coefficient estimates and standard errors. The robust model is less influenced by outliers, providing more reliable estimates in the presence of skewed or contaminated data.</p>
</section>
<section id="view-the-residuals" class="level1">
<h1>View the Residuals</h1>
<p>Let’s take a closer look at the residuals of the two models. First, we’ll extract the residuals from the <code>lm()</code> model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">lm_residuals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(lm_model)</span></code></pre></div>
</div>
<p>Next, we’ll extract the residuals from the <code>rlm()</code> model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">robust_residuals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(robust_model)</span></code></pre></div>
</div>
<p>Now, let’s plot the residuals from both models:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a new plot</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(</span>
<span id="cb8-3">  lm_residuals, </span>
<span id="cb8-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, </span>
<span id="cb8-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, </span>
<span id="cb8-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals Comparison: lm vs. rlm"</span>,</span>
<span id="cb8-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observation"</span>, </span>
<span id="cb8-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals"</span></span>
<span id="cb8-9">  )</span>
<span id="cb8-10"></span>
<span id="cb8-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add robust residuals to the plot</span></span>
<span id="cb8-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">points</span>(</span>
<span id="cb8-13">  robust_residuals, </span>
<span id="cb8-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, </span>
<span id="cb8-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span></span>
<span id="cb8-16">  )</span>
<span id="cb8-17"></span>
<span id="cb8-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add a legend</span></span>
<span id="cb8-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm Residuals"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rlm Residuals"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-11-28/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="try-it-on-your-own" class="level1">
<h1>Try it on Your Own</h1>
<p>Now that you’ve seen the contrast between the traditional <code>lm()</code> and the robust <code>rlm()</code> models, I encourage you to apply this knowledge to your own datasets. Experiment with different datasets, introduce outliers, and observe how the two models react. This hands-on approach will deepen your understanding of robust regression in R.</p>
<p>Remember, robust regression is a powerful tool when facing real-world data challenges. As you explore, don’t hesitate to tweak parameters, test assumptions, and refine your models. Happy coding, and may your regression analyses be robust and resilient!</p>


</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-11-28/index.html</guid>
  <pubDate>Tue, 28 Nov 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Unveiling Power Regression: A Step-by-Step Guide in R</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-11-27/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In the realm of statistics, power regression stands out as a versatile tool for exploring the relationship between two variables, where one variable is the power of the other. This type of regression is particularly useful when there’s an inherent nonlinear relationship between the variables, often characterized by an exponential or inverse relationship.</p>
<p>Power regression takes the form of y = ax^b, where:</p>
<ul>
<li><p><code>y</code>: The response variable, the quantity we’re trying to predict</p></li>
<li><p><code>x</code>: The predictor variable, the quantity we’re using to make predictions</p></li>
<li><p><code>a</code>: The intercept, the value of y when x = 1</p></li>
<li><p><code>b</code>: The power coefficient, which determines the rate at which y changes as x increases or decreases</p></li>
</ul>
</section>
<section id="steps" class="level1">
<h1>Steps</h1>
<section id="step-1-gathering-the-data" class="level2">
<h2 class="anchored" data-anchor-id="step-1-gathering-the-data">Step 1: Gathering the Data</h2>
<p>To embark on our power regression journey, we’ll need some data to work with. Let’s simulate a dataset that exhibits an exponential relationship between two variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulate data</span></span>
<span id="cb1-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-3">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span></code></pre></div>
</div>
</section>
<section id="step-2-visualizing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="step-2-visualizing-the-data">Step 2: Visualizing the Data</h2>
<p>Before diving into the regression analysis, it’s crucial to visualize the data to gain a deeper understanding of the underlying relationship between the variables. A scatterplot can effectively reveal any patterns or trends in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create scatterplot</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-11-27/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="step-3-transforming-the-data" class="level2">
<h2 class="anchored" data-anchor-id="step-3-transforming-the-data">Step 3: Transforming the Data</h2>
<p>Since power regression assumes a nonlinear relationship between the variables, we need to transform the data to fit the model’s structure. This involves taking the logarithm of both sides of the power regression equation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transform data</span></span>
<span id="cb3-2">log_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(y)</span>
<span id="cb3-3">log_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(x)</span></code></pre></div>
</div>
</section>
<section id="step-4-fitting-the-power-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="step-4-fitting-the-power-regression-model">Step 4: Fitting the Power Regression Model</h2>
<p>Now that the data is suitably transformed, we can proceed with fitting the power regression model using the <code>lm()</code> function in R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit power regression model</span></span>
<span id="cb4-2">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(log_y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> log_x)</span></code></pre></div>
</div>
</section>
<section id="step-5-examining-the-model-results" class="level2">
<h2 class="anchored" data-anchor-id="step-5-examining-the-model-results">Step 5: Examining the Model Results</h2>
<p>The <code>summary()</code> function provides valuable insights into the model’s performance, including the estimated regression coefficients, their standard errors, and the p-values associated with each coefficient.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Summarize model results</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log_y ~ log_x)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.10472 -0.01800  0.00221  0.01433  0.61505 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 0.812631   0.027647   29.39   &lt;2e-16 ***
log_x       2.969125   0.007367  403.03   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06803 on 98 degrees of freedom
Multiple R-squared:  0.9994,    Adjusted R-squared:  0.9994 
F-statistic: 1.624e+05 on 1 and 98 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="step-6-visualizing-the-fitted-model" class="level2">
<h2 class="anchored" data-anchor-id="step-6-visualizing-the-fitted-model">Step 6: Visualizing the Fitted Model</h2>
<p>Visualizing the fitted model allows us to evaluate how well the model captures the underlying relationship between the variables. We can add the fitted model to the scatterplot using the <code>predict()</code> function (don’t forget to exponentiate!):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Predict fitted values</span></span>
<span id="cb7-2">fitted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x),</span>
<span id="cb7-3">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">interval =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prediction"</span>,</span>
<span id="cb7-4">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>)</span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add fitted model to scatterplot</span></span>
<span id="cb7-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y)</span>
<span id="cb7-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(fitted_values[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-11-27/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="step-7-calculating-prediction-intervals" class="level2">
<h2 class="anchored" data-anchor-id="step-7-calculating-prediction-intervals">Step 7: Calculating Prediction Intervals</h2>
<p>Prediction intervals provide a range of plausible values for the response variable at a given level of confidence. We calculated the prediction intervals using the <code>predict()</code> function above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add fitted model to scatterplot</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y)</span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(fitted_values[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb8-4"></span>
<span id="cb8-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add prediction intervals to scatterplot</span></span>
<span id="cb8-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(fitted_values[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb8-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(fitted_values[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-11-27/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Power regression serves as a powerful tool for modeling nonlinear relationships between variables. By transforming the data, fitting the model, and visualizing the results, we can gain valuable insights into the underlying patterns and make informed predictions about the response variable.</p>


</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-11-27/index.html</guid>
  <pubDate>Mon, 27 Nov 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Unveiling the Magic of LOESS Regression in R: A Step-by-Step Guide with mtcars</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-11-22/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>If you’ve ever found yourself grappling with noisy data and yearning for a smoother representation, LOESS regression might be the enchanting solution you’re seeking. In this blog post, we’ll unravel the mysteries of LOESS regression using the power of R, and walk through a practical example using the iconic <code>mtcars</code> dataset.</p>
</section>
<section id="what-is-loess-regression" class="level1">
<h1>What is LOESS Regression?</h1>
<p>LOESS, which stands for LOcal regrESSion, is a versatile and powerful technique for fitting a curve to a set of data points. Unlike traditional linear regression, LOESS adapts to the local behavior of the data, making it perfect for capturing intricate patterns in noisy datasets.</p>
</section>
<section id="getting-started-loading-the-mtcars-dataset" class="level1">
<h1>Getting Started: Loading the mtcars Dataset</h1>
<p>Let’s kick off our journey by loading the <code>mtcars</code> dataset. This dataset, featuring various car specifications, will serve as our canvas for the LOESS magic.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load the mtcars dataset</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(mtcars)</span></code></pre></div>
<section id="understanding-loess-the-basics" class="level2">
<h2 class="anchored" data-anchor-id="understanding-loess-the-basics">Understanding LOESS: The Basics</h2>
<p>Now, let’s delve into the heart of LOESS regression. In R, the magic happens with the <code>loess()</code> function. This function fits a smooth curve through your data, adjusting to the local characteristics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit a LOESS model</span></span>
<span id="cb2-2">loess_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loess</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars)</span></code></pre></div>
</div>
<p>Congratulations, you’ve just cast the LOESS spell on the fuel efficiency and weight relationship of these iconic cars!</p>
</section>
<section id="visualizing-the-enchantment" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-the-enchantment">Visualizing the Enchantment</h2>
<p>What good is magic if you can’t see it? Let’s visualize the results with a compelling plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate predictions from the LOESS model</span></span>
<span id="cb3-2">predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(loess_model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> mtcars)</span>
<span id="cb3-3">predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(mtcars, predictions)</span>
<span id="cb3-4">predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predictions[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(predictions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>wt), ]</span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a scatter plot of the original data</span></span>
<span id="cb3-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(</span>
<span id="cb3-8">  predictions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>wt,</span>
<span id="cb3-9">  predictions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpg, </span>
<span id="cb3-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, </span>
<span id="cb3-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LOESS Regression: Unveiling the Magic with mtcars"</span>, </span>
<span id="cb3-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weight (1000 lbs)"</span>, </span>
<span id="cb3-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Miles Per Gallon"</span></span>
<span id="cb3-14">)</span>
<span id="cb3-15"></span>
<span id="cb3-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the LOESS curve to the plot</span></span>
<span id="cb3-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(predictions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>predictions, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-11-22/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Behold, as the red curve gracefully dances through the blue points, smoothing out the rough edges and revealing the underlying trends in the relationship between weight and fuel efficiency.</p>
<p>Now, we did not specify any parameters for the <code>loess()</code> function, so it used the default values. Let’s take a look at the default parameters.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loess</span>(formula, data, weights, subset, na.action, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb4-2">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">span =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, enp.target, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">degree =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb4-3">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parametric =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">drop.square =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">normalize =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb4-4">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gaussian"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"symmetric"</span>),</span>
<span id="cb4-5">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"model.frame"</span>),</span>
<span id="cb4-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loess.control</span>(...), ...)</span></code></pre></div>
<p>If you want to see the documentation in R you can use <code>?loess</code> or <code>help(loess)</code>. I have it here for you anyways but it is good to know how to check it on the fly:</p>
<p><em>Arguments</em> <code>formula</code> - a formula specifying the numeric response and one to four numeric predictors (best specified via an interaction, but can also be specified additively). Will be coerced to a formula if necessary.</p>
<p><code>data</code> - an optional data frame, list or environment (or object coercible by as.data.frame to a data frame) containing the variables in the model. If not found in data, the variables are taken from environment(formula), typically the environment from which loess is called.</p>
<p><code>weights</code> - optional weights for each case.</p>
<p><code>subset</code> - an optional specification of a subset of the data to be used.</p>
<p><code>na.action</code> - the action to be taken with missing values in the response or predictors. The default is given by getOption(“na.action”).</p>
<p><code>model</code> - should the model frame be returned?</p>
<p><code>span</code> - the parameter α which controls the degree of smoothing.</p>
<p><code>enp.target</code> - an alternative way to specify span, as the approximate equivalent number of parameters to be used.</p>
<p><code>degree</code> - the degree of the polynomials to be used, normally 1 or 2. (Degree 0 is also allowed, but see the ‘Note’.)</p>
<p><code>parametric</code> - should any terms be fitted globally rather than locally? Terms can be specified by name, number or as a logical vector of the same length as the number of predictors.</p>
<p><code>drop.square</code> - for fits with more than one predictor and degree = 2, should the quadratic term be dropped for particular predictors? Terms are specified in the same way as for parametric.</p>
<p><code>normalize</code> - should the predictors be normalized to a common scale if there is more than one? The normalization used is to set the 10% trimmed standard deviation to one. Set to false for spatial coordinate predictors and others known to be on a common scale.</p>
<p><code>family</code> - if “gaussian” fitting is by least-squares, and if “symmetric” a re-descending M estimator is used with Tukey’s biweight function. Can be abbreviated.</p>
<p><code>method</code> - fit the model or just extract the model frame. Can be abbreviated.</p>
<p><code>control</code> - control parameters: see loess.control.</p>
<p><code>...</code> - control parameters can also be supplied directly (if control is not specified).</p>
<p>Now that we see we can set things like <code>span</code> and <code>degree</code> let’s try it out.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create the data frame</span></span>
<span id="cb5-2">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>), </span>
<span id="cb5-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>))</span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit LOESS regression models</span></span>
<span id="cb5-6">loess50 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loess</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">span=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb5-7">smooth50 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(loess50)</span>
<span id="cb5-8">loess75 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loess</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">span=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>)</span>
<span id="cb5-9">smooth75 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(loess75)</span>
<span id="cb5-10">loess90 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loess</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">span=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>)</span>
<span id="cb5-11">smooth90 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(loess90)</span>
<span id="cb5-12">loess50_degree1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loess</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">span=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">degree=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-13">smooth50_degree1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(loess50_degree1)</span>
<span id="cb5-14">loess50_degree2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loess</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">span=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">degree=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb5-15">smooth50_degree2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(loess50_degree2)</span>
<span id="cb5-16"></span>
<span id="cb5-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create scatterplot with each regression line overlaid</span></span>
<span id="cb5-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Loess Regression Models'</span>)</span>
<span id="cb5-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(smooth50, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span>
<span id="cb5-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(smooth75, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'purple'</span>)</span>
<span id="cb5-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(smooth90, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>)</span>
<span id="cb5-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(smooth50_degree1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'green'</span>)</span>
<span id="cb5-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(smooth50_degree2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'orange'</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-11-22/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="empowering-you-try-it-yourself" class="level2">
<h2 class="anchored" data-anchor-id="empowering-you-try-it-yourself">Empowering You: Try It Yourself!</h2>
<p>Now comes the most exciting part – empowering you to wield the magic wand with the <code>mtcars</code> dataset or any other dataset of your choice. Encourage your readers to try the code on their own datasets, and witness the transformative power of LOESS regression.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Your readers can replace this with their own dataset</span></span>
<span id="cb6-2">user_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user_dataset.csv"</span>)</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit a LOESS model on their data</span></span>
<span id="cb6-5">user_loess_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loess</span>(Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> user_data)</span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualize the results</span></span>
<span id="cb6-8">user_predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(user_loess_model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> user_data)</span>
<span id="cb6-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(user_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X, user_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Your Turn: Unleash LOESS Magic"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>)</span>
<span id="cb6-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(user_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X, user_predictions, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>In this journey, we’ve walked through the fundamentals of LOESS regression in R, witnessed its magic in action using the iconic <code>mtcars</code> dataset, and now it’s your turn to wield the wand. As you embark on your own adventures with LOESS, remember that this enchanting technique adapts to the nuances of your data, revealing hidden patterns and smoothing the way for clearer insights.</p>
<p>Happy coding, and may the LOESS magic be with you! 🚗✨</p>


</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-11-22/index.html</guid>
  <pubDate>Wed, 22 Nov 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Logarithmic Regression in R: A Step-by-Step Guide with Prediction Intervals</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-11-21/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Logarithmic regression is a statistical technique used to model the relationship between a dependent variable and an independent variable when the relationship is logarithmic. In other words, it is used to model situations where the dependent variable changes at a decreasing rate as the independent variable increases.</p>
<p>In this blog post, we will guide you through the process of performing logarithmic regression in R, from data preparation to visualizing the results. We will also discuss how to calculate prediction intervals and plot them along with the regression line.</p>
</section>
<section id="step-1-data-preparation" class="level1">
<h1>Step 1: Data Preparation</h1>
<p>Before diving into the analysis, it is essential to ensure that your data is properly formatted and ready for analysis. This may involve data cleaning, checking for missing values, and handling outliers.</p>
</section>
<section id="step-2-visualizing-the-data" class="level1">
<h1>Step 2: Visualizing the Data</h1>
<p>A quick scatterplot of the dependent variable versus the independent variable can provide valuable insights into the relationship between the two variables. This will help you determine if a logarithmic regression model is appropriate for your data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load the data</span></span>
<span id="cb1-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-3">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb1-4">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x)</span>
<span id="cb1-5">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dependent =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">independent =</span> x)</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a scatterplot</span></span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>independent, data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dependent)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-11-21/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="step-3-fitting-the-logarithmic-regression-model" class="level1">
<h1>Step 3: Fitting the Logarithmic Regression Model</h1>
<p>The <code>lm()</code> function in R can be used to fit a logarithmic regression model. The syntax for fitting a logarithmic regression model is as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(dependent <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(independent), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data)</span></code></pre></div>
</div>
</section>
<section id="step-4-evaluating-the-model" class="level1">
<h1>Step 4: Evaluating the Model</h1>
<p>Once the model has been fitted, it is important to evaluate its performance. There are several metrics that can be used to evaluate the performance of a logarithmic regression model, such as the coefficient of determination (R-squared) and the mean squared error (MSE).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = dependent ~ log(independent), data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.12938 -0.24849 -0.03559  0.23825  0.55343 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       7.70024    0.12087   63.71   &lt;2e-16 ***
log(independent) -1.76239    0.03221  -54.72   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2974 on 98 degrees of freedom
Multiple R-squared:  0.9683,    Adjusted R-squared:  0.968 
F-statistic:  2994 on 1 and 98 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="step-5-calculating-prediction-intervals" class="level1">
<h1>Step 5: Calculating Prediction Intervals</h1>
<p>Prediction intervals provide a range of values within which we expect the true value of the dependent variable to fall for a given value of the independent variable. There are several methods for calculating prediction intervals, but one common method is to use the <code>predict()</code> function in R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">newdata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">independent =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>))</span>
<span id="cb5-2"></span>
<span id="cb5-3">predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(model, </span>
<span id="cb5-4">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newdata, </span>
<span id="cb5-5">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">interval =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prediction"</span>,</span>
<span id="cb5-6">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>)</span></code></pre></div>
</div>
</section>
<section id="step-6-plotting-the-predictions-and-intervals" class="level1">
<h1>Step 6: Plotting the Predictions and Intervals</h1>
<p>Plotting the predictions and intervals along with the regression line can help visualize the relationship between the variables and the uncertainty in the predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>independent, data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dependent)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(predictions[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> newdata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>independent, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matlines</span>(newdata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>independent, predictions[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-11-21/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Logarithmic regression is a powerful statistical technique that can be used to model a variety of relationships between variables. By following the steps outlined in this blog post, you can implement logarithmic regression in R to gain valuable insights from your data.</p>
</section>
<section id="you-try" class="level1">
<h1>You Try!!</h1>
<p>We encourage you to try out logarithmic regression on your own data. Start by exploring the relationship between your variables using a scatterplot. Then, fit a logarithmic regression model using the <code>lm()</code> function and evaluate its performance using the <code>summary()</code> function. Finally, calculate prediction intervals and plot them along with the regression line to visualize the relationship between the variables and the uncertainty in the predictions.</p>


</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-11-21/index.html</guid>
  <pubDate>Tue, 21 Nov 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Mastering Exponential Regression in R: A Step-by-Step Guide</title>
  <dc:creator>Steven P. Sanderson II, MPH</dc:creator>
  <link>https://www.spsanderson.com/steveondata/posts/2023-11-20/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Hey folks, welcome back to another exciting R programming journey! Today, we’re diving into the fascinating world of exponential regression using base R. Exponential regression is a powerful tool, especially in the realm of data science, and we’ll walk through the process step by step. So, grab your coding hats, and let’s get started!</p>
</section>
<section id="understanding-exponential-regression" class="level1">
<h1>Understanding Exponential Regression</h1>
<p>Before we jump into the code, let’s quickly grasp the concept of exponential regression. In simple terms, it’s a statistical method used to model relationships where the rate of change of a variable is proportional to its current state. Think of scenarios like population growth, viral spread, or even financial investments.</p>
<section id="step-1-your-data" class="level2">
<h2 class="anchored" data-anchor-id="step-1-your-data">Step 1: Your Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">Year <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2001</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2003</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2004</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2005</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2006</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2008</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2009</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2011</span>, </span>
<span id="cb1-2">          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2012</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2013</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2015</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2016</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>)</span>
<span id="cb1-3">Population <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">550</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">610</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">680</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">760</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">850</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">950</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1060</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1180</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1320</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1470</span>, </span>
<span id="cb1-4">                <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1640</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1830</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2040</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2280</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2540</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2830</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3140</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3480</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3850</span>)</span>
<span id="cb1-5"></span>
<span id="cb1-6">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(Year, Population)</span></code></pre></div>
</div>
<p>Make sure to replace “your_data.csv” with the actual file name and path of your dataset. This is the foundation of our analysis, so choose a dataset that suits your exponential regression exploration.</p>
</section>
<section id="step-2-explore-your-data" class="level2">
<h2 class="anchored" data-anchor-id="step-2-explore-your-data">Step 2: Explore Your Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Take a sneak peek at your data</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(df)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Year Population
1 2001        500
2 2002        550
3 2003        610
4 2004        680
5 2005        760
6 2006        850</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(df)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Year        Population    
 Min.   :2001   Min.   : 500.0  
 1st Qu.:2006   1st Qu.: 827.5  
 Median :2010   Median :1395.0  
 Mean   :2010   Mean   :1678.0  
 3rd Qu.:2015   3rd Qu.:2345.0  
 Max.   :2020   Max.   :3850.0  </code></pre>
</div>
</div>
<p>Understanding your data is crucial. The ‘head()’ function displays the first few rows, and ‘summary()’ gives you a statistical summary. Look for patterns that might indicate exponential growth or decay.</p>
</section>
<section id="step-3-plot-your-data" class="level2">
<h2 class="anchored" data-anchor-id="step-3-plot-your-data">Step 3: Plot Your Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a scatter plot</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(</span>
<span id="cb6-3">  Year, </span>
<span id="cb6-4">  Population, </span>
<span id="cb6-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential Regression"</span>, </span>
<span id="cb6-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Independent Variable"</span>, </span>
<span id="cb6-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dependent Variable"</span></span>
<span id="cb6-8">)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-11-20/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Visualizing your data helps in identifying trends. A scatter plot is an excellent choice to see if there’s a potential exponential relationship.</p>
</section>
<section id="step-4-fit-exponential-model" class="level2">
<h2 class="anchored" data-anchor-id="step-4-fit-exponential-model">Step 4: Fit Exponential Model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit exponential regression model</span></span>
<span id="cb7-2">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(Population) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df)</span>
<span id="cb7-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(Population) ~ Year, data = df)

Residuals:
       Min         1Q     Median         3Q        Max 
-0.0134745 -0.0032271  0.0008587  0.0037029  0.0108613 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -2.113e+02  4.637e-01  -455.7   &lt;2e-16 ***
Year         1.087e-01  2.307e-04   471.3   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.005948 on 18 degrees of freedom
Multiple R-squared:  0.9999,    Adjusted R-squared:  0.9999 
F-statistic: 2.221e+05 on 1 and 18 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Here, we take the logarithm of the dependent variable ‘y’ to linearize the relationship. This facilitates using linear regression to model the data.</p>
</section>
<section id="step-5-make-predictions" class="level2">
<h2 class="anchored" data-anchor-id="step-5-make-predictions">Step 5: Make Predictions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make predictions</span></span>
<span id="cb9-2">prediction_interval <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(</span>
<span id="cb9-3">  model, </span>
<span id="cb9-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> df,</span>
<span id="cb9-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">interval=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prediction"</span>,</span>
<span id="cb9-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span></span>
<span id="cb9-7">  ))</span></code></pre></div>
</div>
<p>Replace ‘new_x’ with the values for which you want to predict ‘y’. The ‘exp()’ function is used to reverse the logarithmic transformation.</p>
</section>
<section id="step-6-visualize-results" class="level2">
<h2 class="anchored" data-anchor-id="step-6-visualize-results">Step 6: Visualize Results</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the original data and the regression line</span></span>
<span id="cb10-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Year, df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Population, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential Regression"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>, </span>
<span id="cb10-3">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Population"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>)</span>
<span id="cb10-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Year, prediction_interval[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb10-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Year, prediction_interval[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb10-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Year, prediction_interval[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb10-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential Regression"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.spsanderson.com/steveondata/posts/2023-11-20/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This code adds the exponential regression line to your scatter plot. It’s a visual confirmation of how well your model fits the data.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>There you have it, a step-by-step guide to performing exponential regression in R using base functions. Remember, the real fun begins when you apply this to your own datasets. Play around, tweak the parameters, and see how well you can predict those future values.</p>
<p>Coding is all about exploration and experimentation, so don’t hesitate to get your hands dirty. Happy coding, and may your data always reveal its secrets in the most exponential way possible!</p>


</section>

 ]]></description>
  <category>rtip</category>
  <category>regression</category>
  <guid>https://www.spsanderson.com/steveondata/posts/2023-11-20/index.html</guid>
  <pubDate>Mon, 20 Nov 2023 05:00:00 GMT</pubDate>
</item>
</channel>
</rss>
